

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    
    <meta name="author" content="Lock">
    
    <meta name="description" content="​        学vmpwn学到自闭，逆指令太难了。。。整点新东西缓解一下。大一就想学iot安全，环境一来二去也搭了有几次，不过要越过glibc的pwn直接跳到iot的pwn还是不太好，一是ctf比赛中glibc的pwn还是战必很大的，二是打基础，最后找工作人也得看ctf经历不是？最终在大二上中旬">
    
    

    
    <link rel="alternative" href="YOUR_RSS_ADDRESS" title="Lock&#39;s blog" type="application/atom+xml">
    
    
    

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>路由器环境搭建 | Lock&#39;s blog</title>

    <!-- Bootstrap -->
    
<link rel="stylesheet" href="/LawlietLW.github.io/bootstrap/css/bootstrap.min.css">

    
<link rel="stylesheet" href="/LawlietLW.github.io/css/style.css">


    <!-- Javascript -->
    <script src="/LawlietLW.github.io/js/jquery-2.1.0.min.js"></script>
    <script src="/LawlietLW.github.io/js/jquery.backstretch.min.js"></script>
    <script src="/LawlietLW.github.io/bootstrap/js/bootstrap.min.js"></script>
    <script src="/LawlietLW.github.io/js/headroom.min.js"></script>
    <script src="/LawlietLW.github.io/js/jquery.headroom.min.js"></script> 
    <script src="/LawlietLW.github.io/js/common.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
<meta name="generator" content="Hexo 4.1.1"><link rel="stylesheet" href="/LawlietLW.github.io/css/prism-tomorrow.css" type="text/css"></head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-inverse" role="banner">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://LawlietLW.github.io" title="Lock's blog">Lock&#39;s blog</a>
            </div>

            <div role="navigation" class="collapse navbar-collapse bs-navbar-collapse">
                

                <ul class="nav navbar-nav">
                    
                    <li id="nav-index"><a href="/">首页</a></li>
                    
                    <li id="nav-archives"><a href="/archives">归档</a></li>
                    
                    <li id="nav-tags"><a href="/tags">标签</a></li>
                    
                    <li id="nav-categories"><a href="/categories">分类</a></li>
                    
                    <li id="nav-curriculumvitae"><a href="/curriculumvitae">关于</a></li>
                    
                    <li id="nav-links"><a href="/links">链接</a></li>
                    
                    
                    
                </ul>
            </div>
        </div>
    </nav>
    
    <script>
    var backRoot = "./themes/hexadillax/source/images/background";
    var backArray = [ "1.jpg", "2.jpg", "3.jpg",  ];
        
    $(function() {
        // page-id...
        var pageId = "2020/05/17/lu-you-qi-huan-jing-da-jian/";
        pageId = pageId.substr(0, pageId.indexOf("/"));
        if(pageId === "") pageId = "index";
        
        $("#nav-" + pageId).addClass("active");
    });
    </script>

    <article class="post container">
    <div class="well post-body first-post last-post">
        <h1>路由器环境搭建</h1>
        
        <div class="time-info">
发表于:<time datetime="2020-05-17T10:22:42.000Z" itemprop="datePublished">2020-05-17</time>，更新于:<time datetime="2020-09-03T09:46:20.185Z" itemprop="dateModified">2020-09-03</time>，By <a href="http://LawlietLW.github.io" title="Lock">Lock</a>
        </div>
        
        <div class="post-body-inner">
            <div id="toc" class="toc-article well">
                <strong class="toc-title">大纲</strong>
                
            </div>
            
            <a id="more"></a>

<p>​        学vmpwn学到自闭，逆指令太难了。。。整点新东西缓解一下。大一就想学iot安全，环境一来二去也搭了有几次，不过要越过glibc的pwn直接跳到iot的pwn还是不太好，一是ctf比赛中glibc的pwn还是战必很大的，二是打基础，最后找工作人也得看ctf经历不是？最终在大二上中旬开始学pwn，后来又弃了一段时间，转学web(<del>我想日站</del>！)最终在寒假又重新捡起了pwn，后来打了几场比赛，NPUCTF,安恒月赛，常规的glibc的pwn我还是能应付应付的，满怀期望的迎接De1CTF，去年是作为web狗参赛，今年是作为一只pwn🐕参赛，结果。。。。打自闭了，签到pwn是c艹，剩下的没一道常规题，两道mips，一道安卓，和去年的pwn的难度差太多了。。。。De1CTF之后又是网鼎杯，18年的网鼎杯pwn也比较常规，赛前我觉得如果是上一届那种难度我还是能做的，结果再次自闭。。。第一次接触vmpwn竟然是在网鼎杯，直接懵逼，一道编译器pwn，一道vmpwn，一道盲pwn。。。两场比赛之后我深刻的认识到了我是个fw，太辣鸡了，知识面太窄，基础不够扎实，仅仅只会glibc下的堆栈pwn完全不够了，要走的路还很长很长。。。。</p>
<p>​       扯得有点远了，说了一下学pwn的一些历程，接下来进入正题，路由器环境搭建。</p>
<p>​        参考了挺多大师傅的博客，以前都是直接无脑复制粘贴(<del>现在也是，只不过更谨慎地复制粘贴</del>)。</p>
<p>首先是安装<strong>binwalk</strong>，有两种方法</p>
<pre><code>方法1:sudo apt-get install binwalk 
方法2:
git clone https://github.com/devttys0/binwalk.git
cd binwalk
sudo ./deps.sh
sudo python ./setup.py install
sudo apt-get install python-lzma
sudo -H pip install git+https://github.com/ahupp/python-magic
sudo -H pip install git+https://github.com/sviehb/jefferson</code></pre><p>直接sudo apt-get有些包会安装不完全，所以推荐源码安装</p>
<p>然后安装 <strong>firmadyne</strong>，需要安装<strong>postgres</strong>数据库</p>
<pre><code>sudo apt-get install postgres
git clone https://github.com/firmadyne/firmadyne
cd firmadyne/ &amp;&amp; sudo download.sh
sudo -u postgres createuser -P firmadyne  
sudo -u postgres createdb -O firmadyne firmware
sudo -u postgres psql -d firmware &lt; ./firmadyne/database/schema</code></pre><p>接下来是qemu，按照H4lo大佬的说法，过高版本或者过低版本在某些情况下会报错，推荐<strong>qemu2.4.0</strong>版本，下载压缩包本地编译</p>
<pre><code>wget https://download.qemu.org/qemu-2.4.0.tar.xz
tar xvf qemu-2.4.0.tar.xz &amp;&amp; cd qemu-2.4.0/
./configure
make -j8
sudo make install</code></pre><p><strong>sasquatch</strong>安装</p>
<pre><code>sudo apt-get install zlib1g-dev liblzma-dev liblzo2-dev
sudo git clone https://github.com/devttys0/sasquatch
cd sasquatch &amp;&amp; sudo make &amp;&amp; sudo make install</code></pre><p><strong>交叉编译环境 buildroot安装</strong></p>
<p>还是跟着h牛的文章来，先把所有库都装上</p>
<pre><code>sudo apt-get install libncurs*
wget http://buildroot.uclibc.org/downloads/snapshots/buildroot-snapshot.tar.bz2
tar -jxvf buildroot-snapshot.tar.bz2
cd buildroot/
make clean
make menuconfig
sudo make</code></pre><p>h牛wget的网址有问题，应该是<strong>snapshot</strong>，他多加了一个s，我当时就是下不好这个压缩包，后来直接搜索了一波，才发现问题所在</p>
<p><strong>make menuconfig</strong>之后，会出现一个GUI界面，进入<strong>Target option</strong>，选择<strong>Target Architecture Varient</strong>为<strong>Mips 32</strong>，将<strong>Target Architecture</strong>选为<strong>MIPS(little endian)</strong>,保存后退出到上一级，进入<strong>Toolchain</strong>，将<strong>Kernel Headers</strong>修改为本机的kernel版本即可，然后保存退出，编译时间会有一个小时左右</p>
<p> <strong>gdb-multiarch</strong></p>
<pre><code>sudo apt-get install gdb-multiarch</code></pre><p>接下来我们还需要安装一下mips版本的gcc及其相关组件，apt 中对应的包名为 <code>gcc-mips-linux-gnu</code> 与 <code>gcc-mipsel-linux-gnu</code></p>
<pre><code>sudo apt-get install gcc-mips-linux-gnu
sudo apt-get install gcc-mipsel-linux-gnu</code></pre><p>其中mips-linux-gnu-gcc用来编译大端序程序，mipsel-linux-gnu-gcc用来编译小端序</p>
<p>我们来写一个小程序验证一下</p>
<pre class=" language-c"><code class="language-c"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;stdlib.h></span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;malloc.h></span></span>


<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

        <span class="token keyword">int</span> <span class="token operator">*</span>a<span class="token punctuation">;</span>
        a <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token number">0x10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token function">puts</span><span class="token punctuation">(</span><span class="token string">"demo"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这是h牛的文章中的一个程序</p>
<p>首先我们用小端序编译</p>
<pre><code>mipsel-linux-gnu-gcc demo.c -o demo -static</code></pre><p>静态编译</p>
<p><img src="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/1.jpg" alt></p>
<p>可以看出确实是小端序静态链接，接着我们运行一下</p>
<p><img src="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/2.jpg" alt></p>
<p>运行没问题。我们再用大端序编译一下</p>
<pre><code>mips-linux-gnu-gcc demo.c -o demo -static</code></pre><p><img src="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/3.jpg" alt></p>
<p>确实是大端序静态链接</p>
<p>接着运行</p>
<p><img src="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/4.jpg" alt></p>
<p>无误</p>
<p>现在都是静态链接，我们再动态编译一下</p>
<pre><code>mipsel-linux-gnu-gcc demo.c -o demo</code></pre><p><img src="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/5.jpg" alt></p>
<pre><code>qemu-mipsel -L /usr/mipsel-linux-gnu/ ./demo</code></pre><p><img src="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/6.jpg" alt></p>
<p>-L是连接指定的libc库</p>
<p>至此，环境就算配置完毕，还有一些gdb动态调试mips文件的，后面会再更新</p>
<script>
        document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });
      </script>

			
            <section class="comment">
<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/" data-title="路由器环境搭建" data-url="http://LawlietLW.github.io/LawlietLW.github.io/2020/05/17/lu-you-qi-huan-jing-da-jian/"></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"YOUR_DUOSHUO_SHORT_NAME"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0]
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- 多说公共JS代码 end -->
</section>
        </div>
    </div>
</article>

    <footer id="footer">
    <div id="bottom-tip">
        Lock&#39;s blog
    </div>
        <small>该博客由 <a href="https://hexo.io/" target="_blank">Hexo</a> 强力驱动，搭载 <a href="https://github.com/XadillaX/hexadillax" target="_blank">Hexadillax</a> 主题</small><br />
        <small>&copy; 2014 Lock</small>
    </footer>

    


</body>
</html>

